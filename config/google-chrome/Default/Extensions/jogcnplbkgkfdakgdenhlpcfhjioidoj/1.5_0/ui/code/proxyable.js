/*! For license information please see proxyable.js.LICENSE.txt */
(()=>{var e={"./src/core/ProfileOperations.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{ProfileOperations:()=>c});var s=r("./src/lib/Debug.ts"),i=r("./src/lib/environment.ts"),n=r("./src/lib/Utils.ts"),o=r("./src/core/definitions.ts"),a=r("./src/core/ProxyRules.ts"),l=r("./src/core/Settings.ts"),u=r("./src/core/SettingsOperation.ts");class c{static addUpdateProfile(e,t){if(t??=l.Settings.current,e.profileId){let r=c.findSmartProfileById(e.profileId,t.proxyProfiles);if(r)return void Object.assign(r,e)}c.ensureProfileId(e),t.proxyProfiles.push(e)}static ensureProfileId(e){e.profileId||(e.profileId="profile-"+n.Utils.getNewUniqueIdString())}static deleteProfile(e){let t=new o.ResultHolder,r=l.Settings.current,n=c.findSmartProfileIndexById(e,r.proxyProfiles);return-1==n?(s.Debug.warn(`deleteProfile failed for profile id = ${e}`),t.success=!1,t.message=i.api.i18n.getMessage("settingsProfilesDeleteFailed"),t):r.proxyProfiles[n].profileTypeConfig.builtin?(t.success=!1,t.message=i.api.i18n.getMessage("settingsProfilesDeleteBuiltinFail"),t):(r.proxyProfiles.splice(n,1),t.success=!0,t)}static profileTypeSupportsRules(e){switch(e){case o.SmartProfileType.SmartRules:case o.SmartProfileType.AlwaysEnabledBypassRules:case o.SmartProfileType.IgnoreFailureRules:return!0;case o.SmartProfileType.Direct:case o.SmartProfileType.SystemProxy:default:return!1}}static profileTypeSupportsSubscriptions(e){switch(e){case o.SmartProfileType.SmartRules:case o.SmartProfileType.AlwaysEnabledBypassRules:return!0;case o.SmartProfileType.IgnoreFailureRules:case o.SmartProfileType.Direct:case o.SmartProfileType.SystemProxy:default:return!1}}static getActiveSmartProfile(){let e=l.Settings.current,t=c.findSmartProfileById(e.activeProfileId,e.proxyProfiles);return null==t?(s.Debug.warn("No active profile found"),null):t}static getIgnoreFailureRulesProfile(){let e=l.Settings.current,t=c.findFirstSmartProfileType(o.SmartProfileType.IgnoreFailureRules,e.proxyProfiles);return null==t&&(t=new o.SmartProfile,t.profileType=o.SmartProfileType.IgnoreFailureRules,t.profileTypeConfig=(0,o.getSmartProfileTypeConfig)(o.SmartProfileType.IgnoreFailureRules),t.profileName="Ignore Failure Rules",c.addUpdateProfile(t)),t}static findFirstSmartProfileType(e,t){return t.find((t=>t.profileType===e))}static findSmartProfileById(e,t){return t.find((t=>t.profileId===e))}static findSmartProfileIndexById(e,t){return t.findIndex((t=>t.profileId===e))}static compileSmartProfile(e){let t=new o.SmartProfileCompiled;return c.copySmartProfileBase(e,t),c.compileSmartProfileRuleInternal(e,t),t.profileProxyServerId&&(t.profileProxyServer=u.SettingsOperation.findProxyServerById(t.profileProxyServerId)),t}static compileSmartProfileRuleInternal(e,t){if(t.compiledRules=new o.CompiledProxyRulesInfo,e.proxyRules&&e.proxyRules.length){let r=a.ProxyRules.compileRules(e,e.proxyRules);t.compiledRules.Rules=r?.compiledList??[],t.compiledRules.WhitelistRules=r?.compiledWhiteList??[]}else t.compiledRules.Rules=[],t.compiledRules.WhitelistRules=[];if(e.rulesSubscriptions&&e.rulesSubscriptions.length>0){let r=[],s=[];for(const t of e.rulesSubscriptions)if(t.enabled){if(t.proxyRules&&t.proxyRules.length>0){let e=a.ProxyRules.compileRulesSubscription(t.proxyRules);e&&(r=r.concat(e))}if(t.whitelistRules&&t.whitelistRules.length>0){let e=a.ProxyRules.compileRulesSubscription(t.whitelistRules,!0);e&&(s=s.concat(e))}}t.compiledRules.SubscriptionRules=r,t.compiledRules.WhitelistSubscriptionRules=s}}static getSmartProfileBaseList(e){let t=[];for(const r of e){let e=new o.SmartProfileBase;c.copySmartProfileBase(r,e),t.push(e)}return t}static getSmartProfileBase(e){let t=new o.SmartProfileBase;return c.copySmartProfileBase(e,t),t}static copySmartProfileBase(e,t,r=!0){t.profileType=e.profileType,t.profileId=e.profileId,t.profileName=e.profileName,t.enabled=e.enabled,t.profileProxyServerId=e.profileProxyServerId,r&&(t.profileTypeConfig={builtin:e.profileTypeConfig.builtin,editable:e.profileTypeConfig.editable,selectable:e.profileTypeConfig.selectable,supportsSubscriptions:e.profileTypeConfig.supportsSubscriptions,supportsProfileProxy:e.profileTypeConfig.supportsProfileProxy,customProxyPerRule:e.profileTypeConfig.customProxyPerRule,canBeDisabled:e.profileTypeConfig.canBeDisabled,supportsRuleActionWhitelist:e.profileTypeConfig.supportsRuleActionWhitelist,defaultRuleActionIsWhitelist:e.profileTypeConfig.defaultRuleActionIsWhitelist})}static copySmartProfile(e,t,r=!0){c.copySmartProfileBase(e,t,r);let s=[];if(e.proxyRules)for(const t of e.proxyRules){let e=new o.ProxyRule;e.CopyFrom(t),e.isValid()&&s.push(e)}t.proxyRules=s;let i=[];if(e.rulesSubscriptions)for(const t of e.rulesSubscriptions){let e=new o.ProxyRulesSubscription;e.CopyFrom(t),e.isValid()&&i.push(e)}t.rulesSubscriptions=i}static resetProfileTypeConfig(e){let t=(0,o.getSmartProfileTypeConfig)(e.profileType);t&&(e.profileTypeConfig=t)}}},"./src/core/ProxyEngine.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{ProxyEngine:()=>l});var s=r("./src/core/ProxyEngineFirefox.ts"),i=r("./src/lib/environment.ts"),n=r("./src/core/ProxyEngineChrome.ts"),o=r("./src/core/Settings.ts"),a=r("./src/lib/Debug.ts");class l{static configureEnginePrematurely(){i.environment.chrome||(a.DiagDebug?.trace("ProxyEngine.configureEnginePrematurely."),s.ProxyEngineFirefox.register())}static registerEngine(){a.DiagDebug?.trace("ProxyEngine.registerEngine"),i.environment.chrome||s.ProxyEngineFirefox.register(),o.Settings.updateActiveSettings(),this.updateBrowsersProxyConfig()}static updateBrowsersProxyConfig(){this.updateFirefoxProxyConfig(),this.updateChromeProxyConfig()}static notifyProxyRulesChanged(){o.Settings.updateActiveSettings(),this.updateBrowsersProxyConfig()}static updateChromeProxyConfig(){i.environment.chrome&&n.ProxyEngineChrome.updateChromeProxyConfig()}static updateFirefoxProxyConfig(){i.environment.chrome||s.ProxyEngineFirefox.updateFirefoxProxyConfig()}}},"./src/core/ProxyEngineChrome.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{ProxyEngineChrome:()=>a});var s=r("./src/core/definitions.ts"),i=r("./src/lib/environment.ts"),n=r("./src/lib/Debug.ts"),o=r("./src/core/Settings.ts");class a{static updateChromeProxyConfig(){let e=o.Settings.active;if(e.activeProfile.profileType==s.SmartProfileType.SystemProxy){let e={mode:"system"};return void i.api.proxy.settings.set({value:e,scope:"regular"},(function(){i.api.runtime.lastError&&n.Debug.error("updateChromeProxyConfig failed with ",i.api.runtime.lastError)}))}if(e.activeProfile.profileType==s.SmartProfileType.Direct){let e={mode:"direct"};return void i.api.proxy.settings.set({value:e,scope:"regular"},(function(){i.api.runtime.lastError&&n.Debug.error("updateChromeProxyConfig failed with ",i.api.runtime.lastError)}))}let t={mode:"pac_script",pacScript:{data:this.generateChromePacScript()}};i.api.proxy.settings.set({value:t,scope:"regular"},(function(){i.api.runtime.lastError&&n.Debug.error("updateChromeProxyConfig failed with ",i.api.runtime.lastError)}))}static generateChromePacScript(){let e=o.Settings.active,t=e.activeProfile.profileType,r=this.convertActiveProxyServer(e.currentProxyServer),i=e.activeProfile.compiledRules;return`\nconst compiledRules = {\n\t/** User defined whitelist rules. P2 */\n\tWhitelistRules: [${this.regexHostArrayToString(i.WhitelistRules).join(",")}],\n\t/** User defined rules. P1 */\n\tRules: [${this.regexHostArrayToString(i.Rules).join(",")}],\n\t/** Subscription whitelist rules. P3  */\n\tWhitelistSubscriptionRules: [${this.regexHostArrayToString(i.WhitelistSubscriptionRules).join(",")}],\n\t/** Subscription rules. P4 */\n\tSubscriptionRules: [${this.regexHostArrayToString(i.SubscriptionRules).join(",")}]\n};\nconst SmartProfileType = {\n\tDirect: ${s.SmartProfileType.Direct},\n\tSystemProxy: ${s.SmartProfileType.SystemProxy},\n\tSmartRules: ${s.SmartProfileType.SmartRules},\n\tAlwaysEnabledBypassRules: ${s.SmartProfileType.AlwaysEnabledBypassRules},\n\tIgnoreFailureRules: ${s.SmartProfileType.IgnoreFailureRules},\n}\nconst CompiledProxyRuleType = {\n\tRegexHost: ${s.CompiledProxyRuleType.RegexHost},\n\tRegexUrl: ${s.CompiledProxyRuleType.RegexUrl},\n\tExact: ${s.CompiledProxyRuleType.Exact},\n\tSearchUrl: ${s.CompiledProxyRuleType.SearchUrl},\n\tSearchDomain: ${s.CompiledProxyRuleType.SearchDomain},\n\tSearchDomainSubdomain: ${s.CompiledProxyRuleType.SearchDomainSubdomain},\n\tSearchDomainAndPath: ${s.CompiledProxyRuleType.SearchDomainAndPath},\n\tSearchDomainSubdomainAndPath: ${s.CompiledProxyRuleType.SearchDomainSubdomainAndPath}\n}\nconst activeProfileType = +'${t}';\nconst currentProxyServer = "${r}";\nconst resultDirect = "DIRECT";\nconst resultSystem = "SYSTEM";\nconst verboseDiagnostics = ${1==n.DiagDebug?.enabled}; // set to true for verbose logs using chrome flag. https://support.google.com/chrome/a/answer/6271171?hl=en#zippy=%2Cview-network-data%2Cget-network-logs\n// -------------------------\n// required PAC function that will be called to determine\n// if a proxy should be used.\nfunction FindProxyForURL(url, host, noDiagnostics) {\n\tif (verboseDiagnostics && !noDiagnostics) {\n\t\tlet finalResult = FindProxyForURL(url, host, true);\n\t\talert('SmartProxy-FindProxyForURL-Result=' + finalResult + '; host=' + host + '; url=' + url + '; activeProfile=' + activeProfileType);\n\t\treturn finalResult;\n\t}\n\n\tif (activeProfileType == SmartProfileType.SystemProxy)\n\t\treturn resultSystem;\n\n\tif (activeProfileType == SmartProfileType.Direct)\n\t\treturn resultDirect;\n\n\thost = host?.toLowerCase();\n\n\t// applying ProxyPerOrigin\n\t// is not applicable for Chromium\n\n\t// correcting 'host' because it doesn't include port number\n\tconst hostAndPort = extractHostFromUrl(url)?.toLowerCase() || host;\n\n\tif (activeProfileType == SmartProfileType.AlwaysEnabledBypassRules) {\n\n\t\t// user skip the bypass rules/ don't apply proxy\n\t\tlet userMatchedRule = findMatchedUrlInRules(url, host, hostAndPort, compiledRules.Rules);\n\t\tif (userMatchedRule) {\n\t\t\treturn makeResultForAlwaysEnabledForced(userMatchedRule)\n\t\t}\n\n\t\t// user bypass rules/ apply proxy by force\n\t\tlet userWhitelistMatchedRule = findMatchedUrlInRules(url, host, hostAndPort, compiledRules.WhitelistRules)\n\t\tif (userWhitelistMatchedRule) {\n\t\t\treturn resultDirect;\n\t\t}\n\n\t\t// subscription skip bypass rules/ don't apply proxy\n\t\tlet subMatchedRule = findMatchedUrlInRules(url, host, hostAndPort, compiledRules.SubscriptionRules);\n\t\tif (subMatchedRule) {\n\t\t\treturn makeResultForAlwaysEnabledForced(userMatchedRule)\n\t\t}\n\n\t\t// subscription bypass rules/ apply proxy by force\n\t\tlet subWhitelistMatchedRule = findMatchedUrlInRules(url, host, hostAndPort, compiledRules.WhitelistSubscriptionRules)\n\t\tif (subWhitelistMatchedRule) {\n\t\t\treturn resultDirect;\n\t\t}\n\n\t\t//** Always Enabled is forced by a rule, so other rules can't skip it */\n\t\tfunction makeResultForAlwaysEnabledForced(matchedRule) {\n\n\t\t\tif (matchedRule.proxy)\n\t\t\t\t// this rule has its own proxy setup\n\t\t\t\treturn matchedRule.proxy;\n\t\t\treturn currentProxyServer;\n\t\t}\n\n\t\t// no rule is matched, going with proxy\n\t\treturn currentProxyServer;\n\t}\n\n\tif (activeProfileType == SmartProfileType.SmartRules) {\n\n\t\t// user whitelist rules/ don't apply proxy\n\t\tlet userWhitelistMatchedRule = findMatchedUrlInRules(url, host, hostAndPort, compiledRules.WhitelistRules)\n\t\tif (userWhitelistMatchedRule) {\n\t\t\treturn makeResultForWhitelistRule(userWhitelistMatchedRule);\n\t\t}\n\n\t\t// user rules/ apply proxy\n\t\tlet userMatchedRule = findMatchedUrlInRules(url, host, hostAndPort, compiledRules.Rules);\n\t\tif (userMatchedRule) {\n\t\t\treturn makeResultForMatchedRule(userMatchedRule);\n\t\t}\n\n\t\t// subscription whitelist rules/ don't apply proxy\n\t\tlet subWhitelistMatchedRule = findMatchedUrlInRules(url, host, hostAndPort, compiledRules.WhitelistSubscriptionRules)\n\t\tif (subWhitelistMatchedRule) {\n\t\t\treturn makeResultForWhitelistRule(subWhitelistMatchedRule);\n\t\t}\n\n\t\t// subscription rules/ apply proxy\n\t\tlet subMatchedRule = findMatchedUrlInRules(url, host, hostAndPort, compiledRules.SubscriptionRules);\n\t\tif (subMatchedRule) {\n\t\t\treturn makeResultForMatchedRule(subMatchedRule);\n\t\t}\n\n\t\t/**\n\t\t * Generate result for matched whitelist rule\n\t\t */\n\t\tconst makeResultForWhitelistRule = () => {\n\t\t\treturn resultDirect;\n\t\t}\n\n\t\t/**\n\t\t * Generate result for matched proxy rule\n\t\t */\n\t\tfunction makeResultForMatchedRule(matchedRule) {\n\t\t\tif (matchedRule.proxy)\n\t\t\t\t// this rule has its own proxy setup\n\t\t\t\treturn matchedRule.proxy;\n\t\t\treturn currentProxyServer;\n\t\t}\n\t}\n\n\tif (activeProfileType == SmartProfileType.IgnoreFailureRules) {\n\t\t// NOTE: this is not a proxy profile, it is used elsewhere\n\t\t// No logic is needed here\n\t}\n\n\t// let the browser decide\n\treturn "";\n}\n\nfunction findMatchedUrlInRules(searchUrl, host, hostAndPort, rules) {\n\tif (searchUrl == null || rules == null || rules.length == 0)\n\t\treturn null;\n\n\tlet schemaLessUrlLowerCase = null;\n\tlet lowerCaseUrl = searchUrl.toLowerCase();\n\n\ttry {\n\t\tfor (let rule of rules) {\n\n\t\t\tswitch (rule.compiledRuleType) {\n\t\t\t\tcase CompiledProxyRuleType.SearchDomainSubdomain:\n\n\t\t\t\t\tif (host == null) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t// domain\n\t\t\t\t\tif (host == rule.search)\n\t\t\t\t\t\treturn rule;\n\n\t\t\t\t\t// subdomains\n\t\t\t\t\tif (host.endsWith('.' + rule.search))\n\t\t\t\t\t\treturn rule;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase CompiledProxyRuleType.Exact:\n\n\t\t\t\t\tif (lowerCaseUrl == rule.search)\n\t\t\t\t\t\treturn rule;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase CompiledProxyRuleType.RegexHost:\n\t\t\t\t\tif (host == null) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rule.regex.test(host))\n\t\t\t\t\t\treturn rule;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase CompiledProxyRuleType.RegexUrl:\n\t\t\t\t\t// Using original url with case sensitivity\n\t\t\t\t\tif (rule.regex.test(searchUrl))\n\t\t\t\t\t\treturn rule;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase CompiledProxyRuleType.SearchUrl:\n\n\t\t\t\t\tif (lowerCaseUrl.startsWith(rule.search))\n\t\t\t\t\t\treturn rule;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase CompiledProxyRuleType.SearchDomain:\n\n\t\t\t\t\tif (host == null) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (rule.search == host)\n\t\t\t\t\t\treturn rule;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase CompiledProxyRuleType.SearchDomainAndPath:\n\n\t\t\t\t\tif (schemaLessUrlLowerCase == null) {\n\t\t\t\t\t\tschemaLessUrlLowerCase = removeSchemaFromUrl(lowerCaseUrl);\n\t\t\t\t\t\tif (schemaLessUrlLowerCase == null) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (schemaLessUrlLowerCase.startsWith(rule.search))\n\t\t\t\t\t\treturn rule;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase CompiledProxyRuleType.SearchDomainSubdomainAndPath:\n\t\t\t\t\t{\n\t\t\t\t\t\tif (schemaLessUrlLowerCase == null) {\n\t\t\t\t\t\t\tschemaLessUrlLowerCase = removeSchemaFromUrl(lowerCaseUrl);\n\t\t\t\t\t\t\tif (schemaLessUrlLowerCase == null) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (schemaLessUrlLowerCase.startsWith(rule.search))\n\t\t\t\t\t\t\treturn rule;\n\n\t\t\t\t\t\tlet ruleSearchHost = extractHostFromInvalidUrl(rule.search);\n\t\t\t\t\t\tif (ruleSearchHost != null) {\n\n\t\t\t\t\t\t\tif (host == null) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// should be the same\n\t\t\t\t\t\t\tif (ruleSearchHost != host && !host.endsWith('.' + ruleSearchHost))\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\t// after this state, we are sure that the url is for the same domain, now just checking the path\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// subdomains\n\t\t\t\t\t\tif (schemaLessUrlLowerCase.includes('.' + rule.search))\n\t\t\t\t\t\t\treturn rule;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// reaching this point nothing is matched\n\t\t// if host has custom port number we need to check again\n\t\tif (host != hostAndPort) {\n\t\t\thost = hostAndPort;\n\t\t\t\n\t\t\tfor (let rule of rules) {\n\n\t\t\t\t// NOTE: Only rules that work on hostName should be checked, others can be ignored\n\t\t\t\tswitch (rule.compiledRuleType) {\n\n\t\t\t\t\tcase CompiledProxyRuleType.RegexHost:\n\t\t\t\t\t\tif (host == null) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (rule.regex.test(host))\n\t\t\t\t\t\t\treturn rule;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase CompiledProxyRuleType.SearchDomain:\n\n\t\t\t\t\t\tif (host == null) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (rule.search == host)\n\t\t\t\t\t\t\treturn rule;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase CompiledProxyRuleType.SearchDomainSubdomain:\n\n\t\t\t\t\t\tif (host == null) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// domain\n\t\t\t\t\t\tif (host == rule.search)\n\t\t\t\t\t\t\treturn rule;\n\n\t\t\t\t\t\t// subdomains\n\t\t\t\t\t\tif (host.endsWith('.' + rule.search))\n\t\t\t\t\t\t\treturn rule;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase CompiledProxyRuleType.SearchDomainSubdomainAndPath:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (schemaLessUrlLowerCase == null) {\n\t\t\t\t\t\t\t\tschemaLessUrlLowerCase = removeSchemaFromUrl(lowerCaseUrl);\n\t\t\t\t\t\t\t\tif (schemaLessUrlLowerCase == null) {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (schemaLessUrlLowerCase.startsWith(rule.search))\n\t\t\t\t\t\t\t\treturn rule;\n\n\t\t\t\t\t\t\tlet ruleSearchHost = extractHostFromInvalidUrl(rule.search);\n\t\t\t\t\t\t\tif (ruleSearchHost != null) {\n\n\t\t\t\t\t\t\t\tif (host == null) {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// should be the same\n\t\t\t\t\t\t\t\tif (ruleSearchHost != host && !host.endsWith('.' + ruleSearchHost))\n\t\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\t\t// after this state, we are sure that the url is for the same domain, now just checking the path\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// subdomains\n\t\t\t\t\t\t\tif (schemaLessUrlLowerCase.includes('.' + rule.search))\n\t\t\t\t\t\t\t\treturn rule;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase CompiledProxyRuleType.Exact:\n\t\t\t\t\tcase CompiledProxyRuleType.RegexUrl:\n\t\t\t\t\tcase CompiledProxyRuleType.SearchUrl:\n\t\t\t\t\tcase CompiledProxyRuleType.SearchDomainAndPath:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t} catch (e) {\n\t\tconsole.warn('SmartProxy> findMatchForUrl failed for ' + lowerCaseUrl, e);\n\t}\n\treturn null;\n}\n\nfunction removeSchemaFromUrl(url) {\n\tif (url == null)\n\t\treturn url;\n\tconst schemaSep = '://';\n\tlet index = url.indexOf(schemaSep);\n\tif (index > -1)\n\t\treturn url.substring(index + schemaSep.length, url.length);\n\telse\n\t\treturn url;\n}\nfunction extractHostFromInvalidUrl(url) {\n\ttry {\n\t\tif (!url.includes(":/"))\n\t\t\turl = 'http://' + url;\n\n\t\treturn extractHostFromUrl(url);\n\t}\n\tcatch (e) { return null; }\n}\nfunction extractHostFromUrl(url) {\n\t// Unescaped RegEx (/^(?:w)*://([^/?#]+)(?:[/?#]|$)/i);\n\tconst extractPattern = (/^(?:\\w)*\\:\\/\\/([^\\/?#]+)(?:[\\/?#]|$)/i);\n\n\tconst match = extractPattern.exec(url);\n\tif (!match) {\n\t\treturn null;\n\t}\n\tconst [, host] = match;\n\treturn host;\n}`}static convertActiveProxyServer(e){const t="DIRECT";if(!(e&&e.host&&e.protocol&&e.port))return t;switch(e.protocol){case"HTTP":return`PROXY ${e.host}:${e.port}`;case"HTTPS":return`HTTPS ${e.host}:${e.port}`;case"SOCKS4":return`SOCKS4 ${e.host}:${e.port}`;case"SOCKS5":return`SOCKS5 ${e.host}:${e.port}`}return t}static regexHostArrayToString(e){let t=[];for(let r=0;r<e.length;r++){let s,i=e[r];s=i.search?`unescape('${escape(i.search)}')`:"null",i.proxy?t.push(`{search:${s},regex:${i.regex?.toString()||"null"},compiledRuleType:${i.compiledRuleType},proxy:"${this.convertActiveProxyServer(i.proxy)}"}`):t.push(`{search:${s},regex:${i.regex?.toString()||"null"},compiledRuleType:${i.compiledRuleType}}`)}return t}}},"./src/core/ProxyEngineFirefox.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{ProxyEngineFirefox:()=>h});var s=r("./src/lib/environment.ts"),i=r("./src/lib/Debug.ts"),n=r("./src/core/definitions.ts"),o=r("./src/core/ProxyRules.ts"),a=r("./src/core/TabManager.ts"),l=r("./src/lib/PolyFill.ts"),u=r("./src/core/Settings.ts"),c=r("./src/core/ProxyEngineSpecialRequests.ts"),d=r("./src/core/TabRequestLogger.ts");const p=s.api;class h{static register(){return!(!p.proxy||!p.proxy.onRequest||(p.proxy.onRequest.addListener(h.handleProxyRequest,{urls:["*://*/*","ws://*/*","wss://*/*","ftp://*/*"]}),p.proxy.onError.addListener(h.onProxyError),0))}static updateFirefoxProxyConfig(){if(s.environment.notAllowed.setProxySettings)return;let e=u.Settings.active,t={proxyType:n.BrowserProxySettingsType.system};switch(i.DiagDebug?.trace("Core.updateFirefoxProxyConfig","proxyType="+n.BrowserProxySettingsType[t.proxyType]),e.activeProfile.profileType){case n.SmartProfileType.Direct:case n.SmartProfileType.SmartRules:case n.SmartProfileType.AlwaysEnabledBypassRules:case n.SmartProfileType.IgnoreFailureRules:t.proxyType=n.BrowserProxySettingsType.none;break;case n.SmartProfileType.SystemProxy:t.proxyType=n.BrowserProxySettingsType.system}l.PolyFill.browserSetProxySettings({value:t},(function(){s.environment.notSupported.setProxySettings=!1,s.environment.notAllowed.setProxySettings=!1}),(function(e){i.Debug.error("updateFirefoxProxyConfig failed to set proxy settings",t,e?.message),e&&e.message&&(e.message.includes("not supported")&&(s.environment.notSupported.setProxySettings=!0),e.message.includes("permission")&&(s.environment.notAllowed.setProxySettings=!0))}))}static waitForSettingsToHandleProxyRequest(e,t){u.Settings.addInitializeCompletedEventListener((function r(){u.Settings.removeInitializeCompletedEventListener(r);let s=h.handleProxyRequest(e);return i.DiagDebug?.trace("Settings are loaded now, result=",s,"t="+e.tabId,e.url),void t(s)}))}static handleProxyRequest(e){if(!u.Settings.active)return i.DiagDebug?.warn("Settings are not loaded yet, waiting...","t="+e.tabId,e.url),new Promise((t=>h.waitForSettingsToHandleProxyRequest(e,t)));let t=new n.ProxyableLogDataType;t.tabId=e.tabId,t.url=e.url,t.matchedRuleStatus=n.ProxyableMatchedRuleStatus.NoneMatched,t.proxifiedStatus=n.ProxyableProxifiedStatus.NoProxy;let r=u.Settings.current,s=u.Settings.active,l=s.currentProxyServer,p=null,f=s.activeProfile,m=f.profileType,g=(()=>{if(!e.url)return{type:"direct"};let u=c.ProxyEngineSpecialRequests.retrieveSpecialUrlMode(e.url,!0);if(null!==u){if(t.matchedRuleStatus=n.ProxyableMatchedRuleStatus.Special,t.proxifiedStatus=n.ProxyableProxifiedStatus.NoProxy,u.applyMode==n.SpecialRequestApplyProxyMode.NoProxy)return{type:"direct"};if(u.applyMode==n.SpecialRequestApplyProxyMode.CurrentProxy)return l?(t.proxifiedStatus=n.ProxyableProxifiedStatus.Special,h.getResultProxyInfo(l)):{type:"direct"};if(u.applyMode==n.SpecialRequestApplyProxyMode.SelectedProxy&&u.selectedProxy)return t.proxifiedStatus=n.ProxyableProxifiedStatus.Special,h.getResultProxyInfo(u.selectedProxy)}if(e.tabId>-1&&(p=a.TabManager.getTab(e.tabId),null!=p&&p.incognito&&null!=s.activeIncognitoProfile)){const d=s.activeIncognitoProfile;f=d,m=d.profileType}if(m===n.SmartProfileType.Direct||!l)return{type:"direct"};if(m===n.SmartProfileType.SystemProxy)return t.matchedRuleStatus=n.ProxyableMatchedRuleStatus.NoneMatched,t.proxifiedStatus=n.ProxyableProxifiedStatus.SystemProxyApplied,{type:"direct"};if(l||i.DiagDebug?.trace("FF.handleProxyRequest.currentProxyServer is null","t="+t.tabId,t.url,n.SmartProfileType[s.activeProfile?.profileType]),null!=p&&r.options.proxyPerOrigin&&null!=p&&p.proxified===n.TabProxyStatus.Proxified){if(e.documentUrl)return t.ruleHostName=p.proxyRuleHostName,p.proxyMatchedRule&&(t.ruleSource=n.CompiledProxyRuleSource.Rules,t.applyFromRule(p.proxyMatchedRule)),p.proxyServerFromRule&&(p.proxyServerFromRule.username&&c.ProxyEngineSpecialRequests.setSpecialUrl(`${p.proxyServerFromRule.host}:${p.proxyServerFromRule.port}`,null,p.proxyServerFromRule),l=p.proxyServerFromRule),t.matchedRuleStatus=n.ProxyableMatchedRuleStatus.ProxyPerOrigin,t.proxifiedStatus=n.ProxyableProxifiedStatus.ProxyPerOrigin,i.DiagDebug?.trace("FF.handleProxyRequest <ProxyPerOrigin>","t="+t.tabId,`OriginTab: ${p.url}`,t.url,n.SmartProfileType[s.activeProfile?.profileType]),h.getResultProxyInfo(l);p.resetTabState()}if(m==n.SmartProfileType.AlwaysEnabledBypassRules){let g=s.activeProfile.compiledRules,y=o.ProxyRules.findMatchedUrlInRules(e.url,g.Rules);if(y)return t.ruleSource=n.CompiledProxyRuleSource.Rules,P(y);let b=o.ProxyRules.findMatchedUrlInRules(e.url,g.WhitelistRules);if(b)return t.ruleSource=n.CompiledProxyRuleSource.Rules,v(b);let S=o.ProxyRules.findMatchedUrlInRules(e.url,g.SubscriptionRules);if(S)return t.ruleSource=n.CompiledProxyRuleSource.Subscriptions,P(S);let x=o.ProxyRules.findMatchedUrlInRules(e.url,g.WhitelistSubscriptionRules);if(x)return t.ruleSource=n.CompiledProxyRuleSource.Subscriptions,v(x);function P(r){return t.matchedRuleStatus=n.ProxyableMatchedRuleStatus.AlwaysEnabledForcedByRules,t.proxifiedStatus=n.ProxyableProxifiedStatus.MatchedRule,t.applyFromRule(r),e.tabId>-1&&(p=h.storeTabProxyDetail(e,r)??p),r.proxy?(r.proxy.username&&c.ProxyEngineSpecialRequests.setSpecialUrl(`${r.proxy.host}:${r.proxy.port}`,null,r.proxy),h.getResultProxyInfo(r.proxy)):h.getResultProxyInfo(l)}function v(e){return t.matchedRuleStatus=n.ProxyableMatchedRuleStatus.AlwaysEnabledByPassed,t.proxifiedStatus=n.ProxyableProxifiedStatus.NoProxy,t.applyFromRule(e),{type:"direct"}}return t.matchedRuleStatus=n.ProxyableMatchedRuleStatus.NoneMatched,t.proxifiedStatus=n.ProxyableProxifiedStatus.AlwaysEnabled,h.getResultProxyInfo(l)}if(m==n.SmartProfileType.SmartRules){let R=s.activeProfile.compiledRules,w=o.ProxyRules.findMatchedUrlInRules(e.url,R.WhitelistRules);if(w)return t.ruleSource=n.CompiledProxyRuleSource.Rules,I(w);let _=o.ProxyRules.findMatchedUrlInRules(e.url,R.Rules);if(_)return t.ruleSource=n.CompiledProxyRuleSource.Rules,C(_);let T=o.ProxyRules.findMatchedUrlInRules(e.url,R.WhitelistSubscriptionRules);if(T)return t.ruleSource=n.CompiledProxyRuleSource.Subscriptions,I(T);let k=o.ProxyRules.findMatchedUrlInRules(e.url,R.SubscriptionRules);if(k)return t.ruleSource=n.CompiledProxyRuleSource.Subscriptions,C(k);function I(e){return t.matchedRuleStatus=n.ProxyableMatchedRuleStatus.Whitelisted,t.proxifiedStatus=n.ProxyableProxifiedStatus.NoProxy,t.applyFromRule(e),{type:"direct"}}function C(r){return t.matchedRuleStatus=n.ProxyableMatchedRuleStatus.MatchedRule,t.proxifiedStatus=n.ProxyableProxifiedStatus.MatchedRule,t.applyFromRule(r),e.tabId>-1&&(p=h.storeTabProxyDetail(e,r)??p),r.proxy?(r.proxy.username&&c.ProxyEngineSpecialRequests.setSpecialUrl(`${r.proxy.host}:${r.proxy.port}`,null,r.proxy),h.getResultProxyInfo(r.proxy)):h.getResultProxyInfo(l)}}return n.SmartProfileType.IgnoreFailureRules,t.matchedRuleStatus=n.ProxyableMatchedRuleStatus.NoneMatched,t.proxifiedStatus=n.ProxyableProxifiedStatus.NoProxy,{type:"direct"}})();return i.DiagDebug?.trace("FF.handleProxyRequest","t="+t.tabId,g,t.url,n.SmartProfileType[s.activeProfile?.profileType]),h.storeTabStats(p,t,e,m),d.TabRequestLogger.notifyProxyableLog(t),g}static storeTabProxyDetail(e,t){if("main_frame"!==e.type)return null;let r=a.TabManager.getOrSetTab(e.tabId,!0,e.url);return null==r?null:(e.url!==r.url&&e.documentUrl||a.TabManager.setTabDataProxied(r,e.url,t),r)}static storeTabStats(e,t,r,s){null==e&&(e=a.TabManager.getTab(r.tabId)),null!=e&&(t.proxifiedStatus==n.ProxyableProxifiedStatus.AlwaysEnabled&&t.matchedRuleStatus==n.ProxyableMatchedRuleStatus.AlwaysEnabledByPassed&&(e.status.hasAlwaysEnabledByPassed=!0),t.matchedRuleStatus==n.ProxyableMatchedRuleStatus.Whitelisted&&(e.status.statsHasWhitelistedRules=!0),t.proxified?e.status.statsHasProxifiedRequest=!0:e.status.statsHasDirectRequest=!0)}static getResultProxyInfo(e){return"SOCKS5"===e.protocol?{type:"socks",host:e.host,port:e.port,proxyDNS:!!e.proxyDNS,username:e.username,password:e.password}:{type:e.protocol,host:e.host,port:e.port}}static onProxyError(e){i.Debug.error(`Proxy error: ${e.message}`,e)}}},"./src/core/ProxyEngineSpecialRequests.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{ProxyEngineSpecialRequests:()=>s});class s{static setSpecialUrl(e,t,r){s.SpecialUrls[e]={applyMode:t,selectedProxy:r}}static retrieveSpecialUrlMode(e,t=!0){var r=s.SpecialUrls[e];return r?(t&&delete s.SpecialUrls[e],r):null}}s.SpecialUrls={}},"./src/core/ProxyRules.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{ProxyRules:()=>l});var s=r("./src/lib/Debug.ts"),i=r("./src/core/definitions.ts"),n=r("./src/lib/Utils.ts"),o=r("./src/core/SettingsOperation.ts"),a=r("./src/lib/environment.ts");class l{static compileRules(e,t){if(!t)return;let r=[],s=[];for(let a=0;a<t.length;a++){const l=t[a];if(!l.enabled)continue;let u=new i.CompiledProxyRule;if(u.ruleId=l.ruleId,u.whiteList=l.whiteList,u.hostName=l.hostName,u.proxy=l.proxy,l.proxyServerId==i.ProxyRuleSpecialProxyServer.DefaultGeneral)u.proxy=null;else if(l.proxyServerId==i.ProxyRuleSpecialProxyServer.ProfileProxy&&e.profileProxyServerId){let t=o.SettingsOperation.findProxyServerById(e.profileProxyServerId);t&&(u.proxy=t)}switch(u.compiledRuleSource=i.CompiledProxyRuleSource.Rules,l.ruleType){case i.ProxyRuleType.Exact:u.search=l.ruleExact.toLowerCase(),u.compiledRuleType=i.CompiledProxyRuleType.Exact;break;case i.ProxyRuleType.DomainSubdomain:u.search=l.ruleSearch.toLowerCase(),u.compiledRuleType=i.CompiledProxyRuleType.SearchDomainSubdomain;break;case i.ProxyRuleType.MatchPatternHost:{let e=n.Utils.matchPatternToRegExp(l.rulePattern,!1,!0);if(null==e)continue;u.regex=e,u.compiledRuleType=i.CompiledProxyRuleType.RegexHost}break;case i.ProxyRuleType.MatchPatternUrl:{let e=n.Utils.matchPatternToRegExp(l.rulePattern,!0,!1);if(null==e)continue;u.regex=e,u.compiledRuleType=i.CompiledProxyRuleType.RegexUrl}break;case i.ProxyRuleType.RegexHost:u.regex=new RegExp(l.ruleRegex,"i"),u.compiledRuleType=i.CompiledProxyRuleType.RegexHost;break;case i.ProxyRuleType.RegexUrl:u.regex=new RegExp(l.ruleRegex),u.compiledRuleType=i.CompiledProxyRuleType.RegexUrl;break;case i.ProxyRuleType.DomainExact:u.search=l.ruleSearch.toLowerCase(),u.compiledRuleType=i.CompiledProxyRuleType.SearchDomain;break;case i.ProxyRuleType.DomainAndPath:u.search=l.ruleSearch.toLowerCase(),u.compiledRuleType=i.CompiledProxyRuleType.SearchDomainAndPath;break;case i.ProxyRuleType.DomainSubdomainAndPath:u.search=l.ruleSearch.toLowerCase(),u.compiledRuleType=i.CompiledProxyRuleType.SearchDomainSubdomainAndPath;break;case i.ProxyRuleType.SearchUrl:u.search=l.ruleSearch.toLowerCase(),u.compiledRuleType=i.CompiledProxyRuleType.SearchUrl;break;default:continue}l.whiteList?s.push(u):r.push(u)}return{compiledList:r,compiledWhiteList:s}}static compileRulesSubscription(e,t=null){if(!e)return[];let r=[];for(const n of e){let e=new i.CompiledProxyRule;switch(e.search=n.search,e.compiledRuleSource=i.CompiledProxyRuleSource.Subscriptions,!0===t&&(e.whiteList=!0),e.compiledRuleType=n.importedRuleType,n.importedRuleType){case i.CompiledProxyRuleType.RegexHost:e.regex=new RegExp(n.regex,"i");break;case i.CompiledProxyRuleType.RegexUrl:e.regex=new RegExp(n.regex);break;case i.CompiledProxyRuleType.Exact:case i.CompiledProxyRuleType.SearchUrl:case i.CompiledProxyRuleType.SearchDomain:case i.CompiledProxyRuleType.SearchDomainSubdomain:case i.CompiledProxyRuleType.SearchDomainAndPath:case i.CompiledProxyRuleType.SearchDomainSubdomainAndPath:break;default:s.Debug.error("compileRulesSubscription: Invalid importedRuleType of "+n.importedRuleType);continue}r.push(e)}return r}static findMatchedDomainListInRulesInfo(e,t){let r=[];for(const s of e){let e=l.findMatchedDomainInRulesInfo(s,t);r.push(e)}return r}static findMatchedDomainInRulesInfo(e,t){let r=e.toLowerCase();return r.includes(":/")||(r="http://"+r),l.findMatchedUrlInRulesInfo(r,t)}static findMatchedUrlInRulesInfo(e,t){let r=l.findMatchedUrlInRules(e,t.WhitelistRules);if(r)return{compiledRule:r,matchedRuleSource:i.CompiledProxyRulesMatchedSource.WhitelistRules};let s=l.findMatchedUrlInRules(e,t.Rules);if(s)return{compiledRule:s,matchedRuleSource:i.CompiledProxyRulesMatchedSource.Rules};let n=l.findMatchedUrlInRules(e,t.WhitelistSubscriptionRules);if(n)return{compiledRule:n,matchedRuleSource:i.CompiledProxyRulesMatchedSource.WhitelistSubscriptionRules};let o=l.findMatchedUrlInRules(e,t.SubscriptionRules);return o?{compiledRule:o,matchedRuleSource:i.CompiledProxyRulesMatchedSource.SubscriptionRules}:null}static findMatchedDomainRule(e,t){let r=e.toLowerCase();return r.includes(":/")||(r="http://"+r),l.findMatchedUrlInRules(r,t)}static findMatchedUrlInRules(e,t){if(null==t||0==t.length)return null;let r,o,a=e.toLowerCase();try{for(let s of t)switch(s.compiledRuleType){case i.CompiledProxyRuleType.SearchDomainSubdomain:if(null==r&&(r=n.Utils.extractHostNameFromUrl(a),null==r))continue;if(r==s.search)return s;if(r.endsWith("."+s.search))return s;break;case i.CompiledProxyRuleType.Exact:if(a==s.search)return s;break;case i.CompiledProxyRuleType.RegexHost:if(null==r&&(r=n.Utils.extractHostNameFromUrl(a),null==r))continue;if(s.regex.test(r))return s;break;case i.CompiledProxyRuleType.RegexUrl:if(s.regex.test(e))return s;break;case i.CompiledProxyRuleType.SearchUrl:if(a.startsWith(s.search))return s;break;case i.CompiledProxyRuleType.SearchDomain:if(null==r&&(r=n.Utils.extractHostNameFromUrl(a),null==r))continue;if(s.search==r)return s;break;case i.CompiledProxyRuleType.SearchDomainAndPath:if(null==o&&(o=n.Utils.removeSchemaFromUrl(a),null==o))continue;if(o.startsWith(s.search))return s;break;case i.CompiledProxyRuleType.SearchDomainSubdomainAndPath:if(null==o&&(o=n.Utils.removeSchemaFromUrl(a),null==o))continue;if(o.startsWith(s.search))return s;let t=n.Utils.extractHostNameFromInvalidUrl(s.search);if(null!=t){if(null==r&&(r=n.Utils.extractHostNameFromUrl(a),null==r))continue;if(t!=r&&!r.endsWith("."+t))continue}if(o.includes("."+s.search))return s}if(null!=r){let e=n.Utils.extractHostFromUrl(a);if(e!=r){r=e;for(let e of t)switch(e.compiledRuleType){case i.CompiledProxyRuleType.SearchDomainSubdomain:if(r==e.search)return e;if(r.endsWith("."+e.search))return e;break;case i.CompiledProxyRuleType.RegexHost:if(e.regex.test(r))return e;break;case i.CompiledProxyRuleType.SearchDomain:if(e.search==r)return e;break;case i.CompiledProxyRuleType.SearchDomainSubdomainAndPath:if(null==o&&(o=n.Utils.removeSchemaFromUrl(a),null==o))continue;if(o.startsWith(e.search))return e;let t=n.Utils.extractHostFromInvalidUrl(e.search);if(null!=t&&t!=r&&!r.endsWith("."+t))continue;if(o.includes("."+e.search))return e;case i.CompiledProxyRuleType.Exact:case i.CompiledProxyRuleType.RegexUrl:case i.CompiledProxyRuleType.SearchUrl:case i.CompiledProxyRuleType.SearchDomainAndPath:}}}}catch(t){s.Debug.warn(`findMatchForUrl failed for ${e}`,t)}return null}static validateRule(e){return e.hostName&&!n.Utils.isValidHost(e.hostName)?{success:!1,message:a.api.i18n.getMessage("settingsRuleSourceInvalidFormat").replace("{0}",e.hostName)}:e.rule?(null==e.enabled&&(e.enabled=!0),{success:!0}):{success:!1,message:a.api.i18n.getMessage("settingsRulePatternIsEmpty")}}}},"./src/core/Settings.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{Settings:()=>d});var s=r("./src/lib/PolyFill.ts"),i=r("./src/core/definitions.ts"),n=r("./src/lib/Debug.ts"),o=r("./src/core/SettingsOperation.ts"),a=r("./src/lib/environment.ts"),l=r("./src/lib/Utils.ts"),u=r("./src/core/ProfileOperations.ts");const c=o.SettingsOperation;class d{static initialize(){p.current=new i.SettingsConfig,s.PolyFill.storageLocalGet(null,p.onInitializeGetLocalData,p.onInitializeGetLocalError),a.api.storage.onChanged.addListener(o.SettingsOperation.syncOnChanged)}static addInitializeCompletedEventListener(e){p.onInitializedCompleted.addEventListener("onInitializedCompleted",e,{passive:!0,once:!0})}static removeInitializeCompletedEventListener(e){p.onInitializedCompleted.removeEventListener("onInitializedCompleted",e)}static raiseInitializeCompletedEvent(){p.onInitializedCompleted.dispatchEvent(new Event("onInitializedCompleted"))}static onInitializeGetLocalData(e){n.Debug.log("onInitializeGetLocalData, local data:",JSON.stringify(e)),e=p.getRestorableSettings(e),c.copyNonSyncableSettings(e,p.current),p.current=e,p.updateActiveSettings(),o.SettingsOperation.saveAllLocal(!0),p.cleanupLocalOldVersionResidueFromStorage(),s.PolyFill.storageSyncGet(null,p.onInitializeGetSyncData,p.onInitializeGetSyncError),p.onInitializedLocally&&p.onInitializedLocally()}static onInitializeGetLocalError(e){n.Debug.error(`settingsOperation.initialize error: ${e.message}`),p.onInitializedLocally&&p.onInitializedLocally(),p.raiseInitializeCompletedEvent()}static onInitializeGetSyncData(e){try{let t=l.Utils.decodeSyncData(e);n.Debug.log("onInitializeGetSyncData, sync data: ",JSON.stringify(t)),t&&t.options&&(t.options.syncSettings?(t=p.getRestorableSettings(t),p.revertSyncOptions(t),c.copyNonSyncableSettings(t,p.current),p.current=t):t.options.syncSettings=!1,p.currentOptionsSyncSettings=t.options.syncSettings,p.updateActiveSettings())}catch(t){n.Debug.error(`settingsOperation.readSyncedSettings> onGetSyncData error: ${t} \r\n`,JSON.stringify(e))}p.onInitializedRemoteSync&&p.onInitializedRemoteSync(),p.raiseInitializeCompletedEvent()}static onInitializeGetSyncError(e){n.Debug.error(`settingsOperation.readSyncedSettings error: ${e.message}`),p.raiseInitializeCompletedEvent()}static getRestorableSettings(e){return p.setDefaultSettings(e),p.migrateFromOldVersions(e),p.ensureIntegrityOfSettings(e),e}static setDefaultSettings(e){e.product="SmartProxy",e.version=null,null==e.activeProfileId&&(e.activeProfileId=i.SmartProfileTypeBuiltinIds.Direct),null==e.defaultProxyServerId&&(e.defaultProxyServerId=null),null==e.options&&(e.options=new i.GeneralOptions),null==e.options.themeType&&(e.options.themeType=i.ThemeType.Auto),e.options.themesDark||(e.options.themesDark=i.GeneralOptions.defaultDarkThemeName),null==e.firstEverInstallNotified&&(e.firstEverInstallNotified=!1),null!=e.proxyServers&&Array.isArray(e.proxyServers)||(e.proxyServers=[]),null!=e.proxyProfiles&&Array.isArray(e.proxyProfiles)?e.proxyProfiles=p.setDefaultSettingsSmartProfiles(e.proxyProfiles):e.proxyProfiles=(0,i.getBuiltinSmartProfiles)(),null!=e.proxyServerSubscriptions&&Array.isArray(e.proxyServerSubscriptions)||(e.proxyServerSubscriptions=[]),s.PolyFill.getExtensionVersion((t=>{e.version=t}))}static ensureIntegrityOfSettings(e){if(e.proxyServers&&e.proxyServers.length){let t=[];o.SettingsOperation.sortProxyServers(e.proxyServers);let r=0;for(const s of e.proxyServers){let e=new i.ProxyServer;e.CopyFrom(s),e.isValid()&&(e.order=r,t.push(e),r++)}e.proxyServers=t}!e.defaultProxyServerId&&e.proxyServers?.length&&(e.defaultProxyServerId=e.proxyServers[0].id)}static migrateFromOldVersions(e){if(e.version<="0.9.9999"){let t=new i.GeneralOptions;if(e.options&&t.CopyFrom(e.options),e.options=t,e.proxyServers&&e.proxyServers.length){let t=[];for(const r of e.proxyServers){let e=new i.ProxyServer;e.CopyFrom(r),e.isValid()&&t.push(e)}e.proxyServers=t}if(e.proxyServerSubscriptions&&e.proxyServerSubscriptions.length){let t=[];for(const r of e.proxyServerSubscriptions){let e=new i.ProxyServerSubscription;e.CopyFrom(r),e.isValid()&&t.push(e)}e.proxyServerSubscriptions=t}}if(e.proxyProfiles){let t=e.proxyProfiles;for(const e of t)e.profileId||(n.Debug.warn("Found and fixed a profile without id> ",e.profileName),u.ProfileOperations.ensureProfileId(e)),t.find((t=>t.profileName==e.profileName&&t.profileId!=e.profileId))&&(n.Debug.warn("Found and fixed a profile with same name> ",e.profileName),e.profileName+=" - "+e.profileId)}if(e.proxyRules&&e.proxyRules.length&&e.proxyProfiles){let t=e.proxyProfiles.find((e=>e.profileType==i.SmartProfileType.SmartRules));if(t){for(const r of e.proxyRules){let e=new i.ProxyRule;e.CopyFrom(r),e.isValid()&&t.proxyRules.push(e)}delete e.proxyRules;let r=e.proxyRulesSubscriptions;if(r&&r.length){t.rulesSubscriptions=t.rulesSubscriptions||[];for(const e of r){let r=new i.ProxyRulesSubscription;r.CopyFrom(e),r.isValid()&&t.rulesSubscriptions.push(r)}}delete e.proxyRulesSubscriptions}else n.Debug.warn("Migrate has failed for SmartRules because no SmartRules is found in the new configuration")}if(e.bypass&&e.bypass.bypassList&&e.bypass.bypassList.length&&e.proxyProfiles){let t=e.proxyProfiles.find((e=>e.profileType==i.SmartProfileType.AlwaysEnabledBypassRules));if(t){let r=null==e.bypass.enableForAlways||e.bypass.enableForAlways;for(const s of e.bypass.bypassList){if(!s)continue;let e=new i.ProxyRule;e.ruleType=i.ProxyRuleType.DomainSubdomain,e.ruleSearch=s,e.hostName=s,e.enabled=r,e.whiteList=!0,t.proxyRules.push(e)}}else n.Debug.warn("Migrate has failed for AlwaysEnabledRules because no AlwaysEnabledRules is found in the new configuration");delete e.bypass}if(null!=e.proxyMode&&e.proxyProfiles){let t=-1;switch(+e.proxyMode){case 0:t=i.SmartProfileType.Direct;break;case 1:t=i.SmartProfileType.SmartRules;break;case 2:t=i.SmartProfileType.AlwaysEnabledBypassRules;break;case 3:t=i.SmartProfileType.SystemProxy}if(t>=0){let r=e.proxyProfiles.find((e=>e.profileType==t));r&&(e.activeProfileId=r.profileId)}delete e.proxyMode}if(e.activeProxyServer&&e.activeProxyServer.name&&e.proxyServers.length&&e.proxyServers){let t=e.activeProxyServer.name,r=e.proxyServers.find((e=>e.name==t));r&&(e.defaultProxyServerId=r.id),delete e.activeProxyServer}}static cleanupLocalOldVersionResidueFromStorage(){s.PolyFill.storageLocalGet(null,(function(e){s.PolyFill.storageLocalRemove(["proxyRules","proxyRulesSubscriptions","bypass","proxyMode","activeProxyServer"])}))}static revertSyncOptions(e){let t=p.current;e.options.syncActiveProxy=t.options.syncActiveProxy,e.options.syncActiveProfile=t.options.syncActiveProfile,t.options.syncActiveProxy||(e.defaultProxyServerId=t.defaultProxyServerId),t.options.syncActiveProfile||(e.activeProfileId=t.activeProfileId)}static setDefaultSettingsSmartProfiles(e){let t,r=!1,s=!1,n=!1,o=!1,a=[];for(const t of e){if(null==t.profileType)continue;let u=(0,i.getSmartProfileTypeConfig)(t.profileType);if(null==u)continue;t.profileType==i.SmartProfileType.Direct?r=!0:t.profileType==i.SmartProfileType.SmartRules?s=!0:t.profileType==i.SmartProfileType.AlwaysEnabledBypassRules?n=!0:t.profileType==i.SmartProfileType.SystemProxy&&(o=!0);let c=t.profileTypeConfig?.builtin||!1,d=new i.SmartProfile;if(Object.assign(d,t),d.profileTypeConfig=u,!c&&u.builtin){let r=e.find((e=>e.profileType==t.profileType&&e.profileId!=t.profileId));r&&r.profileTypeConfig?.builtin?(d.profileTypeConfig.builtin=!1,t.profileTypeConfig.builtin=!1):(d.profileTypeConfig.builtin=!0,t.profileTypeConfig.builtin=!0)}d.profileName||(d.profileName=`${i.SmartProfileType[d.profileType]} - ${l.Utils.getNewUniqueIdNumber()}`),a.push(d)}return!(r&&s&&n&&o)&&(t=(0,i.getBuiltinSmartProfiles)(),r||a.push(t.find((e=>e.profileType==i.SmartProfileType.Direct))),s||a.push(t.find((e=>e.profileType==i.SmartProfileType.SmartRules))),n||a.push(t.find((e=>e.profileType==i.SmartProfileType.AlwaysEnabledBypassRules))),o||a.push(t.find((e=>e.profileType==i.SmartProfileType.SystemProxy))),a.sort(((e,t)=>e.profileType<t.profileType?-1:e.profileType>t.profileType?1:0))),a}static validateProxyServer(e,t=!0){if(e.port<=0||e.port>65535)return{success:!1,message:a.api.i18n.getMessage("settingsServerPortInvalid").replace("{0}",`${e.host}:${e.port}`)};if(!e.host||!l.Utils.isValidHost(e.host))return{success:!1,message:a.api.i18n.getMessage("settingsServerHostInvalid").replace("{0}",`${e.host}:${e.port}`)};if(!e.name)return{success:!1,message:a.api.i18n.getMessage("settingsServerNameRequired")};if(p.current&&t){const t=p.current.proxyServers;for(let r of t)if(r.name==e.name)return{success:!1,exist:!0,message:`Server name ${e.name} already exists`}}return e.protocol?(e.protocol=e.protocol.toUpperCase(),-1==i.proxyServerProtocols.indexOf(e.protocol)&&(e.protocol="HTTP")):e.protocol="HTTP",{success:!0}}static updateActiveSettings(e=!0){let t=p.current;if(!t)return;let r=p.active??(p.active=new i.SettingsActive),s=u.ProfileOperations.findSmartProfileById(t.activeProfileId,t.proxyProfiles);!s&&e&&(s=u.ProfileOperations.findSmartProfileById(i.SmartProfileTypeBuiltinIds.Direct,t.proxyProfiles));let n=null;if(s&&(r.activeProfile=u.ProfileOperations.compileSmartProfile(s),n=r.activeProfile),r.currentProxyServer=null,n?.profileProxyServer&&(r.currentProxyServer=r.activeProfile.profileProxyServer),!r.currentProxyServer){let e=o.SettingsOperation.findProxyServerById(t.defaultProxyServerId);e&&(r.currentProxyServer=e)}let a=null;if(t.options.activeIncognitoProfileId)if(s.profileId==t.options.activeIncognitoProfileId)a=n;else{const e=u.ProfileOperations.findSmartProfileById(t.options.activeIncognitoProfileId,t.proxyProfiles);e&&(a=u.ProfileOperations.compileSmartProfile(e))}r.activeIncognitoProfile=a;let l=u.ProfileOperations.getIgnoreFailureRulesProfile();l&&(r.currentIgnoreFailureProfile=u.ProfileOperations.compileSmartProfile(l))}}d.currentOptionsSyncSettings=!0,d.onInitializedLocally=null,d.onInitializedRemoteSync=null,d.onInitializedCompleted=new EventTarget;let p=d},"./src/core/SettingsOperation.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{SettingsOperation:()=>y});var s=r("./src/lib/environment.ts"),i=r("./src/lib/PolyFill.ts"),n=r("./src/lib/Debug.ts"),o=r("./src/core/Settings.ts"),a=r("./src/lib/Utils.ts"),l=r("./src/core/definitions.ts"),u=r("./src/core/ProxyEngine.ts"),c=r("./src/core/ProxyRules.ts"),d=r("./src/core/SubscriptionUpdater.ts"),p=r("./src/core/ProfileOperations.ts");const h=d.SubscriptionUpdater,f=u.ProxyEngine,m=i.PolyFill,g=a.Utils;class y{static getStrippedSyncableSettings(e){let t=JSON.parse(JSON.stringify(e));if(t.proxyProfiles&&t.proxyProfiles.length)for(const e of t.proxyProfiles)if(e.rulesSubscriptions&&e.rulesSubscriptions.length)for(const t of e.rulesSubscriptions)t.proxyRules=[],t.whitelistRules=[];if(t.proxyServerSubscriptions&&t.proxyServerSubscriptions.length)for(const e of t.proxyServerSubscriptions)e.proxies=[];return t}static copyNonSyncableSettings(e,t){if(e.proxyProfiles&&e.proxyProfiles.length)for(const r of e.proxyProfiles)if(r.rulesSubscriptions&&r.rulesSubscriptions.length)for(const e of r.rulesSubscriptions){if(!e.enabled)continue;let s=t.proxyProfiles.find((e=>e.profileId==r.profileId));if(!s)continue;let i=s.rulesSubscriptions.find((t=>t.id==e.id));i&&(i.proxyRules&&i.proxyRules.length?e.proxyRules=i.proxyRules:e.proxyRules=e.proxyRules||[],i.whitelistRules&&i.whitelistRules.length?e.whitelistRules=i.whitelistRules:e.whitelistRules=e.whitelistRules||[])}if(e.proxyServerSubscriptions&&e.proxyServerSubscriptions.length)for(const r of e.proxyServerSubscriptions){r.proxies=[];let e=t.proxyServerSubscriptions.find((e=>e.name==r.name&&e.url==r.url));e&&e.proxies&&e.proxies.length&&(r.proxies=e.proxies)}}static getBackupOfSettings(e){let t=y.getStrippedSyncableSettings(e);return t.configVersion=void 0,t.syncHash=void 0,t}static readSyncedSettings(e){m.storageSyncGet(null,(function(t){try{let r=g.decodeSyncData(t);if(r&&r.options){if(r.syncHash==o.Settings.current.syncHash)return void n.Debug.log("SyncHash is same, ignoring the sync data.",o.Settings.current.syncHash);r.options.syncSettings?(r=o.Settings.getRestorableSettings(r),o.Settings.revertSyncOptions(r),b.copyNonSyncableSettings(r,o.Settings.current),o.Settings.current=r):(r.options.syncSettings=!1,r=o.Settings.getRestorableSettings(r)),o.Settings.currentOptionsSyncSettings=r.options.syncSettings,o.Settings.updateActiveSettings(),e&&e()}}catch(e){n.Debug.error(`SettingsOperation.readSyncedSettings> onGetSyncData error: ${e} \r\n`,JSON.stringify(t))}}),(function(e){n.Debug.error(`SettingsOperation.readSyncedSettings error: ${e.message}`)}))}static initialize(e){function t(t){try{let e=g.decodeSyncData(t);e&&e.options&&(e.options.syncSettings?(e=o.Settings.getRestorableSettings(e),o.Settings.revertSyncOptions(e),b.copyNonSyncableSettings(e,o.Settings.current),o.Settings.current=e):(e.options.syncSettings=!1,e=o.Settings.getRestorableSettings(e)),o.Settings.currentOptionsSyncSettings=e.options.syncSettings,o.Settings.updateActiveSettings())}catch(e){n.Debug.error(`SettingsOperation.onGetSyncData error: ${e} \r\n ${t}`)}e&&e()}function r(t){n.Debug.error(`SettingsOperation.initialize error: ${t.message}`),e&&e()}m.storageLocalGet(null,(function(e){e=o.Settings.getRestorableSettings(e),b.copyNonSyncableSettings(e,o.Settings.current),o.Settings.current=e,m.storageSyncGet(null,t,r)}),(function(e){n.Debug.error(`SettingsOperation.initialize error: ${e.message}`)}))}static findProxyServerByIdFromList(e,t,r){if(t){let r=t.find((t=>t.id===e));if(void 0!==r)return r}if(r)for(let t of r){let r=t.proxies.find((t=>t.id===e));if(void 0!==r)return r}return null}static findProxyServerByName(e){let t=o.Settings.current.proxyServers.find((t=>t.name===e));if(void 0!==t)return t;for(let r of o.Settings.current.proxyServerSubscriptions)if(t=r.proxies.find((t=>t.name===e)),void 0!==t)return t;return null}static findProxyServerById(e){let t=o.Settings.current.proxyServers.find((t=>t.id===e));if(void 0!==t)return t;for(let r of o.Settings.current.proxyServerSubscriptions)if(t=r.proxies.find((t=>t.id===e)),void 0!==t)return t;return null}static sortProxyServers(e){e&&e.sort(((e,t)=>(e.order??0)>t.order?1:(e.order??0)<t.order?-1:0))}static getAllSubscribedProxyServers(){if(!o.Settings.current.proxyServerSubscriptions||!o.Settings.current.proxyServerSubscriptions.length)return[];let e=[];for(let t of o.Settings.current.proxyServerSubscriptions)t.enabled&&(e=e.concat(t.proxies));return e}static getFirstProxyServer(){let e=o.Settings.current;if(e.proxyServers&&e.proxyServers.length)return e.proxyServers[0];if(e.proxyServerSubscriptions)for(const t of e.proxyServerSubscriptions)if(t.proxies&&t.proxies.length)return t.proxies[0];return null}static getLastProxyServer(){let e=o.Settings.current;if(e.proxyServers&&e.proxyServers.length)return e.proxyServers[e.proxyServers.length-1];if(e.proxyServerSubscriptions)for(let t=e.proxyServerSubscriptions.length-1;t>=0;t--){const r=e.proxyServerSubscriptions[t];if(r.proxies&&r.proxies.length)return r.proxies[r.proxies.length-1]}return null}static findNextProxyServerByCurrentProxyId(e){let t=o.Settings.current,r=t.proxyServers.findIndex((t=>t.id===e));if(r>-1&&r+1<t.proxyServers.length)return t.proxyServers[r+1];for(let t of o.Settings.current.proxyServerSubscriptions)if(r=t.proxies.findIndex((t=>t.id===e)),r>-1&&r+1<t.proxies.length)return t.proxies[r+1];return null}static findPreviousProxyServerByCurrentProxyId(e){let t=o.Settings.current,r=t.proxyServers.findIndex((t=>t.id===e));if(r>0)return t.proxyServers[r-1];for(let t of o.Settings.current.proxyServerSubscriptions)if(r=t.proxies.findIndex((t=>t.id===e)),r>0)return t.proxies[r-1];return null}static syncOnChanged(e,t){"sync"===t&&(n.Debug.log("syncOnChanged ",t,e),y.readSyncedSettings((()=>{y.saveAllLocal(!0),f.notifyProxyRulesChanged(),h.reloadEmptyServerSubscriptions(),h.reloadEmptyRulesSubscriptions()})))}static saveAllSync(e=!0){if(o.Settings.current.syncHash=a.Utils.getNewUniqueIdString(),b.saveAllLocal(!0),(o.Settings.current.options.syncSettings||o.Settings.currentOptionsSyncSettings)&&e){var t=b.getStrippedSyncableSettings(o.Settings.current);let e=g.encodeSyncData(t);try{m.storageSyncSet(e,(()=>{o.Settings.currentOptionsSyncSettings=o.Settings.current.options.syncSettings}),(t=>{n.Debug.error(`SettingsOperation.saveAllSync error: ${t.message} `,e)}))}catch(e){n.Debug.error(`SettingsOperation.saveAllSync error: ${e}`)}}}static saveAllLocal(e=!1){!e&&o.Settings.current.options.syncSettings||m.storageLocalSet(o.Settings.current,null,(e=>{n.Debug.error("SettingsOperation.saveAllLocal error:",e)}))}static saveOptions(){o.Settings.current.options.syncSettings||m.storageLocalSet({options:o.Settings.current.options},null,(e=>{n.Debug.error(`SettingsOperation.saveOptions error: ${e.message}`)}))}static saveSmartProfiles(){o.Settings.current.options.syncSettings||m.storageLocalSet({proxyProfiles:o.Settings.current.proxyProfiles},null,(e=>{n.Debug.error(`SettingsOperation.saveProxyProfiles error: ${e.message}`)}))}static saveProxyServers(){o.Settings.current.options.syncSettings||m.storageLocalSet({proxyServers:o.Settings.current.proxyServers},null,(e=>{n.Debug.error(`SettingsOperation.saveRules error: ${e.message}`)}))}static saveProxyServerSubscriptions(){o.Settings.current.options.syncSettings||m.storageLocalSet({proxyServerSubscriptions:o.Settings.current.proxyServerSubscriptions},null,(e=>{n.Debug.error(`SettingsOperation.proxyServerSubscriptions error: ${e.message}`)}))}static saveDefaultProxyServer(){o.Settings.current.options.syncSettings||m.storageLocalSet({defaultProxyServerId:o.Settings.current.defaultProxyServerId},null,(e=>{n.Debug.error(`SettingsOperation.saveDefaultProxyServer error: ${e.message}`)}))}static saveActiveProfile(){o.Settings.current.options.syncSettings||m.storageLocalSet({activeProfileId:o.Settings.current.activeProfileId},null,(e=>{n.Debug.error(`SettingsOperation.saveActiveProfile error: ${e.message}`)}))}static saveUpdateInfo(e){o.Settings.current.updateInfo=e,b.saveAllSync()}static updateSmartProfilesRulesProxyServer(){const e=o.Settings.current.proxyServers,t=o.Settings.current.proxyServerSubscriptions,r=o.Settings.current.proxyProfiles;for(const s of r)if(s.proxyRules)for(const r of s.proxyRules){if(!r.proxyServerId){r.proxy=null;continue}let s=y.findProxyServerByIdFromList(r.proxyServerId,e,t);s?r.proxy=s:(r.proxy=null,r.proxyServerId=null)}}static restoreBackup(e){if(null==e)return{success:!1,message:"Invalid data"};let t=y.restoreBackupFromFile(e);if(!t.success)return t;let r=t.config;return o.Settings.current=r,y.saveAllSync(),f.updateBrowsersProxyConfig(),o.Settings.updateActiveSettings(),{success:!0,message:s.api.i18n.getMessage("settingsRestoreSettingsSuccess")}}static restoreBackupFromFile(e){let t,r=o.Settings.current;try{try{t=JSON.parse(e)}catch(t){return n.Debug.error("Backup data is invalid or corrupted",t,e),{success:!1,message:s.api.i18n.getMessage("settingsRestoreSettingsFailedInvalid")}}if(!t.version)return n.Debug.error("Backup data is missing `Version` field",e),{success:!1,message:s.api.i18n.getMessage("settingsRestoreSettingsFailedInvalid")};let a=new l.SettingsConfig;a.CopyFrom(r),Object.assign(a,t),o.Settings.setDefaultSettings(a),a.version=t.version,o.Settings.migrateFromOldVersions(a);let u=new l.SettingsConfig;if(u.CopyFrom(a),a=u,t.options&&a.options.CopyFrom(t.options),t.proxyServers&&Array.isArray(t.proxyServers)&&t.proxyServers.length){let e=[];for(const r of t.proxyServers){let t=new l.ProxyServer;t.CopyFrom(r),t.isValid()&&e.push(t)}a.proxyServers=e}if(t.proxyServerSubscriptions&&Array.isArray(t.proxyServerSubscriptions)&&t.proxyServerSubscriptions.length){let e=[];for(let r of t.proxyServerSubscriptions){let t=new l.ProxyServerSubscription;t.CopyFrom(r),e.push(t)}a.proxyServerSubscriptions=e}if(t.proxyProfiles&&Array.isArray(t.proxyProfiles)&&t.proxyProfiles.length){let e=[];for(let r of t.proxyProfiles){let t=new l.SmartProfile;p.ProfileOperations.copySmartProfile(r,t,!1),p.ProfileOperations.resetProfileTypeConfig(t),e.push(t)}a.proxyProfiles=e}if(t.activeProfileId&&a.proxyProfiles){let e=a.proxyProfiles.find((e=>e.profileId==t.activeProfileId));e&&(a.activeProfileId=e.profileId)}if(t.defaultProxyServerId){let e=y.findProxyServerByIdFromList(t.defaultProxyServerId,a.proxyServers,a.proxyServerSubscriptions);e&&(a.defaultProxyServerId=e.id)}return a.version=r.version,i.PolyFill.getExtensionVersion((e=>{a.version=e})),o.Settings.ensureIntegrityOfSettings(a),{success:!0,config:a}}catch(t){return n.Debug.error("Backup restore failed",t,e),{success:!1,message:s.api.i18n.getMessage("settingsRestoreSettingsFailed")}}}static factoryReset(){let e=new l.SettingsConfig;o.Settings.setDefaultSettings(e),o.Settings.current=e,y.saveAllSync(),f.updateBrowsersProxyConfig(),o.Settings.updateActiveSettings()}static restoreBackup_OLD(e){if(null==e)return{success:!1,message:"Invalid data"};try{let r,i,n,a,u,d,m=JSON.parse(e);if(null!=m.options&&"object"==typeof m.options){let e=function(e){let t=new l.GeneralOptions;return t.CopyFrom(e),{success:!0,result:t}}(m.options);if(!e.success)return e;r=e.result}if(null!=m.proxyServers&&Array.isArray(m.proxyServers)){let e=function(e){let t=[];for(let r of e){let e=new l.ProxyServer;e.CopyFrom(r);let s=o.Settings.validateProxyServer(e,!1);if(!s.success){if(s.exist)continue;return s}t.push(e)}return{success:!0,result:t}}(m.proxyServers);if(!e.success)return e;i=e.result}if(null!=m.proxyServerSubscriptions&&Array.isArray(m.proxyServerSubscriptions)){let e=function(e){let t=[];for(let r of e){let e=new l.ProxyServerSubscription;e.CopyFrom(r),t.push(e)}return{success:!0,result:t}}(m.proxyServerSubscriptions);if(!e.success)return e;n=e.result}if(null!=m.proxyProfiles&&Array.isArray(m.proxyProfiles)){let e=function(e){let t=[];for(let r of e){let e=new l.SmartProfile;p.ProfileOperations.copySmartProfile(r,e,!1);for(const t of e.proxyRules){let e=c.ProxyRules.validateRule(t);if(!e.success)return e}t.push(e)}return{success:!0,result:t}}(m.proxyProfiles);if(!e.success)return e;a=e.result}if(null!=m.defaultProxyServerId&&"string"==typeof m.defaultProxyServerId){let e=(t=m.defaultProxyServerId,null==y.findProxyServerById(t)?{success:!1,result:s.api.i18n.getMessage("settingsRestoreSettingsFailedInvalidDefaultProxyServer")}:{success:!0,result:t});if(!e.success)return e;u=e.result}if(null!=m.activeProfileId&&"string"==typeof m.activeProfileId){let e=function(e){return null==e||e<=0?{success:!1,message:s.api.i18n.getMessage("settingsRestoreSettingsFailedInvalidActiveProfile")}:{success:!0,result:e}}(m.activeProfileId);if(!e.success)return e;d=e.result}return null!=r&&(o.Settings.current.options=r,y.saveOptions()),null!=i&&(o.Settings.current.proxyServers=i,y.saveProxyServers()),null!=n&&(o.Settings.current.proxyServerSubscriptions=n,y.saveProxyServerSubscriptions(),h.setServerSubscriptionsRefreshTimers()),null!=a&&(o.Settings.current.proxyProfiles=a,y.saveSmartProfiles(),f.notifyProxyRulesChanged(),h.setRulesSubscriptionsRefreshTimers()),null!=u&&(o.Settings.current.defaultProxyServerId=u,y.saveDefaultProxyServer()),null!=d&&(o.Settings.current.activeProfileId=d,y.saveActiveProfile()),y.saveAllSync(),f.updateBrowsersProxyConfig(),o.Settings.updateActiveSettings(),{success:!0,message:s.api.i18n.getMessage("settingsRestoreSettingsSuccess")}}catch(t){return n.Debug.error("Backup restore failed",t,e),{success:!1,message:s.api.i18n.getMessage("settingsRestoreSettingsFailed")}}var t}}let b=y},"./src/core/SubscriptionUpdater.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{SubscriptionUpdater:()=>c});var s=r("./src/lib/Debug.ts"),i=r("./src/core/Settings.ts"),n=r("./src/lib/ProxyImporter.ts"),o=r("./src/core/SettingsOperation.ts"),a=r("./src/lib/RuleImporter.ts"),l=r("./src/core/ProxyEngine.ts"),u=r("./src/core/definitions.ts");class c{static async reloadEmptyServerSubscriptions(){for(let e of i.Settings.current.proxyServerSubscriptions)e.enabled&&(null!=e.proxies&&e.proxies.length||c.readServerSubscription(e.name))}static setServerSubscriptionsRefreshTimers(){let e=[];for(let t of i.Settings.current.proxyServerSubscriptions){if(s.DiagDebug?.trace("updateServerSubscriptions","enabled:"+t.enabled,"refreshRate:"+t.refreshRate),!(t.enabled&&t.refreshRate>0)){let e=c.getServerSubscriptionIdTimer(t.name);e?.timer&&(clearInterval(e.timer.timerId),c.serverSubscriptionTimers.splice(e.index,1));continue}e.push(t.name);let r=!1,i=c.getServerSubscriptionIdTimer(t.name);if(null==i?r=!0:i.timer.refreshRate!=t.refreshRate&&(r=!0,clearInterval(i.timer.timerId),c.serverSubscriptionTimers.splice(i.index,1)),r){let e=60*t.refreshRate*1e3,r=setInterval(c.readServerSubscription,e,t.name);c.serverSubscriptionTimers.push({timerId:r,subscriptionId:t.name,refreshRate:t.refreshRate})}}let t=c.serverSubscriptionTimers.filter((t=>-1!==e.indexOf(t.subscriptionId)||(clearInterval(t.timerId),!1)));c.serverSubscriptionTimers=t}static readServerSubscription(e){if(s.Debug.log("readServerSubscription",e),!e)return;let t=i.Settings.current.proxyServerSubscriptions.find((t=>t.name===e));if(!t){let t=c.getServerSubscriptionIdTimer(e);if(!t)return;return clearInterval(t.timer.timerId),void c.serverSubscriptionTimers.splice(t.index,1)}t.stats||(t.stats=new u.SubscriptionStats),n.ProxyImporter.readFromServer(t,(function(r){if(r)if(r.success){let e=r.result.length;t.proxies=r.result,t.totalCount=e,u.SubscriptionStats.updateStats(t.stats,!0),o.SettingsOperation.saveProxyServerSubscriptions(),o.SettingsOperation.saveAllSync(!1)}else u.SubscriptionStats.updateStats(t.stats,!1),s.Debug.warn("Failed to read proxy server subscription: "+e)}),(function(r){u.SubscriptionStats.updateStats(t.stats,!1,r),s.Debug.warn("Failed to read proxy server subscription: "+e,t,r)}))}static async reloadEmptyRulesSubscriptions(){for(const e of i.Settings.current.proxyProfiles)if(e.rulesSubscriptions)for(const t of e.rulesSubscriptions)t.enabled&&(null!=t.proxyRules&&t.proxyRules.length||null!=t.whitelistRules&&t.whitelistRules.length||c.readRulesSubscription(t))}static setRulesSubscriptionsRefreshTimers(){let e=[];for(const t of i.Settings.current.proxyProfiles)if(t.rulesSubscriptions)for(const r of t.rulesSubscriptions){if(!(r.enabled&&r.refreshRate>0)){let e=c.getRulesSubscriptionIdTimer(r.id);e?.timer&&(clearInterval(e.timer.timerId),c.rulesSubscriptionTimers.splice(e.index,1));continue}e.push(r.id);let t=!1,s=c.getRulesSubscriptionIdTimer(r.id);if(null==s?t=!0:s.timer.refreshRate!=r.refreshRate&&(t=!0,clearInterval(s.timer.timerId),c.rulesSubscriptionTimers.splice(s.index,1)),t){let e=60*r.refreshRate*1e3,t=setInterval(c.readRulesSubscription,e,r);c.rulesSubscriptionTimers.push({timerId:t,subscriptionId:r.id,refreshRate:r.refreshRate})}}let t=c.rulesSubscriptionTimers.filter((t=>-1!==e.indexOf(t.subscriptionId)||(clearInterval(t.timerId),!1)));c.rulesSubscriptionTimers=t}static readRulesSubscription(e){if(s.Debug.log("readRulesSubscription",e.name),e&&e.name){if(!e){let t=c.getRulesSubscriptionIdTimer(e.id);if(!t)return;return clearInterval(t.timer.timerId),void c.rulesSubscriptionTimers.splice(t.index,1)}e.stats||(e.stats=new u.SubscriptionStats),a.RuleImporter.readFromServerAndImport(e,(t=>{t&&(t.success?(e.proxyRules=t.rules.blackList,e.whitelistRules=t.rules.whiteList,e.totalCount=t.rules.blackList.length+t.rules.whiteList.length,u.SubscriptionStats.updateStats(e.stats,!0),o.SettingsOperation.saveProxyServerSubscriptions(),o.SettingsOperation.saveAllSync(!1),l.ProxyEngine.notifyProxyRulesChanged()):(u.SubscriptionStats.updateStats(e.stats,!1),s.Debug.warn("Failed to read proxy rules subscription: "+e.name)))}),(function(t){u.SubscriptionStats.updateStats(e.stats,!1,t),s.Debug.warn("Failed to read proxy rules subscription: "+e.name,e,t)}))}}static _getSubscriptionIdTimer(e,t){let r=e.findIndex((e=>e.subscriptionId===t));return r>=0?{timer:e[r],index:r}:null}static getServerSubscriptionIdTimer(e){return c._getSubscriptionIdTimer(c.serverSubscriptionTimers,e)}static getRulesSubscriptionIdTimer(e){return c._getSubscriptionIdTimer(c.rulesSubscriptionTimers,e)}}c.serverSubscriptionTimers=[{timerId:null,subscriptionId:null,refreshRate:null}],c.rulesSubscriptionTimers=[{timerId:null,subscriptionId:null,refreshRate:null}]},"./src/core/TabManager.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{TabDataStatuses:()=>d,TabDataType:()=>c,TabManager:()=>u});var s=r("./src/lib/PolyFill.ts"),i=r("./src/lib/LiteEvent.ts"),n=r("./src/core/definitions.ts"),o=r("./src/lib/environment.ts"),a=r("./src/core/Settings.ts"),l=r("./src/core/ProxyRules.ts");class u{static get TabRemoved(){return this.onTabRemoved.expose()}static get TabUpdated(){return this.onTabUpdated.expose()}static initializeTracking(){o.api.tabs.onActivated.addListener(u.updateActiveTab),o.api.tabs.onUpdated.addListener(u.handleTabUpdated),o.api.tabs.onUpdated.addListener(u.updateActiveTab),o.api.tabs.onRemoved.addListener(u.handleTabRemoved),o.api.windows&&o.api.windows.onFocusChanged.addListener(u.updateActiveTab),u.updateActiveTab()}static getOrSetTab(e,t=!0,r=null){let s=u.tabs[e];return null==s&&(s=new c(e),u.tabs[e]=s,r&&(s.url=r),t&&u.loadTabData(s)),s}static getTab(e){return u.tabs[e]}static getCurrentTab(){return u.currentTab}static updateTabData(e,t){if(!t)return null;let r=t.id;return e||(e=u.getOrSetTab(r,!1)),e.proxifiedParentDocumentUrl!=t.url&&(e.resetTabState(),u.setRuleForProxyPerOrigin(e,t.url)),e.updated=new Date,e.incognito=t.incognito,e.url=t.url,e.index=t.index,e.proxifiedParentDocumentUrl||(e.proxifiedParentDocumentUrl=t.url),u.tabs[r]=e,u.onTabUpdated.trigger(e),e}static setTabDataProxied(e,t,r){r?(e.proxified=r.whiteList?n.TabProxyStatus.Whitelisted:n.TabProxyStatus.Proxified,e.proxifiedParentDocumentUrl=t,e.proxyMatchedRule=r,e.proxyRuleHostName=r.hostName,r.proxy?e.proxyServerFromRule=r.proxy:e.proxyServerFromRule=null):e.resetTabState()}static setRuleForProxyPerOrigin(e,t){if(o.environment.chrome)return;if(1!=a.Settings.current.options?.proxyPerOrigin)return;let r=a.Settings.active;if(!r)return;let s=r.activeProfile,i=l.ProxyRules.findMatchedUrlInRulesInfo(t,s.compiledRules);if(null!=i){let r=i.compiledRule;u.setTabDataProxied(e,t,r)}}static updateActiveTab(){s.PolyFill.tabsQuery({active:!0,currentWindow:!0},(e=>{if(!e||!e.length)return;let t=e[0],r=u.updateTabData(null,t);u.currentTab=r}))}static loadTabData(e){s.PolyFill.tabsGet(e.tabId,(t=>{u.updateTabData(e,t)}))}static handleTabRemoved(e){let t=u.tabs[e];null!=t&&(delete u.tabs[e],u.onTabRemoved.trigger(t),t.clearFailedRequests())}static handleTabUpdated(e,t,r){let s=u.tabs[e],i=!1,n=!1;t.url&&null!=s&&t.url!=s.url&&(i=!0),i||"loading"!==t.status||(n=!0);let o=!1;n&&s&&(o=!0,s.resetFailedRequests()),i&&s&&(s.clearFailedRequests(),u.loadTabData(s),o=!0),o&&u.onTabUpdated.trigger(s)}}u.tabs={},u.onTabRemoved=new i.LiteEvent,u.onTabUpdated=new i.LiteEvent;class c{constructor(e){this.tabId=e,this.created=new Date,this.updated=new Date,this.url="",this.incognito=!1,this.failedRequests=new Map,this.proxified=n.TabProxyStatus.None,this.status=new d}clearFailedRequests(){this.failedRequests&&this.failedRequests.clear()}resetFailedRequests(){this.failedRequests&&this.failedRequests.forEach(((e,t,r)=>{e.hitCount=1}))}resetTabState(){this.proxified=n.TabProxyStatus.None,this.proxyServerFromRule=null,this.proxifiedParentDocumentUrl=null,this.status=new d}}class d{}},"./src/core/TabRequestLogger.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{TabRequestLogger:()=>d});var s=r("./src/core/TabManager.ts"),i=r("./src/lib/Utils.ts"),n=r("./src/lib/PolyFill.ts"),o=r("./src/lib/Debug.ts"),a=r("./src/core/ProxyRules.ts"),l=r("./src/core/definitions.ts"),u=r("./src/lib/environment.ts"),c=r("./src/core/Settings.ts");class d{static startTracking(){s.TabManager.TabRemoved.on(d.handleTabRemovedInternal),u.environment.chrome&&u.api.webRequest.onBeforeRequest.addListener(d.onBeforeRequestLogRequestInternal,{urls:l.monitorUrlsSchemaFilter})}static subscribeProxyableLogs(e){-1==d.subscribedTabList.indexOf(e)&&d.subscribedTabList.push(e)}static unsubscribeProxyableLogs(e){let t=d.subscribedTabList.indexOf(e);t>-1&&d.subscribedTabList.splice(t,1)}static handleTabRemovedInternal(e){d.notifyProxyableOriginTabRemoved(e.tabId),d.unsubscribeProxyableLogs(e.tabId)}static async notifyProxyableLog(e){0!=d.subscribedTabList.length&&-1!=d.subscribedTabList.indexOf(e.tabId)&&d.sendProxyableRequestLog(e)}static async sendProxyableRequestLog(e){n.PolyFill.runtimeSendMessage({command:l.CommandMessages.ProxyableRequestLog,tabId:e.tabId,logInfo:e},null,(t=>{d.unsubscribeProxyableLogs(e.tabId),o.Debug.error("sendProxyableRequestLog failed for ",e.tabId,t)}))}static onBeforeRequestLogRequestInternal(e){let t=e.tabId;t>-1&&0!=d.subscribedTabList.length&&-1!=d.subscribedTabList.indexOf(t)&&i.Utils.isValidUrl(e.url)&&d.notifyProxyableLogRequestInternal(e.url,t)}static async notifyProxyableLogRequestInternal(e,t){let r=d.getProxyableDataForUrl(e);r.tabId=t,d.sendProxyableRequestLog(r)}static notifyProxyableOriginTabRemoved(e){-1!=d.subscribedTabList.indexOf(e)&&n.PolyFill.runtimeSendMessage({command:l.CommandMessages.ProxyableOriginTabRemoved,tabId:e},null,(t=>{o.Debug.error("notifyProxyableOriginTabRemoved failed for ",e,t)}))}static getProxyableDataForUrl(e){let t=c.Settings.active.activeProfile;if(!t){let t=new l.ProxyableLogDataType;return t.url=e,t.ruleHostName="",t.rulePatternText="",t.proxifiedStatus=l.ProxyableProxifiedStatus.NoProxy,t.matchedRuleStatus=l.ProxyableMatchedRuleStatus.NoneMatched,t}let r=a.ProxyRules.findMatchedUrlInRulesInfo(e,t.compiledRules),s=r?.compiledRule,i=new l.ProxyableLogDataType;return i.url=e,i.ruleHostName="",i.rulePatternText="",i.proxifiedStatus=l.ProxyableProxifiedStatus.NoProxy,i.matchedRuleStatus=l.ProxyableMatchedRuleStatus.NoneMatched,null!=s&&(i.applyFromRule(s),i.ruleHostName=s.hostName,i.proxifiedStatus=l.ProxyableProxifiedStatus.MatchedRule,i.matchedRuleStatus=l.ProxyableMatchedRuleStatus.MatchedRule,i.ruleSource=l.CompiledProxyRuleSource.Rules,s.whiteList&&(i.matchedRuleStatus=l.ProxyableMatchedRuleStatus.Whitelisted,i.proxifiedStatus=l.ProxyableProxifiedStatus.NoProxy),t.profileType==l.SmartProfileType.AlwaysEnabledBypassRules&&(i.matchedRuleStatus=l.ProxyableMatchedRuleStatus.AlwaysEnabledByPassed),r.matchedRuleSource!=l.CompiledProxyRulesMatchedSource.SubscriptionRules&&r.matchedRuleSource!=l.CompiledProxyRulesMatchedSource.WhitelistSubscriptionRules||(i.ruleSource=l.CompiledProxyRuleSource.Subscriptions)),t.profileType==l.SmartProfileType.SystemProxy&&(i.proxifiedStatus=l.ProxyableProxifiedStatus.SystemProxyApplied),i}}d.subscribedTabList=[]},"./src/core/definitions.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{BrowserProxySettingsType:()=>v,CommandMessages:()=>E,CompiledProxyRule:()=>ie,CompiledProxyRuleSource:()=>x,CompiledProxyRuleType:()=>S,CompiledProxyRulesInfo:()=>oe,CompiledProxyRulesMatchedSource:()=>k,ExternalRulesFormat:()=>A,FailedRequestType:()=>N,GeneralOptions:()=>ee,ImportedProxyRule:()=>ne,PartialThemeDataType:()=>M,PopupInternalDataType:()=>O,ProxyRule:()=>se,ProxyRuleSpecialProxyServer:()=>T,ProxyRuleType:()=>b,ProxyRulesImportFromUI:()=>ce,ProxyRulesSubscription:()=>ue,ProxyServer:()=>re,ProxyServerForProtocol:()=>P,ProxyServerSubscription:()=>le,ProxyServerSubscriptionFormat:()=>C,ProxyableInternalDataType:()=>H,ProxyableLogDataType:()=>W,ProxyableMatchedRuleStatus:()=>R,ProxyableProxifiedStatus:()=>w,ResultHolder:()=>z,ResultHolderGeneric:()=>F,SettingsActive:()=>j,SettingsConfig:()=>$,SettingsPageSmartProfile:()=>B,ShortcutCommands:()=>L,SmartProfile:()=>Z,SmartProfileBase:()=>G,SmartProfileCompiled:()=>V,SmartProfileType:()=>g,SmartProfileTypeBuiltinIds:()=>y,SmartProfileTypeConfig:()=>q,SpecialRequestApplyProxyMode:()=>I,SubscriptionStats:()=>ae,TabProxyStatus:()=>D,ThemeType:()=>_,UpdateInfo:()=>de,getBuiltinSmartProfiles:()=>Y,getSmartProfileTypeConfig:()=>Q,getSmartProfileTypeDefaultId:()=>X,getSmartProfileTypeIcon:()=>U,getSmartProfileTypeName:()=>J,getUserSmartProfileTypeConfig:()=>K,monitorUrlsSchemaFilter:()=>p,proxyRulesActionTypes:()=>d,proxyServerProtocols:()=>a,proxyServerSubscriptionFormat:()=>u,proxyServerSubscriptionObfuscate:()=>l,specialRequestApplyProxyModeKeys:()=>c,themesCustomType:()=>h,themesDarkFix:()=>f,themesDataTablesDarkFix:()=>m});var s=r("./src/core/Settings.ts"),i=r("./src/lib/environment.ts"),n=r("./src/lib/Utils.ts"),o=r("./src/core/ProfileOperations.ts");const a=["HTTP","HTTPS","SOCKS4","SOCKS5"],l=["None","Base64"],u=["PlainText","JSON"],c=["NoProxy","CurrentProxy"],d=[i.api.i18n.getMessage("settingsRuleActionApplyProxy"),i.api.i18n.getMessage("settingsRuleActionWhitelist")],p=["*://*/*","ws://*/*","wss://*/*","ftp://*/*"],h="0",f="themes-darkfix.css",m="themes-datatables-darkfix.css";var g,y,b,S,x,P,v,R,w,_,T,k,I,C,A,D;function U(e){switch(e){case g.Direct:return"fas fa-ban text-danger";case g.SystemProxy:return"fab fa-windows text-primary";case g.SmartRules:return"fas fa-magic text-primary";case g.AlwaysEnabledBypassRules:return"fas fa-globe-americas text-success";case g.IgnoreFailureRules:return"fas fa-scroll";default:return""}}!function(e){e[e.Direct=0]="Direct",e[e.SystemProxy=1]="SystemProxy",e[e.SmartRules=2]="SmartRules",e[e.AlwaysEnabledBypassRules=3]="AlwaysEnabledBypassRules",e[e.IgnoreFailureRules=4]="IgnoreFailureRules"}(g||(g={})),function(e){e.Direct="InternalProfile_Direct",e.SmartRules="InternalProfile_SmartRules",e.AlwaysEnabled="InternalProfile_AlwaysEnabled",e.SystemProxy="InternalProfile_SystemProxy",e.IgnoreRequestFailures="InternalProfile_IgnoreRequestFailures"}(y||(y={})),function(e){e[e.MatchPatternHost=0]="MatchPatternHost",e[e.MatchPatternUrl=1]="MatchPatternUrl",e[e.RegexHost=2]="RegexHost",e[e.RegexUrl=3]="RegexUrl",e[e.Exact=4]="Exact",e[e.DomainSubdomain=5]="DomainSubdomain",e[e.DomainExact=6]="DomainExact",e[e.DomainAndPath=7]="DomainAndPath",e[e.DomainSubdomainAndPath=8]="DomainSubdomainAndPath",e[e.SearchUrl=9]="SearchUrl"}(b||(b={})),function(e){e[e.RegexHost=0]="RegexHost",e[e.RegexUrl=1]="RegexUrl",e[e.Exact=2]="Exact",e[e.SearchUrl=3]="SearchUrl",e[e.SearchDomain=4]="SearchDomain",e[e.SearchDomainSubdomain=5]="SearchDomainSubdomain",e[e.SearchDomainAndPath=6]="SearchDomainAndPath",e[e.SearchDomainSubdomainAndPath=7]="SearchDomainSubdomainAndPath"}(S||(S={})),function(e){e[e.Rules=0]="Rules",e[e.Subscriptions=1]="Subscriptions"}(x||(x={})),function(e){e[e.Http=0]="Http",e[e.SSL=1]="SSL",e[e.FTP=2]="FTP",e[e.SOCKS=3]="SOCKS"}(P||(P={}));class E{}E.PopupGetInitialData="Popup_GetInitialData",E.PopupChangeActiveProfile="Popup_ChangeActiveProfile",E.PopupChangeActiveProxyServer="Popup_ChangeActiveProxyServer",E.PopupToggleProxyForDomain="Popup_ToggleProxyForDomain",E.PopupAddDomainListToProxyRule="Popup_AddDomainListToProxyRule",E.PopupAddDomainListToIgnored="Popup_AddDomainListToIgnored",E.SettingsPageGetInitialData="SettingsPage_GetInitialData",E.SettingsPageGetInitialDataResponse="SettingsPage_GetInitialData_Response",E.SettingsPageSaveOptions="SettingsPage_SaveOptions",E.SettingsPageSaveProxyServers="SettingsPage_SaveProxyServers",E.SettingsPageSaveProxySubscriptions="SettingsPage_SaveProxySubscriptions",E.SettingsPageSaveSmartProfile="SettingsPage_SaveSmartProfile",E.SettingsPageDeleteSmartProfile="SettingsPage_DeleteSmartProfile",E.SettingsPageRestoreSettings="SettingsPage_RestoreSettings",E.SettingsPageMakeRequestSpecial="SettingsPage_MakeRequestSpecial",E.SettingsPageSkipWelcome="SettingsPage_SkipWelcome",E.SettingsPageFactoryReset="SettingsPage_FactoryReset",E.ProxyableRequestLog="Proxyable_RequestLog",E.ProxyableOriginTabRemoved="Proxyable_OriginTabRemoved",E.ProxyableGetInitialData="Proxyable_GetInitialData",E.ProxyableGetInitialDataResponse="Proxyable_GetInitialData_Response",E.ProxyableRemoveProxyableLog="Proxyable_RemoveProxyableLog",E.ProxyableToggleProxyableDomain="Proxyable_ToggleProxyableDomain",E.WebFailedRequestNotification="WebFailedRequest_Notification",E.DebugEnableDiagnostics="Debug_EnableDiagnostics",E.DebugGetDiagnosticsLogs="Debug_GetDiagnosticsLogs",function(e){e.none="none",e.autoDetect="autoDetect",e.system="system",e.manual="manual",e.autoConfig="autoConfig"}(v||(v={}));class L{}L.NextProxyServer="next-proxy-server",L.PreviousProxyServer="previous-proxy-server",L.BuiltinProfileNone="proxy-mode-none",L.BuiltinProfileSmart="proxy-mode-smart",L.BuiltinProfileAlways="proxy-mode-always",L.BuiltinProfileSystem="proxy-mode-system";class z{}class F{}class O{}class M{constructor(){this.themeType=_.Auto}}class N{}class B{}class H{}!function(e){e[e.NoneMatched=0]="NoneMatched",e[e.Special=1]="Special",e[e.ProxyPerOrigin=2]="ProxyPerOrigin",e[e.MatchedRule=3]="MatchedRule",e[e.Whitelisted=4]="Whitelisted",e[e.AlwaysEnabledByPassed=5]="AlwaysEnabledByPassed",e[e.AlwaysEnabledForcedByRules=6]="AlwaysEnabledForcedByRules"}(R||(R={})),function(e){e[e.NoProxy=0]="NoProxy",e[e.Special=1]="Special",e[e.ProxyPerOrigin=2]="ProxyPerOrigin",e[e.MatchedRule=3]="MatchedRule",e[e.AlwaysEnabled=4]="AlwaysEnabled",e[e.SystemProxyApplied=5]="SystemProxyApplied"}(w||(w={}));class W{get matchedRuleStatusName(){return R[this.matchedRuleStatus]}get proxifiedStatusName(){return w[this.proxifiedStatus]}get proxified(){return this.proxifiedStatus!=w.NoProxy}applyFromRule(e){e&&(this.rulePatternText=e.ruleText,this.ruleId=e.ruleId,this.ruleSource=e.compiledRuleSource,this.ruleHostName||(this.ruleHostName=e.hostName))}removeRuleInfo(){this.rulePatternText="",this.ruleId=null,this.ruleSource=null,this.ruleHostName=""}}class ${constructor(){this.product="SmartProxy",this.version="",this.configVersion="",this.syncHash="",this.proxyProfiles=Y(),this.activeProfileId=y.Direct,this.proxyServers=[],this.proxyServerSubscriptions=[],this.firstEverInstallNotified=!1,this.updateInfo=null}CopyFrom(e){this.options=new ee,this.options.CopyFrom(e.options);let t=[];for(const r of e.proxyProfiles){let e=new Z;o.ProfileOperations.copySmartProfile(r,e),t.push(e)}this.proxyProfiles=t,this.activeProfileId=e.activeProfileId;let r=[];for(const t of e.proxyProfiles){let e=new re;e.CopyFrom(t),e.isValid()&&r.push(e)}this.proxyServers=r,this.defaultProxyServerId=e.defaultProxyServerId;let s=[];for(const t of e.proxyServerSubscriptions){let e=new le;e.CopyFrom(t),e.isValid()&&s.push(e)}this.proxyServerSubscriptions=s,this.firstEverInstallNotified=e.firstEverInstallNotified,this.version=e.version,this.syncHash=e.syncHash,this.configVersion=e.configVersion}}class j{}class q{}class G{constructor(){this.enabled=!0}}class Z extends G{constructor(){super(...arguments),this.proxyRules=[],this.rulesSubscriptions=[]}}class V extends G{}function K(e){let t=Q(e);return t.builtin=!1,t}function Q(e){switch(e){case g.Direct:return{builtin:!0,editable:!1,selectable:!0,supportsSubscriptions:!1,supportsProfileProxy:!1,customProxyPerRule:!1,canBeDisabled:!1,supportsRuleActionWhitelist:!1,defaultRuleActionIsWhitelist:null};case g.SmartRules:return{builtin:!0,editable:!0,selectable:!0,supportsSubscriptions:!0,supportsProfileProxy:!0,customProxyPerRule:!0,canBeDisabled:!0,supportsRuleActionWhitelist:!0,defaultRuleActionIsWhitelist:!1};case g.AlwaysEnabledBypassRules:return{builtin:!0,editable:!0,selectable:!0,supportsSubscriptions:!0,supportsProfileProxy:!0,customProxyPerRule:!0,canBeDisabled:!0,supportsRuleActionWhitelist:!0,defaultRuleActionIsWhitelist:!0};case g.SystemProxy:return{builtin:!0,editable:!1,selectable:!0,supportsSubscriptions:!1,supportsProfileProxy:!1,customProxyPerRule:!1,canBeDisabled:!1,supportsRuleActionWhitelist:!1,defaultRuleActionIsWhitelist:null};case g.IgnoreFailureRules:return{builtin:!0,editable:!1,selectable:!1,supportsSubscriptions:!1,supportsProfileProxy:!1,customProxyPerRule:!1,canBeDisabled:!1,supportsRuleActionWhitelist:!1,defaultRuleActionIsWhitelist:null};default:return null}}function J(e){return i.api.i18n.getMessage(`settings_SmartProfileType_${g[e]}`)}function Y(){return[{profileId:y.Direct,profileType:g.Direct,profileTypeConfig:Q(g.Direct),profileName:i.api.i18n.getMessage("popupNoProxy"),proxyRules:[],enabled:!0,rulesSubscriptions:[],profileProxyServerId:null},{profileId:y.SmartRules,profileType:g.SmartRules,profileTypeConfig:Q(g.SmartRules),profileName:i.api.i18n.getMessage("popupSmartProxy"),proxyRules:[],enabled:!0,rulesSubscriptions:[],profileProxyServerId:null},{profileId:y.AlwaysEnabled,profileType:g.AlwaysEnabledBypassRules,profileTypeConfig:Q(g.AlwaysEnabledBypassRules),profileName:i.api.i18n.getMessage("popupAlwaysEnable"),proxyRules:[],enabled:!0,rulesSubscriptions:[],profileProxyServerId:null},{profileId:y.SystemProxy,profileType:g.SystemProxy,profileTypeConfig:Q(g.SystemProxy),profileName:i.api.i18n.getMessage("popupSystemProxy"),proxyRules:[],enabled:!0,rulesSubscriptions:[],profileProxyServerId:null}]}function X(e){switch(e){case g.Direct:return y.Direct;case g.SystemProxy:return y.SystemProxy;case g.SmartRules:return y.SmartRules;case g.AlwaysEnabledBypassRules:return y.AlwaysEnabled;case g.IgnoreFailureRules:return y.IgnoreRequestFailures;default:return""}}!function(e){e[e.Auto=0]="Auto",e[e.Light=1]="Light",e[e.Dark=2]="Dark"}(_||(_={}));class ee{constructor(){this.syncSettings=!1,this.syncActiveProfile=!0,this.syncActiveProxy=!0,this.detectRequestFailures=!0,this.displayFailedOnBadge=!0,this.displayAppliedProxyOnBadge=i.environment.initialConfig.displayTooltipOnBadge,this.displayMatchedRuleOnBadge=i.environment.initialConfig.displayTooltipOnBadge,this.refreshTabOnConfigChanges=!1,this.proxyPerOrigin=!0,this.enableShortcuts=!0,this.shortcutNotification=!0,this.themeType=_.Auto,this.themesDark=ee.defaultDarkThemeName}CopyFrom(e){null!=e.syncSettings&&(this.syncSettings=1==e.syncSettings),null!=e.syncProxyMode&&(this.syncActiveProfile=1==e.syncProxyMode),null!=e.syncActiveProfile&&(this.syncActiveProfile=1==e.syncActiveProfile),null!=e.syncActiveProxy&&(this.syncActiveProxy=1==e.syncActiveProxy),null!=e.detectRequestFailures&&(this.detectRequestFailures=1==e.detectRequestFailures),null!=e.displayFailedOnBadge&&(this.displayFailedOnBadge=1==e.displayFailedOnBadge),null!=e.displayAppliedProxyOnBadge&&(this.displayAppliedProxyOnBadge=1==e.displayAppliedProxyOnBadge),null!=e.displayMatchedRuleOnBadge&&(this.displayMatchedRuleOnBadge=1==e.displayMatchedRuleOnBadge),null!=e.refreshTabOnConfigChanges&&(this.refreshTabOnConfigChanges=1==e.refreshTabOnConfigChanges),null!=e.proxyPerOrigin&&(this.proxyPerOrigin=1==e.proxyPerOrigin),null!=e.enableShortcuts&&(this.enableShortcuts=1==e.enableShortcuts),null!=e.shortcutNotification&&(this.shortcutNotification=1==e.shortcutNotification),this.themeType=e.themeType||_.Auto,this.themesLight=e.themesLight,this.themesLightCustomUrl=e.themesLightCustomUrl,this.themesDark=e.themesDark,this.themesDarkCustomUrl=e.themesDarkCustomUrl}Equals(e){if(t(e.syncSettings,this.syncSettings))return!1;if(t(e.syncActiveProfile,this.syncActiveProfile))return!1;if(t(e.syncActiveProxy,this.syncActiveProxy))return!1;if(t(e.detectRequestFailures,this.detectRequestFailures))return!1;if(t(e.displayFailedOnBadge,this.displayFailedOnBadge))return!1;if(t(e.displayAppliedProxyOnBadge,this.displayAppliedProxyOnBadge))return!1;if(t(e.displayMatchedRuleOnBadge,this.displayMatchedRuleOnBadge))return!1;if(t(e.refreshTabOnConfigChanges,this.refreshTabOnConfigChanges))return!1;if(t(e.proxyPerOrigin,this.proxyPerOrigin))return!1;if(t(e.activeIncognitoProfileId,this.activeIncognitoProfileId))return!1;if(t(e.enableShortcuts,this.enableShortcuts))return!1;if(t(e.shortcutNotification,this.shortcutNotification))return!1;if(t(e.themeType,this.themeType))return!1;if(t(e.themesLight,this.themesLight))return!1;if(t(e.themesLightCustomUrl,this.themesLightCustomUrl))return!1;if(t(e.themesDark,this.themesDark))return!1;if(t(e.themesDarkCustomUrl,this.themesDarkCustomUrl))return!1;function t(e,t){return""===e&&(e=null),""===t&&(t=null),e!=t}return!0}}ee.defaultDarkThemeName="themes-cosmo-dark";class te{}class re extends te{constructor(){super(),this.name="",this.id=n.Utils.getNewUniqueIdString(),this.order=0}CopyFrom(e){this.id=e.id||n.Utils.getNewUniqueIdString(),this.order=e.order??0,this.name=e.name,this.host=e.host,this.port=+e.port,this.protocol=e.protocol,this.username=e.username,this.password=e.password,null!=e.proxyDNS&&(this.proxyDNS=1==e.proxyDNS),this.failoverTimeout=e.failoverTimeout>0?e.failoverTimeout:null,this.protocol||(this.protocol="HTTP")}isValid(){return!(!this.name||!this.protocol||!this.port||this.port<=0||this.port>65535||!this.host||!n.Utils.isValidHost(this.host))}}!function(e){e.DefaultGeneral="-1",e.ProfileProxy="-2"}(T||(T={}));class se{constructor(){this.enabled=!0,this.whiteList=!1,this.ruleId=n.Utils.getNewUniqueIdNumber()}get ruleTypeName(){return b[this.ruleType]}get rule(){switch(+this.ruleType){case b.MatchPatternHost:case b.MatchPatternUrl:return this.rulePattern;case b.RegexHost:case b.RegexUrl:return this.ruleRegex;case b.DomainSubdomain:case b.DomainSubdomainAndPath:case b.DomainAndPath:case b.DomainExact:case b.SearchUrl:return this.ruleSearch;case b.Exact:return this.ruleExact}return""}get proxyName(){return this.whiteList?"-":this.proxy?this.proxy.name:this.proxyServerId==T.DefaultGeneral?i.api.i18n.getMessage("settingsRulesProxyDefault"):this.proxyServerId==T.ProfileProxy?i.api.i18n.getMessage("settingsRulesProxyFromProfile"):null}static assignArray(e){if(!e||!e.length)return[];let t=[];for(let r=0;r<e.length;r++){const s=e[r];let i=new se;Object.assign(i,s),t.push(i)}return t}CopyFrom(e){this.ruleType=e.ruleType,null==e.ruleType&&(this.ruleType=b.DomainSubdomain),this.hostName=e.hostName||"",this.autoGeneratePattern=1==e.autoGeneratePattern,this.rulePattern=e.rulePattern,this.ruleRegex=e.ruleRegex,this.ruleExact=e.ruleExact,this.ruleSearch=e.ruleSearch,this.proxy=e.proxy,null!=e.enabled&&(this.enabled=1==e.enabled),null!=e.whiteList&&(this.whiteList=1==e.whiteList),this.proxy&&(s.Settings.validateProxyServer(this.proxy).success||(this.proxy=null)),e.pattern&&(this.rulePattern=e.rulePattern||e.pattern,this.hostName=e.hostName||e.source||e.sourceDomain,null==this.ruleType&&(this.ruleType=b.MatchPatternUrl),null==this.autoGeneratePattern&&(this.autoGeneratePattern=!1))}isValid(){return!(!this.rule||null==this.ruleType||!(this.ruleSearch&&this.hostName||this.ruleType!=b.DomainSubdomain&&this.ruleType!=b.DomainAndPath&&this.ruleType!=b.DomainSubdomainAndPath&&this.ruleType!=b.DomainExact&&this.ruleType!=b.SearchUrl)||!this.ruleExact&&this.ruleType==b.Exact||!(this.ruleRegex||this.ruleType!=b.RegexHost&&this.ruleType!=b.RegexUrl)||!(this.rulePattern||this.ruleType!=b.MatchPatternHost&&this.ruleType!=b.MatchPatternUrl))}}class ie{constructor(){this.whiteList=!1}get ruleText(){switch(+this.compiledRuleType){case S.RegexHost:case S.RegexUrl:return this.regex.toString();case S.Exact:case S.SearchUrl:case S.SearchDomain:case S.SearchDomainAndPath:case S.SearchDomainSubdomain:case S.SearchDomainSubdomainAndPath:return this.search}return""}}class ne{getProxyRule(){let e=new se;return e.enabled=!0,e.hostName=this.name||this.search,e.ruleRegex=this.regex,e.ruleSearch=this.search,e.ruleType=function(e){switch(e){case S.RegexHost:return b.RegexHost;case S.RegexUrl:return b.RegexUrl;case S.Exact:return b.Exact;case S.SearchUrl:return b.SearchUrl;case S.SearchDomain:return b.DomainExact;case S.SearchDomainSubdomain:return b.DomainSubdomain;case S.SearchDomainAndPath:return b.DomainAndPath;case S.SearchDomainSubdomainAndPath:return b.DomainSubdomainAndPath;default:return null}}(this.importedRuleType)??(this.regex?b.RegexUrl:b.DomainSubdomain),e}getSubscriptionProxyRule(){return this}}class oe{constructor(){this.WhitelistRules=[],this.Rules=[],this.WhitelistSubscriptionRules=[],this.SubscriptionRules=[]}}!function(e){e[e.WhitelistRules=0]="WhitelistRules",e[e.Rules=1]="Rules",e[e.WhitelistSubscriptionRules=2]="WhitelistSubscriptionRules",e[e.SubscriptionRules=3]="SubscriptionRules"}(k||(k={})),function(e){e[e.NoProxy=0]="NoProxy",e[e.CurrentProxy=1]="CurrentProxy",e[e.SelectedProxy=2]="SelectedProxy"}(I||(I={})),function(e){e[e.PlainText=0]="PlainText",e[e.Json=1]="Json"}(C||(C={}));class ae{static updateStats(e,t,r){let i=new Date;t?(e.lastStatus=!0,e.lastStatusMessage=null,e.lastTryDate=e.lastSuccessDate=i.toLocaleDateString()+" "+i.toLocaleTimeString()):(e.lastStatus=!1,e.lastStatusMessage=r?.message??r?.toString(),e.lastTryDate=i.toLocaleDateString()+" "+i.toLocaleTimeString()),e.lastStatusProxyServerName=s.Settings.active?.currentProxyServer?.name}static ToString(e){let t="Status: "+(e.lastStatus?"Success":"Fail");return t=e.lastStatus?i.api.i18n.getMessage("settingsSubscriptionStatsStatusSuccess"):i.api.i18n.getMessage("settingsSubscriptionStatsStatusFail"),e.lastStatus||(e.lastTryDate?t+=`\r\n${i.api.i18n.getMessage("settingsSubscriptionStatsLastTry")} ${e.lastTryDate}`:t+=`\r\n${i.api.i18n.getMessage("settingsSubscriptionStatsLastTry")} -`,e.lastStatusMessage&&(t+=`\r\n${i.api.i18n.getMessage("settingsSubscriptionStatsMessage")} ${e.lastStatusMessage}`)),e.lastStatusProxyServerName&&(t+=`\r\n${i.api.i18n.getMessage("settingsRulesGridColProxy")}: ${e.lastStatusProxyServerName}`),e.lastSuccessDate&&(t+=`\r\n${i.api.i18n.getMessage("settingsSubscriptionStatsLastSuccess")} ${e.lastSuccessDate}`),t}}class le{constructor(){this.enabled=!1,this.proxyProtocol=null,this.refreshRate=0,this.totalCount=0}CopyFrom(e){if(null!=e.name&&(this.name=e.name||""),null!=e.url&&(this.url=e.url||""),null!=e.enabled&&(this.enabled=1==e.enabled),null!=e.proxyProtocol&&(this.proxyProtocol=e.proxyProtocol||null),this.refreshRate=+e.refreshRate>0?+e.refreshRate:0,null!=e.obfuscation&&(this.obfuscation=e.obfuscation||null),this.format=C.PlainText,null!=e.format&&+e.format in C&&(this.format=+e.format),this.totalCount=+e.totalCount,null!=e.username&&(this.username=e.username||""),null!=e.password&&(this.password=e.password||""),this.applyProxy=I.CurrentProxy,null!=e.applyProxy&&+e.applyProxy in I&&(this.applyProxy=+e.applyProxy),this.proxies=[],null!=e.proxies&&Array.isArray(e.proxies))for(const r of e.proxies){var t=new re;t.CopyFrom(r),t.isValid()&&this.proxies.push(t)}this.stats=new ae,e.stats&&Object.assign(this.stats,e.stats)}isValid(){return!!(this.name&&this.url&&this.proxyProtocol&&this.format)}}!function(e){e[e.AutoProxy=0]="AutoProxy",e[e.SwitchyOmega=1]="SwitchyOmega"}(A||(A={}));class ue{constructor(){this.enabled=!1,this.refreshRate=0,this.totalCount=0,this.id=n.Utils.getNewUniqueIdString()}CopyFrom(e){null!=e.name&&(this.name=e.name||""),null!=e.url&&(this.url=e.url||""),null!=e.enabled&&(this.enabled=1==e.enabled),this.refreshRate=+e.refreshRate>0?+e.refreshRate:0,null!=e.obfuscation&&(this.obfuscation=e.obfuscation||null),this.format=A.AutoProxy,null!=e.format&&+e.format in C&&(this.format=+e.format),this.totalCount=+e.totalCount,null!=e.username&&(this.username=e.username||""),null!=e.password&&(this.password=e.password||""),this.applyProxy=I.CurrentProxy,null!=e.applyProxy&&+e.applyProxy in I&&(this.applyProxy=+e.applyProxy),this.proxyRules=[],this.whitelistRules=[],null!=e.proxyRules&&Array.isArray(e.proxyRules)&&(this.proxyRules=e.proxyRules),null!=e.whitelistRules&&Array.isArray(e.whitelistRules)&&(this.whitelistRules=e.whitelistRules),this.stats=new ae,e.stats&&Object.assign(this.stats,e.stats)}isValid(){return!(!this.name||!this.url)}}class ce{constructor(){this.url=null,this.obfuscation=null,this.format=A.AutoProxy,this.applyProxy=I.CurrentProxy,this.username=null,this.password=null}}class de{constructor(){this.updateIsAvailable=!1,this.isBrowserSpecific=!1}}!function(e){e[e.None=0]="None",e[e.Proxified=1]="Proxified",e[e.Whitelisted=2]="Whitelisted"}(D||(D={}))},"./src/lib/Debug.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{Debug:()=>i,DiagDebug:()=>s});var s=null;class i{static enable(){this.enabled=!0}static enableDiagnostics(e=!1){this.enabled=!0,null==s&&(s=new n),s.consoleOutput=e,s.register()}static disable(){this.enabled=!1}static disableDiagnostics(){s?.unregister(),s=null}static disableAll(){this.disable(),this.disableDiagnostics()}static isEnabled(){return this.enabled}static log(e,...t){this.enabled&&(console.log.apply(null,arguments),s&&!s.consoleOutput&&s.log.apply(s,arguments))}static info(e,...t){this.enabled&&(console.info.apply(null,arguments),s&&!s.consoleOutput&&s.info.apply(s,arguments))}static trace(e,...t){this.enabled&&(console.trace.apply(null,arguments),s&&!s.consoleOutput&&s.trace.apply(s,arguments))}static warn(e,...t){console.warn.apply(null,arguments),s&&!s.consoleOutput&&s.warn.apply(s,arguments)}static error(e,...t){console.error.apply(null,arguments),s&&!s.consoleOutput&&s.error.apply(s,arguments)}}i.enabled=!0;class n{constructor(){this.enabled=!0,this.consoleOutput=!1,this.logs=[]}clear(){this.logs=[]}getDiagLogs(){return JSON.stringify(this.logs,null," ")}register(){globalThis.SmartProxyGetDiagLogs=()=>this.getDiagLogs(),globalThis.DiagDebug=this}unregister(){globalThis.SmartProxyGetDiagLogs=void 0}log(e,...t){this.enabled&&this.addToLog("log",e,arguments)}error(e,...t){this.enabled&&this.addToLog("error",e,arguments)}info(e,...t){this.enabled&&this.addToLog("info",e,arguments)}warn(e,...t){this.enabled&&this.addToLog("warn",e,arguments)}trace(e,...t){this.enabled&&this.addToLog("trace",e,arguments)}addToLog(e,t,r){let s=`${a(new Date)} [${e}] `+t;for(let e=1;e<r.length;e++){const t=r[e];s+=null==t?" NULL":"object"==typeof t?" "+JSON.stringify(t):" "+t.toString()}this.logs.push(s),this.consoleOutput&&console.log("Diagnostics",s)}}const o=(e,t)=>String(e).padStart(t,"0"),a=e=>`${e.getHours()}:${o(e.getMinutes(),2)}:${o(e.getSeconds(),2)}.${o(e.getMilliseconds(),3)}`},"./src/lib/External.ts":(e,t,r)=>{"use strict";var s,i,n;r.r(t),r.d(t,{bootstrap:()=>s,jQuery:()=>i,messageBox:()=>n}),"undefined"!=typeof window?(s=window.bootstrap,i=window.jQuery,n=window.messageBox):(s={},i={},n={})},"./src/lib/LiteEvent.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{LiteEvent:()=>s});class s{constructor(){this.handlers=[]}on(e){this.handlers.push(e)}off(e){this.handlers=this.handlers.filter((t=>t!==e))}trigger(e){this.handlers.slice(0).forEach((t=>t(e)))}expose(){return this}}},"./src/lib/PolyFill.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{PolyFill:()=>i});var s=r("./src/lib/environment.ts");class i{static lastError(){return s.environment.chrome,s.api.runtime.lastError}static onProxyError(){return s.environment.chrome?s.api.proxy.onProxyError:s.api.proxy.onError?s.api.proxy.onError:s.api.proxy.onProxyError}static tabsGet(e,t,r){s.environment.chrome?s.api.tabs.get(e,(e=>{const s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.tabs.get(e).then(t,r)}static tabsGetCurrent(e,t){s.environment.chrome?s.api.tabs.getCurrent((r=>{const s=i.lastError();s?t&&t(s):e&&e(r)})):s.api.tabs.getCurrent().then(e,t)}static tabsRemove(e,t,r){s.environment.chrome?s.api.tabs.remove(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.tabs.remove(e).then(t,r)}static tabsReload(e,t,r,n){s.environment.chrome?s.api.tabs.reload(e,n,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.tabs.reload(e,n).then(t,r)}static tabsQuery(e,t,r){s.environment.chrome?s.api.tabs.query(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.tabs.query(e).then(t,r)}static tabsCreate(e,t,r){s.environment.chrome?s.api.tabs.create(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.tabs.create(e).then(t,r)}static runtimeSendMessage(e,t,r,n,o){if(s.environment.chrome)null!=n&&delete n.toProxyScript,s.api.runtime.sendMessage(o,e,n,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)}));else{let i=s.api.runtime.sendMessage(o,e,n);(t||r)&&i.then(t,r)}}static managementGetSelf(e,t){s.environment.chrome?s.api.management.getSelf((r=>{let s=i.lastError();s?t&&t(s):e&&e(r)})):s.api.management.getSelf().then(e,t)}static storageLocalGet(e,t,r){s.environment.chrome?s.api.storage.local.get(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.storage.local.get(e).then(t,r)}static storageLocalSet(e,t,r){s.environment.chrome?s.api.storage.local.set(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.storage.local.set(e).then(t,r)}static storageLocalRemove(e,t,r){s.environment.chrome?s.api.storage.local.remove(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.storage.local.remove(e).then(t,r)}static storageSyncGet(e,t,r){s.environment.chrome?s.api.storage.sync.get(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.storage.sync.get(e).then(t,r)}static storageSyncSet(e,t,r){s.environment.chrome?s.api.storage.sync.set(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.storage.sync.set(e).then(t,r)}static runtimeGetBrowserInfo(e,t){s.environment.chrome?t&&t({message:"getBrowserInfo is not implemented"}):s.api.runtime.getBrowserInfo().then(e,t)}static runtimeOpenOptionsPage(e,t){s.environment.chrome?s.api.runtime.openOptionsPage((r=>{let s=i.lastError();s?t&&t(s):e&&e(r)})):s.api.runtime.openOptionsPage().then(e,t)}static browserActionSetIcon(e,t,r){s.environment.chrome?s.api.browserAction.setIcon(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.browserAction.setIcon&&s.api.browserAction.setIcon(e).then(t,r)}static browserActionSetBadgeText(e,t,r){s.environment.chrome?s.api.browserAction.setBadgeText(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.browserAction.setBadgeText&&s.api.browserAction.setBadgeText(e).then(t,r)}static browserActionSetBadgeBackgroundColor(e,t,r){s.environment.chrome?s.api.browserAction.setBadgeBackgroundColor(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.browserAction.setBadgeBackgroundColor&&s.api.browserAction.setBadgeBackgroundColor(e).then(t,r)}static browserGetProxySettings(e,t){s.environment.chrome?s.api.proxy.settings.get((r=>{let s=i.lastError();s?t&&t(s):e&&e(r)})):s.api.proxy.settings.get({}).then(e,t)}static browserSetProxySettings(e,t,r){s.environment.chrome?s.api.proxy.settings.set(e,(e=>{let s=i.lastError();s?r&&r(s):t&&t(e)})):s.api.proxy.settings.set(e).then(t,r)}static browserCommandsGetAll(e,t){s.environment.chrome?s.api.commands.getAll((r=>{let s=i.lastError();s?t&&t(s):e&&e(r)})):s.api.commands&&s.api.commands.getAll().then(e,t)}static browserNotificationsCreate(e,t,r,n){s.environment.chrome?s.api.notifications.create(e,t,(e=>{let t=i.lastError();t?n&&n(t):r&&r(e)})):s.api.notifications.create(e,t).then(r,n)}static extensionGetURL(e){return s.environment.chrome?s.api.extension.getURL?s.api.extension.getURL(e):s.api.runtime.getURL(e):s.api.extension.getURL(e)}static getExtensionVersion(e){s.environment.extensionVersion?e?.(s.environment.extensionVersion):i.managementGetSelf((t=>{s.environment.extensionVersion=t.version,e?.(s.environment.extensionVersion)}),null)}}i.runtimeGetBrowserInfo((e=>{s.environment.version=parseInt(e.version)||1,s.environment.name=e.name}))},"./src/lib/ProxyImporter.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{ProxyImporter:()=>u});var s=r("./src/lib/Utils.ts"),i=r("./src/lib/environment.ts"),n=r("./src/core/definitions.ts"),o=r("./src/lib/Debug.ts"),a=r("./src/core/Settings.ts"),l=r("./src/core/ProxyEngineSpecialRequests.ts");const u={readFromServer(e,t,r){if(!e||!e.url)return void(r&&r());if(!t)throw"onSuccess callback is mandatory";null!==e.applyProxy&&l.ProxyEngineSpecialRequests.setSpecialUrl(e.url,e.applyProxy);let s=new XMLHttpRequest;if(s.open("GET",e.url),e.username){let t=atob(e.password);s.setRequestHeader("Authorization","Basic "+btoa(e.username+":"+t))}s.onload=()=>{var i;200===s.status?((i=s.responseText)||r&&r(),u.importText(i,null,!1,null,(e=>{e.success?t&&t(e):r&&r(e)}),(e=>{r&&r(e)}),e)):r&&r(s.status)},s.send()},importText(e,t,r,o,a,l,c){if(t||e)if(e)d(e,c);else{let e=new FileReader;e.onerror=e=>{l&&l(e)},e.onload=t=>{d(e.result,c)},e.readAsText(t)}else l&&l();function d(e,t){let c;if(c=t&&t.format==n.ProxyServerSubscriptionFormat.Json?u.parseJson(e,t):u.parseText(e,t),null==c)return void(l&&l());let d=s.Utils.removeDuplicatesFunc(c,((e,t)=>e.host==t.host&&e.port==t.port&&e.username==t.username&&e.password==t.password));if(r){o||(o=[]);let e=o.slice(),t=0;for(let r of d)o.some((e=>e.host==r.host&&e.port==r.port&&e.username==r.username&&e.password==r.password))||(e.push(r),t++);let r=i.api.i18n.getMessage("importerImportProxySuccess").replace("{0}",t.toString()).replace("{1}",d.length.toString());a&&a({success:!0,message:r,result:e})}else{let e=i.api.i18n.getMessage("importerImportProxySuccess").replace("{0}",d.length.toString()).replace("{1}",c.length.toString());a&&a({success:!0,message:e,result:d})}}},parseText:(e,t)=>{if(!e||"string"!=typeof e)return null;const r=/((?:[A-Za-z0-9-]+\.)+[A-Za-z0-9]{1,6})(?:(?::+|[\t\s,]+)(\d{2,5}))?(?:[\t\s]+\[(\w+)\][\t\s]+\[([\w\s\:\.-]+)\](?:[\t\s]+\[(.+)\][\t\s]+\[(.+)\])?)?/i;if(t&&t.obfuscation)try{"base64"==t.obfuscation.toLowerCase()&&(e=atob(e))}catch(e){return null}let s=e.split(/(\r|\n)/),i=[],o="HTTP";t&&t.proxyProtocol&&(o=t.proxyProtocol);for(let e of s){if(e.length<4)continue;let t=r.exec(e);if(!t)continue;let[,s,a,l,u,c,d]=t;if(!s||!a)continue;l=l?l.toUpperCase():o;let p=new n.ProxyServer;p.name=u||`${s}:${a}`,p.id=p.name,p.host=s,p.port=parseInt(a),p.protocol=l,p.username=c,p.password=d,i.push(p)}return i},parseJson:(e,t)=>{if(t&&t.obfuscation)try{"base64"==t.obfuscation.toLowerCase()&&(e=atob(e))}catch(e){return null}let r=[];try{let t=JSON.parse(e);if(!t)return null;Array.isArray(t)||(t=[t]);for(const e of t){let t=new n.ProxyServer;t.name=e.name||(e.country?`${e.country} - `:"")+`${e.ip}:${e.port}`,t.id=t.name,t.host=e.ip,t.port=parseInt(e.port),t.protocol=e.protocol,t.username=e.username,t.password=e.password,a.Settings.validateProxyServer(t).success&&r.push(t)}return r}catch(t){return o.Debug.log("ProxyImporter.parseJson failed",t,e),null}}}},"./src/lib/RuleImporter.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{RuleImporter:()=>l});var s=r("./src/lib/Utils.ts"),i=r("./src/lib/environment.ts"),n=r("./src/core/definitions.ts"),o=r("./src/core/ProxyEngineSpecialRequests.ts"),a=r("./src/lib/RuleImporterSwitchy.js");const l={readFromServerAndImport(e,t,r){if(!e||!e.url)return void(r&&r());if(!t)throw"onSuccess callback is mandatory";null!==e.applyProxy&&o.ProxyEngineSpecialRequests.setSpecialUrl(e.url,e.applyProxy);let s={method:"GET",headers:void 0};if(e.username){let t=atob(e.password);s.headers={Authorization:"Basic "+btoa(e.username+":"+t)}}fetch(e.url,s).then((e=>e.text())).then((s=>{var i;(i=s)?l.importRulesBatch(e,i,null,!1,null,(e=>{e.success?t&&t(e):r&&r(e)}),(e=>{r&&r(e)})):r&&r()})).catch((e=>{r&&r(e)}))},importRulesBatch(e,t,r,o,a,l,c){if(r||t)if(t)try{d(t,e)}catch(e){c&&c(e)}else{let t=new FileReader;t.onerror=e=>{c&&c(e)},t.onload=r=>{let s=t.result;try{d(s,e)}catch(e){c&&c(e)}},t.readAsText(r)}else c&&c();function d(e,t){let r;if("base64"==t.obfuscation?.toLowerCase()&&(e=s.Utils.b64DecodeUnicode(e)),t&&t.format==n.ExternalRulesFormat.AutoProxy){if(!u.GFWList.detect(e,!1))return void(c&&c());r=u.GFWList.parse(e)}else{if(!t||t.format!=n.ExternalRulesFormat.SwitchyOmega)return void(c&&c());{let d=u.Switchy.parseAndCompile(e);if(!d||!d.compiled)return void(c&&c());r={blackList:u.Switchy.convertToProxyRule(d.compiled),whiteList:[]}}}if(o){function p(e,t=!1){let r=[];for(let s of e){let e=s.getProxyRule();a.some((r=>r.ruleType==e.ruleType&&r.ruleSearch==e.ruleSearch&&r.ruleRegex==e.ruleRegex&&(!t||t&&r.whiteList)))||r.push(s)}return r}a||(a=[]),r.blackList=r.blackList||[],r.whiteList=r.whiteList||[];let h=r.blackList.length+r.whiteList.length;r.blackList=p(r.blackList),r.whiteList=p(r.whiteList,!0);let f=r.blackList.length+r.whiteList.length,m=i.api.i18n.getMessage("importerImportSuccess").replace("{0}",f.toString()).replace("{1}",h.toString());l&&l({success:!0,message:m,rules:r})}else{let g=i.api.i18n.getMessage("importerImportRulesSuccess").replace("{0}",r.blackList.length).replace("{1}",r.whiteList.length);l&&l({success:!0,message:g,rules:r})}}},importAutoProxy(e,t,r,n,o){if(!e)return void(o&&o());let a=new FileReader;a.onerror=e=>{o&&o(e)},a.onload=e=>{let l=a.result;try{let e=u.AutoProxy.parse(l),o=[];for(let t of e){let e=u.AutoProxy.convertAutoProxyRule(t.condition.pattern,t.condition.conditionType);e.success&&o.push({pattern:e.pattern,source:e.source,enabled:!0})}if(o=s.Utils.removeDuplicates(o,"pattern"),t){r||(r=[]);let t=r.slice(),s=0;for(let e of o)r.some((t=>{t.pattern,e.pattern}))||(t.push(e),s++);let a=i.api.i18n.getMessage("importerImportSuccess").replace("{0}",s.toString()).replace("{1}",e.length.toString());n&&n({success:!0,message:a,result:t})}else{let t=i.api.i18n.getMessage("importerImportSuccess").replace("{0}",o.length.toString()).replace("{1}",e.length.toString());n&&n({success:!0,message:t,result:o})}}catch(e){o&&o(e)}},a.readAsText(e)}},u={AutoProxy:{magicPrefix:"W0F1dG9Qcm94",detect:(e,t=!0)=>!(!t||!s.Utils.strStartsWith(e,u.AutoProxy.magicPrefix))||!!s.Utils.strStartsWith(e,"[AutoProxy"),preprocess:e=>(s.Utils.strStartsWith(e,u.AutoProxy.magicPrefix)&&(e=s.Utils.b64DecodeUnicode(e)),e),parse(e,t,r){let s,i,n,o,a,l,u,c,d,p;for(a=[],i=[],p=e.split(/\n|\r/),c=0,d=p.length;c<d;c++)n=p[c],n=n.trim(),0!==n.length&&"!"!==n[0]&&"["!==n[0]&&(u=n,l=t,o=a,"@"===n[0]&&"@"===n[1]&&(l=r,o=i,n=n.substring(2)),s="/"===n[0]?{conditionType:"UrlRegexCondition",pattern:n.substring(1,n.length-1)}:"|"===n[0]?"|"===n[1]?{conditionType:"HostWildcardCondition",pattern:"*."+n.substring(2),cleanCondition:n.substring(2)}:{conditionType:"UrlWildcardCondition",pattern:n.substring(1)+"*",cleanCondition:n.substring(1)}:n.indexOf("*")<0?{conditionType:"KeywordCondition",pattern:n,cleanCondition:n}:{conditionType:"UrlWildcardCondition",pattern:"http://*"+n+"*",cleanCondition:n},o.push({condition:s,profileName:l,source:u}));return i.concat(a)},convertAutoProxyRule(e,t){let r="",s="";switch(t){case"KeywordCondition":"."===e[0]&&(e=e.substring(1)),r=e,e.endsWith("/")&&(r=e.substring(0,e.length-2)),s=`*://*.${r}/*`;break;case"HostWildcardCondition":"."===e[0]&&(e=e.substring(1)),"."===(e=(e=e.replace(/\*/g,"")).replace(/([.])\1+/g,"."))[0]&&(e=e.substring(1)),r=e,e.endsWith("/")&&(r=e.substring(0,e.length-2)),s=`*://*.${r}/*`;break;case"UrlWildcardCondition":if("*"===e[0]&&(e=e.substring(1)),"."===e[0]&&(e=e.substring(1)),-1!==e.indexOf("*")){let t=e;if(-1!==t.indexOf("://*.")&&(t=t.replace("//*.","://")),t.endsWith("*")&&(e=e.substring(0,e.length-2),t=t.substring(0,e.length-2)),-1!==t.indexOf("*")&&(t=e.replace(/\/\*\//g,"/"),-1!==t.indexOf("*")))return{success:!1}}r=e,e.endsWith("/")&&(r=e.substring(0,e.length-2)),s=-1!==r.indexOf("://")?`${r}/*`:`*://*.${r}/*`;break;case"UrlRegexCondition":return{success:!1}}return{success:!0,source:r,pattern:s,toString:()=>`[${r} , ${s}]`}}},GFWList:{detect:(e,t=!0)=>!(!t||!s.Utils.strStartsWith(e,u.AutoProxy.magicPrefix))||!!s.Utils.strStartsWith(e,"[AutoProxy"),parse(e){e=e.trim();let t=[],r=[],s=[];for(var i of e.split(/\n|\r/))if((i=i.trim())[0]&&"!"!=i[0]&&"["!=i[0]){var n=u.GFWList.convertLineRegex(i);n&&(s.push(i+"\n"+n.regex+" \t\t Name:"+n.name+"\n\n"),i.startsWith("@@")?t.push(n):r.push(n))}return{_debug:s,whiteList:t,blackList:r}},convertLineRegex_OLD:e=>(e.startsWith("@@")&&(e=e.substring(2)),e.startsWith("/")&&e.endsWith("/")?{regex:e=e.substring(1,e.length-1),name:"Regex",makeNameRandom:!0}:(e=(e=e.replace("*",".+").replace("?","\\?")).replace("(","\\(").replace(")","\\)")).startsWith("||")?{regex:`^(?:https?|ftps?|wss?):\\/\\/(?:.+\\.)?${e=(e=e.substring(2)).replace(".","\\.")}(?:[?#\\/].*)?$`,name:e,makeNameRandom:!1}:e.startsWith("|")?{regex:`^${e=(e=e.substring(1)).replace(".","\\.")}.*`,name:e,makeNameRandom:!1}:e.startsWith(".")?{regex:`://(?:.+\\.)?${e=(e=e.substring(1)).replace(".","\\.")}(?:[?#\\/].*)?$`,name:e,makeNameRandom:!1}:e.endsWith("|")?{regex:`.*${e=(e=e.substring(0,e.length-1)).replace(".","\\.")}$`,name:e,makeNameRandom:!1}:{regex:`.*${e=e.replace(".","\\.")}(?:[.?#\\/].*)?$`,name:e,makeNameRandom:!1}),convertLineRegex(e){if(e.startsWith("@@")&&(e=e.substring(2)),e.startsWith("/")&&e.endsWith("/")){e=e.substring(1,e.length-1);let t=new n.ImportedProxyRule;return t.regex=e,t.name="Regex-"+e.replace(/[\d\\d]*\W*/g,""),t.importedRuleType=n.CompiledProxyRuleType.RegexUrl,t}let t=e.includes("*")||e.includes("(");function r(){e=(e=(e=e.replace("*",".+").replace("?","\\?")).replace("(","\\(").replace(")","\\)")).replace(".","\\.")}if(e.startsWith("||")){if(e=e.substring(2),t){r();let t=new n.ImportedProxyRule;return t.regex=`^(?:https?|ftps?|wss?):\\/\\/(?:.+\\.)?${e}(?:[?#\\/].*)?$`,t.name=e,t.importedRuleType=n.CompiledProxyRuleType.RegexUrl,t}{let t=new n.ImportedProxyRule;return t.search=e,t.name=e,t.importedRuleType=n.CompiledProxyRuleType.SearchDomainSubdomain,t}}if(e.startsWith("|")){if(e=e.substring(1),t){r();let t=new n.ImportedProxyRule;return t.regex=`^${e}.*`,t.name=e,t.importedRuleType=n.CompiledProxyRuleType.RegexUrl,t}{let t=new n.ImportedProxyRule;return t.search=e,t.name=e,t.importedRuleType=n.CompiledProxyRuleType.SearchUrl,t}}if(e.endsWith("|")){e=e.substring(0,e.length-1),r();let t=new n.ImportedProxyRule;return t.regex=`.*${e}$`,t.name=e,t.importedRuleType=n.CompiledProxyRuleType.RegexUrl,t}if(e.startsWith(".")){if(e=e.substring(1),t){r();let t=new n.ImportedProxyRule;return t.regex=`://(?:.+\\.)?${e}(?:[?#\\/].*)?$`,t.name=e,t.importedRuleType=n.CompiledProxyRuleType.RegexUrl,t}{let t=new n.ImportedProxyRule;return t.search=e,t.name=e,t.importedRuleType=n.CompiledProxyRuleType.SearchDomainSubdomainAndPath,t}}if(t){r();let t=new n.ImportedProxyRule;return t.regex=`.*${e}(?:[.?#\\/].*)?$`,t.name=e,t.importedRuleType=n.CompiledProxyRuleType.RegexUrl,t}{let t=new n.ImportedProxyRule;return t.search=e,t.name=e,t.importedRuleType=n.CompiledProxyRuleType.SearchDomainAndPath,t}}},Switchy:{parseAndCompile(e){let t=a.RuleImporterSwitchy.switchy,r=a.RuleImporterSwitchy.compiler;var s=t.getParser(e),i=t[s];if(!i)return null;var n=i(e,"profile-name","default-profile-name");return r.compile({defaultProfileName:"default-profile-name",profileName:"profile-name",profileType:"SwitchProfile",rules:n})},convertToSubscriptionProxyRule(e){if(!e||!e.length)return[];let t=[];for(const r of e){if(!r.args||1!=r.args.length)continue;let e,s=r.args[0];if(e=r.expression instanceof RegExp?r.expression.source:r.expression,"host"==s){let s=new n.ImportedProxyRule;s.name=r.source,s.regex=e,s.importedRuleType=n.CompiledProxyRuleType.RegexHost,t.push(s)}else if("url"==s){let s=new n.ImportedProxyRule;s.name=r.source,s.regex=e,s.importedRuleType=n.CompiledProxyRuleType.RegexUrl,t.push(s)}}return t},convertToProxyRule(e){if(!e||!e.length)return[];let t=[];for(const r of e){if(!r.args||1!=r.args.length)continue;let e,s=r.args[0];e=r.expression instanceof RegExp?r.expression.source:r.expression;let i=new n.ImportedProxyRule;i.name=r.source,i.regex=e,i.search=null,"host"==s?i.importedRuleType=n.CompiledProxyRuleType.RegexHost:"url"==s&&(i.importedRuleType=n.CompiledProxyRuleType.RegexUrl),t.push(i)}return t}}}},"./src/lib/Utils.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{Utils:()=>n});var s=r("./src/lib/environment.ts"),i=r("./node_modules/pako/dist/pako.esm.mjs");class n{static getNewUniqueIdNumber(){return+Math.random().toString(10).substr(2+10*Math.random())}static getNewUniqueIdString(){return(Math.random().toString(36).substr(2,5)+Date.now().toString(36)).toLowerCase()}static encodeSyncData(e){let t=JSON.stringify(e),r=(new TextEncoder).encode(t),o=i.deflateRaw(r,{});o=n.b64EncodeUnicode(o);let a={};return function(e,t){let r=s.environment.storageQuota.syncQuotaBytesPerItem();if(r>0){let s=n.chunkString(e,r);t.chunkLength=s.length;for(let e=0;e<s.length;e++)t["c"+e]=s[e]}else t.c0=e,t.chunkLength=1}(o,a),a}static decodeSyncData(e){if(!e||!e.chunkLength)return null;let t=[];for(let r=0;r<e.chunkLength;r++)t.push(e["c"+r]);let r=t.join(""),s=n.b64DecodeUnicodeArray(r),o=i.inflateRaw(s),a=(new TextDecoder).decode(o);return JSON.parse(a)}static removeDuplicates(e,t){return e.filter(((e,r,s)=>s.findIndex((r=>r[t]===e[t]))===r))}static removeDuplicatesFunc(e,t){return e.filter(((e,r,s)=>s.findIndex((r=>t(r,e)))===r))}static reverseString(e){return e.split("").reverse().join("")}static strStartsWith(e,t){return e.substr(0,t.length)===t}static chunkString(e,t){let r=0,s=t;s>e.length&&(s=e.length);let i=new Array;for(;i.push(e.slice(r,s)),!(s>=e.length);)r+=t,s+=t,s>e.length&&(s=e.length);return i}static b64EncodeUnicode(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(+("0x"+t)))))}static b64DecodeUnicode(e){return decodeURIComponent(atob(e).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))}static b64DecodeUnicodeArray(e){let t=n.b64DecodeUnicode(e);return"string"==typeof t?new Uint16Array(t.split(",")):t}static isValidHost(e){return!(!e||n.invalidHostSchemas.indexOf(e)>=0)}static isValidUrl(e){try{const t=new URL(e);return!(n.invalidHostSchemas.indexOf(t.protocol)>=0)}catch(e){return!1}}static isUrlHttps(e){try{return!!new URL(e).protocol.toLowerCase().startsWith("https")}catch(e){return!1}}static isUrlLocal(e){try{const t=new URL(e);return n.invalidHostSchemas.indexOf(t.protocol)>=0}catch(e){return!1}}static urlHasSchema(e){return!!e&&!!e.includes(":/")}static extractHostFromInvalidUrl(e){try{if(e.includes(":/"))try{return new URL(e),n.extractHostFromUrl(e)}catch{}let t="http://"+e;return n.extractHostFromUrl(t)}catch(e){return null}}static extractHostNameFromInvalidUrl(e){try{if(e.includes(":/"))try{return new URL(e),n.extractHostNameFromUrl(e)}catch{}let t="http://"+e;return n.extractHostNameFromUrl(t)}catch(e){return null}}static extractHostFromUrl(e){try{const t=new URL(e);return n.invalidHostSchemas.indexOf(t.protocol)>=0?null:t.host}catch(e){return null}}static extractHostNameFromUrl(e){try{const t=new URL(e);return n.invalidHostSchemas.indexOf(t.protocol)>=0?null:t.hostname}catch(e){return null}}static extractSubdomainListFromUrl(e){let t=n.extractHostFromUrl(e);return null===t?[]:n.extractSubdomainListFromHost(t)}static extractSubdomainListFromHost(e){if(!e)return null;let t=e.split(".");if(t.length<=2)return[e];if(4==t.length&&+t[3].split(":")[0]>=0)return[e];let r=new Array;for(let e=0;e<t.length&&e!=t.length-1;e++){let s=t.slice(e,t.length);r.push(s.join("."))}r.reverse();let s=r[0];return s&&-1!=n.IgnoreDomainExtensions.indexOf(s)&&r.splice(0,1),r}static hostToMatchPattern(e,t=!0){return e.indexOf(":")>-1?e:t?`*://*.${e}/*`:`*.${e}/*`}static removeSchemaFromUrl(e){if(null==e)return e;let t=(new URL(e).protocol+"//").length;return e.substring(t,e.length)}static matchPatternToRegExp(e,t=!0,r=!1){let s;if(s=/^(?:(\*|https?|file|ftp|app|wss?):\/\/([^/:]+)(?:\:(\d+))?\/?(.*))$/i,"<all_urls>"===e)return null;t||e.includes("://")||(e="http://"+e);const i=s.exec(e);if(!i)return null;const[,n,o,a,l]=i;return t?new RegExp("^(?:"+("*"===n?"(?:https?|ftp|wss?)":escape(n))+":\\/\\/"+("*"===o?"[^\\/]*":escape(o).replace(/^\*\./g,"(?:(?:[^\\/]+)\\.|(?:[^\\/]+){0})"))+(a?"\\:"+escape(a):"")+(l?"*"==l?"(?:\\/.*)?":"\\/"+escape(l).replace(/\*/g,".*"):"\\/?")+")$",r?"i":void 0):new RegExp("^(?:"+("*"===o?"[^\\/]*":escape(o).replace(/^\*\./g,"(?:(?:[^\\/]+)\\.|(?:[^\\/]+){0})"))+(a?"\\:"+escape(a):"")+(l?"*"==l?"(?:\\/.*)?":"\\/"+escape(l).replace(/\*/g,".*"):"\\/?")+")$",r?"i":void 0)}static deepClone(e){return JSON.parse(JSON.stringify(e))}static deepCloneObject(e){return JSON.parse(JSON.stringify(e))}static shallowCopyProperties(e,t){Object.getOwnPropertyNames(t).forEach((r=>{const s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,s)}))}}n.invalidHostSchemas=["moz-extension:","chrome-extension:","about:","data:","chrome:","opera:","edge:"],n.IgnoreDomainExtensions=["000.nl","999.nl","aa.no","ab.ca","ab.se","abo.pa","ac.ae","ac.at","ac.be","ac.be","ac.cn","ac.com","ac.cr","ac.cy","ac.fj","ac.fk","ac.gn","ac.id","ac.il","ac.im.in","ac.in","ac.ir","ac.jp","ac.mw","ac.nz","ac.pa","ac.ru","ac.rw","ac.se","ac.th","ac.tj","ac.tz","ac.ug","ac.uk","ac.vn","ac.yu","ac.zm","ac.zw","act.au","ad.jp","adm.br","adult.ht","adv.br","aero.mv","agr.br","ah.cn","ah.no","ak.us","al.us","alt.za","am.br","ar.us","army.mil","arq.br","art.br","art.do","art.dz","art.ht","art.pl","asn.au","asn.au","asn.lv","asso.dz","asso.fr","asso.ht","asso.mc","ato.br","av.tr","az.us","bbs.tr","bc.ca","bd.se","bel.tr","bio.br","biz.az","biz.cy","biz.et","biz.fj","biz.mv","biz.nr","biz.om","biz.pk","biz.pl","biz.pr","biz.tj","biz.tr","biz.tt","biz.vn","bj.cn","bl.uk","bmd.br","bu.no","c.se","ca.us","cim.br","city.za","ck.ua","club.tw","cn.ua","cng.br","cnt.br","co.ag","co.ao","co.at","co.bw","co.cc.cd","co.ck","co.cr","co.fk","co.gg","co.hu","co.id","co.il","co.im","co.in","co.ir","co.je","co.jp","co.kr","co.ls","co.ma","co.mu","co.mw","co.nz","co.om","co.rw","co.th","co.tj","co.tt","co.ug","co.uk","co.us","co.ve","co.yu","co.za","co.zm","co.zw","com.ac","com.af","com.ag","com.ai","com.al","com.an","com.ar","com.au","com.aw","com.ax","com.az","com.bb","com.bd","com.bm","com.bn","com.bo","com.br","com.bs","com.bt","com.cd","com.ch","com.cn","com.co","com.cu","com.cy","com.dm","com.do","com.dz","com.ec","com.ee","com.eg","com.es","com.et","com.fj","com.fr","com.ge","com.gh","com.gi","com.gn","com.gp","com.gr","com.hk","com.hn","com.hr","com.ht","com.jm","com.jo","com.kh","com.kw","com.ky","com.kz","com.lb","com.lc","com.li","com.lk","com.lr","com.lv","com.ly","com.mg","com.mk","com.mo","com.mt","com.mu","com.mv","com.mw","com.mx","com.my","com.ng","com.ni","com.np","com.nr","com.om","com.pa","com.pe","com.pf","com.pg","com.ph","com.pk","com.pl","com.pr","com.ps","com.pt","com.py","com.ro","com.ru","com.rw","com.sa","com.sb","com.sc","com.sd","com.sg","com.sv","com.sy","com.tj","com.tn","com.tr","com.tt","com.tw","com.ua","com.uy","com.ve","com.vi","com.vn","com.ye","conf.au","conf.lv","coop.br","coop.ht","coop.mv","coop.mw","cpa.pro","cq.cn","cri.nz","csiro.au","ct.us","cv.ua","d.se","dc.us","de.us","dn.ua","dni.us","dp.ua","dpn.br","dr.tr","e.se","ebiz.tw","ecn.br","ed.ao","ed.cr","ed.jp","edu.ac","edu.af","edu.al","edu.an","edu.au","edu.az","edu.bb","edu.bd","edu.bm","edu.bn","edu.bo","edu.br","edu.bt","edu.cn","edu.co","edu.cu","edu.dm","edu.do","edu.dz","edu.ec","edu.eg","edu.es","edu.et","edu.ge","edu.gh","edu.gi","edu.gp","edu.gr","edu.hk","edu.hn","edu.ht","edu.in","edu.jm","edu.jo","edu.kh","edu.kw","edu.ky","edu.kz","edu.lb","edu.lc","edu.lk","edu.lr","edu.lv","edu.ly","edu.mg","edu.mo","edu.mt","edu.mv","edu.mw","edu.mx","edu.my","edu.ng","edu.ni","edu.np","edu.nr","edu.om","edu.pa","edu.pe","edu.pf","edu.pk","edu.pl","edu.pr","edu.ps","edu.pt","edu.py","edu.rw","edu.sa","edu.sb","edu.sc","edu.sd","edu.sg","edu.sv","edu.tj","edu.tr","edu.tt","edu.tw","edu.ua","edu.vi","edu.vn","edu.za","eng.br","ens.tn","esp.br","etc.br","eti.br","eun.eg","f.se","fam.pk","far.br","fed.us","fh.se","fhs.no","fhsk.se","fhv.se","fi.cr","fie.ee","fin.ec","fin.tn","firm.ht","firm.in","fj.cn","fl.us","fm.br","fm.no","fnd.br","fot.br","from.hr","fst.br","g.se","g12.br","ga.us","game.tw","gd.cn","geek.nz","gen.in","gen.nz","gen.tr","ggf.br","go.cr","go.id","go.jp","go.th","go.tj","go.tz","go.ug","gob.bo","gob.do","gob.es","gob.hn","gob.mx","gob.ni","gob.pa","gob.pe","gob.pk","gob.sv","gok.pk","gon.pk","gop.pk","gos.pk","gouv.fr","gouv.ht","gouv.rw","gov.ac","gov.ae","gov.af","gov.al","gov.ar","gov.au","gov.az","gov.bb","gov.bd","gov.bf","gov.bm","gov.bo","gov.br","gov.bt","gov.by","gov.ch","gov.cn","gov.co","gov.cu","gov.cx","gov.dm","gov.do","gov.dz","gov.ec","gov.eg","gov.et","gov.fj","gov.fk","gov.ge","gov.gh","gov.gi","gov.gn","gov.gr","gov.hk","gov.ie","gov.il","gov.im","gov.in","gov.ir","gov.it","gov.jm","gov.jo","gov.kh","gov.kw","gov.ky","gov.kz","gov.lb","gov.lc","gov.li","gov.lk","gov.lr","gov.lt","gov.lu","gov.lv","gov.ly","gov.ma","gov.mg","gov.mo","gov.mt","gov.mv","gov.mw","gov.my","gov.ng","gov.np","gov.nr","gov.om","gov.ph","gov.pk","gov.pl","gov.pr","gov.ps","gov.pt","gov.py","gov.rw","gov.sa","gov.sb","gov.sc","gov.sd","gov.sg","gov.sy","gov.tj","gov.tn","gov.to","gov.tp","gov.tr","gov.tt.tv","gov.tv","gov.tw","gov.ua","gov.uk","gov.vi","gov.vn","gov.za","gov.zm","gov.zw","govt.nz","gr.jp","gs.cn","gub.uy","gv.ao","gv.at","gx.cn","gz.cn","h.se","ha.cn","hb.cn","he.cn","hi.cn","hi.us","hl.cn","hl.no","hm.no","hn.cn","i.se","ia.us","id.au","id.lv","id.ly","id.us","idf.il","idn.sg","idv.hk","idv.tw","if.ua","il.us","imb.br","in.th","in.us","ind.br","ind.in","ind.tn","inf.br","inf.cu","info.au","info.az","info.cy","info.ec","info.et","info.fj","info.ht","info.hu","info.mv","info.nr","info.pl","info.pr","info.ro","info.sd","info.tn","info.tr","info.tt","info.ve","info.vn","ing.pa","inima.al","int.ar","int.az","int.bo","int.lk","int.mv","int.mw","int.pt","int.ru","int.rw","int.tj","int.vn","intl.tn","ip6.ar","ip6.pa","iris.ar","iris.pa","isa.us","isla.pr","it.ao","iwi.nz","iz.hr","jet.uk","jl.cn","jor.br","js.cn","jx.cn","k.se","k12.il","k12.tr","kh.ua","kiev.ua","km.ua","kr.ua","ks.ua","ks.us","kv.ua","ky.us","la.us","law.pro","law.za","lel.br","lg.jp","lg.ua","ln.cn","ltd.co.im","ltd.cy","ltd.gi","ltd.lk","ltd.uk","lviv.ua","m.se","ma.us","mat.br","mb.ca","md.us","me.uk","me.us","med.br","med.ec","med.ht","med.ly","med.om","med.pa","med.pro","med.sa","med.sd","mi.th","mi.us","mil.ac","mil.ae","mil.ar","mil.az","mil.bd","mil.bo","mil.br","mil.by","mil.co","mil.do","mil.ec","mil.eg","mil.fj","mil.ge","mil.gh","mil.hn","mil.in","mil.jo","mil.kh","mil.kw","mil.kz","mil.lt","mil.lu","mil.lv","mil.mg","mil.mv","mil.my","mil.no","mil.np","mil.nz","mil.om","mil.pe","mil.pl","mil.rw","mil.se","mil.tj","mil.tr","mil.tw","mil.uk","mil.uy","mil.za","mk.ua","mn.us","mo.us","mod.gi","mod.uk","mr.no","ms.us","msk.ru","mt.us","muni.il","mus.br","n.se","name.ae","name.af","name.az","name.cy","name.et","name.fj","name.hr","name.mv","name.my","name.pr","name.ro","name.tj","name.tr","name.tt","name.vn","nat.tn","navy.mil","nb.ca","nc.us","nd.us","ne.jp","ne.tz","ne.ug","ne.us","nel.uk","net.ac","net.ae","net.af","net.ag","net.ai","net.al","net.an","net.ar","net.au","net.az","net.bb","net.bd","net.bm","net.bn","net.bo","net.br","net.bs","net.bt","net.cd","net.ch","net.cn","net.co","net.cu","net.cy","net.dm","net.do","net.dz","net.ec","net.eg","net.et","net.fj","net.fk","net.ge","net.gg","net.gn","net.gp","net.gr","net.hk","net.hn","net.ht","net.il","net.im","net.in","net.ir","net.je","net.jm","net.jo","net.kh","net.kw","net.ky","net.kz","net.lb","net.li","net.lk","net.lr","net.lu","net.lv","net.ly","net.ma","net.mo","net.mt","net.mv","net.mw","net.mx","net.my","net.ng","net.ni","net.np","net.nr","net.nz","net.om","net.pa","net.pe","net.pg","net.pk","net.pl","net.pr","net.ps","net.pt","net.py","net.ru","net.rw","net.sa","net.sb","net.sc","net.sd","net.sg","net.sy","net.th","net.tj","net.tn","net.tr","net.tt","net.tw","net.ua","net.uk","net.uy","net.ve","net.vn","net.ye","net.za","nf.ca","ngo.lk","ngo.pl","ngo.za","nh.us","nhs.uk","nic.im","nic.in","nic.uk","nj.us","nl.ca","nl.no","nls.uk","nm.cn","nm.us","nom.adae","nom.ag","nom.ai","nom.br","nom.co","nom.es","nom.fk","nom.fr","nom.mg","nom.ni","nom.pa","nom.pe","nom.ro","nom.za","nome.pt","not.br","ns.ca","nsn.us","nsw.au","nt.au","nt.ca","nt.no","nt.ro","ntr.br","nu.ca","nv.us","nx.cn","ny.us","o.se","od.ua","odo.br","of.no","off.ai","og.ao","oh.us","ok.us","ol.no","on.ca","or.at","or.cr","or.id","or.jp","or.kr","or.th","or.tz","or.ug","or.us","org.ac","org.ae","org.ag","org.ai","org.al","org.an","org.au","org.az","org.bb","org.bd","org.bm","org.bn","org.bo","org.br","org.bs","org.bt","org.bw","org.cd","org.ch","org.cn","org.co","org.cu","org.cy","org.dm","org.do","org.dz","org.ec","org.ee","org.eg","org.es","org.et","org.fj","org.fk","org.ge","org.gg","org.gh","org.gi","org.gn","org.gp","org.gr","org.hk","org.hn","org.ht","org.hu","org.il","org.im","org.in","org.ir","org.je","org.jm","org.jo","org.kh","org.kw","org.ky","org.kz","org.lb","org.lc","org.li","org.lk","org.lr","org.ls","org.lu","org.lv","org.ly","org.ma","org.mg","org.mk","org.mo","org.mt","org.mv","org.mw","org.mx","org.my","org.ng","org.ni","org.np","org.nr","org.nz","org.om","org.pa","org.pe","org.pf","org.pk","org.pl","org.pr","org.ps","org.pt","org.py","org.ro","org.ru","org.sa","org.sc","org.sd","org.se","org.sg","org.sv","org.tj","org.tn","org.tr","org.tt","org.tw","org.ua","org.uk","org.uy","org.ve","org.vi","org.vn","org.yu","org.za","org.zm","org.zw","oz.au","pa.us","pb.ao","pe.ca","per.kh","per.sg","perso.ht","pl.ua","plc.co.im","plc.ly","plc.uk","plo.ps","pol.dz","pol.ht","pol.tr","pp.az","pp.ru","pp.se","ppg.br","prd.fr","prd.mg","pri.ee","priv.at","priv.hu","pro.ae","pro.br","pro.cy","pro.ec","pro.fj","pro.ht","pro.mv","pro.om","pro.pr","pro.tt","pro.vn","psc.br","psi.br","pub.sa","publ.pt","pvt.ge","qc.ca","qh.cn","qld.au","qsl.br","rec.br","rec.ro","red.sv","rel.ht","res.in","ri.us","rl.no","rv.ua","s.se","sa.au","sa.cr","sc.cn","sc.ug","sc.us","sch.ae","sch.ir","sch.lk","sch.ly","sch.om","sch.sa","sch.uk","sch.zm","sci.eg","sd.cn","sd.us","sec.ps","sf.no","sh.cn","shop.ht","sk.ca","sld.do","sld.pa","slg.br","sn.cn","soc.lk","soros.al","sport.hu","srv.br","sshn.se","st.no","sumy.ua","sx.cn","t.se","tas.au","te.ua","tel.tr","tirana.al","tj.cn","tm.cy","tm.fr","tm.hu","tm.mc","tm.mg","tm.no","tm.ro","tm.se","tm.za","tmp.br","tn.us","tr.no","trd.br","tur.br","tv.bo","tv.br","tv.sd","tx.us","u.se","uniti.al","upt.al","uri.ar","uri.pa","us.com","ut.us","va.no","va.us","vet.br","vf.no","vgs.no","vic.au","vn.ua","vt.us","w.se","wa.au","wa.us","waw.pl","web.do","web.lk","web.pk","web.tj","web.tr","web.ve","wi.us","wv.us","www.ro","x.se","xj.cn","xz.cn","y.se","yk.ca","yn.cn","z.se","zj.cn","zlg.br","zp.ua","zt.ua"]},"./src/lib/environment.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{api:()=>i,environment:()=>s});let s={chrome:!1,name:"general",version:1,extensionVersion:"",mobile:!1,manifestV3:!1,notSupported:{setProxySettings:!1,keyboardShortcuts:!1},notAllowed:{setProxySettings:!1},bugFreeVersions:{firefoxToProxyScript:56,firefoxConfirmInPopupWorks:57,firefoxNewPacScriptReturnData:57},initialConfig:{displayTooltipOnBadge:!0},storageQuota:{syncQuotaBytesPerItem:()=>(s.chrome,8e3)},browserConfig:{name:"Default",marketName:"Extensions",marketUrl:""}};var i={};"undefined"!=typeof browser?i=browser:"undefined"!=typeof chrome&&(i=chrome,s.chrome=!0),i.browserAction?i.action=i.browserAction:i.action&&(i.browserAction=i.action),i.windows?i.runtime.getBrowserInfo&&i.runtime.getBrowserInfo().then((e=>{"Fennec"==e.name&&(s.mobile=!0)})):s.mobile=!0},"./src/ui/code/CommonUi.ts":(e,t,r)=>{"use strict";r.r(t),r.d(t,{CommonUi:()=>a});var s=r("./src/lib/External.ts"),i=r("./src/lib/environment.ts"),n=r("./src/core/definitions.ts"),o=r("./src/lib/Utils.ts");class a{static downloadData(e,t){let r="data:application/json;charset=utf-8,"+encodeURIComponent(e);(0,s.jQuery)("<a/>").attr("download",t||"").attr("href",r)[0].dispatchEvent(new MouseEvent("click"))}static onDocumentReady(e){(0,s.jQuery)(document).ready(e)}static selectFileOnTheFly(e,t,r,i){let n=(0,s.jQuery)(`<div style='display: none'><input style='display: none' type=file accept='${i||""}' class='' name='${t}'/></div>`),o=n.find("input");(e=(0,s.jQuery)(e)).append(n),o.on("change",(function(e){n.remove();let t=e.target.files;t.length&&r&&r(o,t)})),o.trigger("click")}static localizeHtmlPage(){function e(e,t){let r=i.api.i18n.getMessage(t.trim());r&&r!=t&&(e.innerHTML=r)}let t=i.api.i18n.getMessage("uiDirection");t&&((0,s.jQuery)(document.body).addClass(t).css("direction",t),"rtl"==t&&a.insertStyleSheet("bootstrap.rtl.min.css"));let r=document.querySelectorAll("[data-localize]");for(let t=0;t<r.length;t++){const s=r[t];e(s,s.dataset.localize)}}static applyThemes(e){function t(e=void 0){a.insertStyleSheet(n.themesDarkFix,e)}function r(e=void 0){a.insertStyleSheet(n.themesDataTablesDarkFix,e)}function i(e){const t=document.createElement("meta");t.name="color-scheme",t.content=e,document.getElementsByTagName("head")[0].appendChild(t);let r=`<style>\n\t\t\t\t:root {\n\t\t\t\t\tcolor-scheme: ${e};\n\t\t\t\t}</style>`;(0,s.jQuery)(r).appendTo((0,s.jQuery)("head"))}e.themeType==n.ThemeType.Auto?(i("dark light"),e.themesDark==n.themesCustomType&&e.themesDarkCustomUrl?(r("(prefers-color-scheme: dark)"),t("(prefers-color-scheme: dark)"),a.insertStyleSheet(e.themesDarkCustomUrl,"(prefers-color-scheme: dark)")):e.themesDark&&(r("(prefers-color-scheme: dark)"),t("(prefers-color-scheme: dark)"),a.insertStyleSheet(e.themesDark+".css","(prefers-color-scheme: dark)")),e.themesLight==n.themesCustomType&&e.themesLightCustomUrl?a.insertStyleSheet(e.themesLightCustomUrl,"(prefers-color-scheme: light)"):e.themesLight&&a.insertStyleSheet(e.themesLight+".css","(prefers-color-scheme: light)")):e.themeType==n.ThemeType.Dark?(i("dark"),e.themesDark==n.themesCustomType&&e.themesDarkCustomUrl?(r(),t(),a.insertStyleSheet(e.themesDarkCustomUrl)):e.themesDark&&(r(),t(),a.insertStyleSheet(e.themesDark+".css"))):e.themeType==n.ThemeType.Light&&(i("light"),e.themesLight==n.themesCustomType&&e.themesLightCustomUrl?a.insertStyleSheet(e.themesLightCustomUrl):e.themesLight&&a.insertStyleSheet(e.themesLight+".css"))}static insertStyleSheet(e,t=void 0){const r=document.createElement("link");r.type="text/css",r.rel="stylesheet",o.Utils.urlHasSchema(e)?r.href=e:r.href=`css/${e}`,t&&(r.media=t),document.getElementsByTagName("head")[0].appendChild(r)}}},"./src/lib/RuleImporterSwitchy.js":(e,t)=>{const r=function(e,t){return e.substr(0,t.length)===t},s={}.hasOwnProperty,i={regExpMetaChars:function(){let e,t,r,s,i;for(e="\\[\\^$.|?*+(){}/",i={},t=r=0,s=15;r<15;t=++r)i["\\[\\^$.|?*+(){}/".charCodeAt(t)]=!0;return i}(),escapeSlash:function(e){let t,r,s,i,n,o,a,l,u;for(r=47,t=92,i=!1,u=0,l="",n=o=0,a=e.length;0<=a?o<a:o>a;n=0<=a?++o:--o)s=e.charCodeAt(n),47!==s||i||(l+=e.substring(u,n),l+="\\",u=n),i=92===s&&!i;return l+e.substr(u)},shExp2RegExp:function(e,t){let r,s,n,o,a,l,u,c,d,p,h;if(h=(null!=t?t.trimAsterisk:void 0)||!1,p=0,o=e.length,r=42,s=63,h){for(;p<o&&42===e.charCodeAt(p);)p++;for(;p<o&&42===e.charCodeAt(o-1);)o--;if(o-p==1&&42===e.charCodeAt(p))return""}for(d="",0===p&&(d+="^"),a=l=u=p,c=o;u<=c?l<c:l>c;a=u<=c?++l:--l)switch(n=e.charCodeAt(a),n){case 42:d+=".*";break;case 63:d+=".";break;default:i.regExpMetaChars[n]>=0&&(d+="\\"),d+=e[a]}return o===e.length&&(d+="$"),d}};let n=function(){function e(e,t){this.tag=t,this.prop=e,void 0===this.tag&&(this.tag=e,this.prop="_cache")}return e.prototype.get=function(e,t){let r,s,i;return s=this.tag(e),r=this._getCache(e),null!=r&&r.tag===s?r.value:(i="function"==typeof t?t():t,this._setCache(e,{tag:s,value:i}),i)},e.prototype.drop=function(e){if(null!=e[this.prop])return e[this.prop]=void 0},e.prototype._getCache=function(e){return e[this.prop]},e.prototype._setCache=function(e,t){return Object.prototype.hasOwnProperty.call(e,this.prop)||Object.defineProperty(e,this.prop,{writable:!0}),e[this.prop]=t},e}(),o={Address:function(e){this.valid=!1,this.address=e,this.groups=o.GROUPS,this.v4=!0,this.subnet="/32",this.subnetMask=32;let t=o.RE_SUBNET_STRING.exec(e);if(t){if(this.parsedSubnet=t[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,this.subnetMask<0||this.subnetMask>o.BITS)return this.valid=!1,void(this.error="Invalid subnet mask.");e=e.replace(o.RE_SUBNET_STRING,"")}this.addressMinusSuffix=e,this.parsedAddress=this.parse(e)}};o.Address.prototype.parse=function(e){let t=e.split(".");return e.match(o.RE_ADDRESS)?this.valid=!0:this.error="Invalid IPv4 address.",t},o.Address.prototype.isValid=function(){return this.valid},o.Address.prototype.correctForm=function(){return this.parsedAddress.map((function(e){return parseInt(e,10)})).join(".")};const a={urlWildcard2HostWildcard:function(e){let t;return t=e.match(/^\*:\/\/((?:\w|[?*._\-])+)\/\*$/),null!=t?t[1]:void 0},tag:function(e){return a._condCache.tag(e)},analyze:function(e){return a._condCache.get(e,(function(){return{analyzed:a._handler(e.conditionType).analyze.call(a,e)}}))},match:function(e,t){let r;return r=a.analyze(e),a._handler(e.conditionType).match.call(a,e,t,r)},compile:function(e){let t,r;return t=a.analyze(e),t.compiled?t.compiled:(r=a._handler(e.conditionType),t.compiled=r.compile.call(a,e,t))},str:function(e,t){let r,s,i,n,o,l,u;return r=(null!=t?t:{abbr:-1}).abbr,i=a._handler(e.conditionType),0===i.abbrs[0].length&&(s=e.pattern.charCodeAt(e.pattern.length-1),s!==a.colonCharCode&&e.pattern.indexOf(" ")<0)?e.pattern:(l=i.str,u="number"==typeof r?i.abbrs[(i.abbrs.length+r)%i.abbrs.length]:e.conditionType,o=u+":",n=l?l.call(a,e):e.pattern,n&&(o+=" "+n),o)},colonCharCode:":".charCodeAt(0),fromStr:function(e){let t,r,s,i;return i=(e=e.trim()).indexOf(" "),i<0&&(i=e.length),e.charCodeAt(i-1)===a.colonCharCode?(r=e.substr(0,i-1),e=e.substr(i+1).trim()):r="",r=a.typeFromAbbr(r),r?(t={conditionType:r},s=a._handler(t.conditionType).fromStr,s?s.call(a,e,t):(t.pattern=e,t)):null},_abbrs:null,typeFromAbbr:function(e){let t,r,i,n,o,l;if(!a._abbrs)for(l in a._abbrs={},o=a._conditionTypes,o)if(s.call(o,l))for(r=o[l].abbrs,a._abbrs[l.toUpperCase()]=l,i=0,n=r.length;i<n;i++)t=r[i],a._abbrs[t.toUpperCase()]=l;return a._abbrs[e.toUpperCase()]},comment:function(e,t){let r;return e?(null==t.start&&(t.start={}),Object.defineProperty(t.start,"_comments_dumped",{get:function(){return!1},set:function(){return!1}}),null==(r=t.start).comments_before&&(r.comments_before=[]),t.start.comments_before.push({type:"comment2",value:e}),t):t},safeRegex:function(e){let t;try{return new RegExp(e)}catch(e){return t=e,/(?!)/}},regTest:function(e,t){return"string"==typeof t&&(t=regexSafe(i.escapeSlash(t))),{args:[e],expression:t}},isInt:function(e){return"number"==typeof e&&!isNaN(e)&&parseFloat(e)===parseInt(e,10)},between:function(e,t,r,s){let i,n,o;return t===r?("number"==typeof t&&(t=t.toString()),a.comment(s,{left:e,operator:"===",right:t})):t>r?a.comment(s,new U2.AST_False):a.isInt(t)&&a.isInt(r)&&r-t<32?(s||(s=t+" <= value && value <= "+r),o="0123456789abcdefghijklmnopqrstuvwxyz",n="0123456789abcdefghijklmnopqrstuvwxyz".substr(r<36?t:0,r-t+1),i=0===t?e:{left:e,operator:"-",right:t},a.comment(s,{left:{expression:{expression:n,property:"charCodeAt"},args:[i]},operator:">",right:0})):("number"==typeof t&&(t=t.toString()),"number"==typeof r&&(r=r.toString()),a.comment(s,{args:[e,t,r],expression:{argnames:["value","min","max"],body:[new U2.AST_Return({value:new U2.AST_Binary({left:new U2.AST_Binary({left:new U2.AST_SymbolRef({name:"min"}),operator:"<=",right:new U2.AST_SymbolRef({name:"value"})}),operator:"&&",right:new U2.AST_Binary({left:new U2.AST_SymbolRef({name:"value"}),operator:"<=",right:new U2.AST_SymbolRef({name:"max"})})})})]}}))},parseIp:function(e){let t;return e.charCodeAt(0)==="[".charCodeAt(0)&&(e=e.substr(1,e.length-2)),t=new IP.v4.Address(e),t.isValid()||(t=new IP.v6.Address(e),t.isValid())?t:null},normalizeIp:function(e){let t;return(null!=(t=e.correctForm)?t:e.canonicalForm).call(e)},localHosts:["127.0.0.1","[::1]","localhost"],getWeekdayList:function(e){let t,r,s,i,n;if(e.days){for(i=[],t=r=0;r<7;t=++r)i.push(e.days.charCodeAt(t)>64);return i}for(n=[],t=s=0;s<7;t=++s)n.push(e.startDay<=t&&t<=e.endDay);return n},_condCache:new n((function(e){let t,r;return r=a._handler(e.conditionType).tag,t=r?r.apply(a,arguments):a.str(e),e.conditionType+"$"+t})),_setProp:function(e,t,r){return Object.prototype.hasOwnProperty.call(e,t)||Object.defineProperty(e,t,{writable:!0}),e[t]=r},_handler:function(e){let t;if("string"!=typeof e&&(e=e.conditionType),t=a._conditionTypes[e],null==t)throw new Error("Unknown condition type: "+e);return t},_conditionTypes:{TrueCondition:{abbrs:["True"],analyze:function(e){return null},match:function(){return!0},compile:function(e){return new U2.AST_True},str:function(e){return""},fromStr:function(e,t){return t}},FalseCondition:{abbrs:["False","Disabled"],analyze:function(e){return null},match:function(){return!1},compile:function(e){return new U2.AST_False},fromStr:function(e,t){return e.length>0&&(t.pattern=e),t}},UrlRegexCondition:{abbrs:["UR","URegex","UrlR","UrlRegex"],analyze:function(e){return this.safeRegex(i.escapeSlash(e.pattern))},match:function(e,t,r){return r.analyzed.test(t.url)},compile:function(e,t){return this.regTest("url",t.analyzed)}},UrlWildcardCondition:{abbrs:["U","UW","Url","UrlW","UWild","UWildcard","UrlWild","UrlWildcard"],analyze:function(e){let t,r;return t=function(){let t,s,n,o;for(n=e.pattern.split("|"),o=[],t=0,s=n.length;t<s;t++)r=n[t],r&&o.push(i.shExp2RegExp(r,{trimAsterisk:!0}));return o}(),this.safeRegex(t.join("|"))},match:function(e,t,r){return r.analyzed.test(t.url)},compile:function(e,t){return this.regTest("url",t.analyzed)}},HostRegexCondition:{abbrs:["R","HR","Regex","HostR","HRegex","HostRegex"],analyze:function(e){return this.safeRegex(i.escapeSlash(e.pattern))},match:function(e,t,r){return r.analyzed.test(t.host)},compile:function(e,t){return this.regTest("host",t.analyzed)}},HostWildcardCondition:{abbrs:["","H","W","HW","Wild","Wildcard","Host","HostW","HWild","HWildcard","HostWild","HostWildcard"],analyze:function(e){let t,r;return t=function(){let t,s,n,o;for(n=e.pattern.split("|"),o=[],t=0,s=n.length;t<s;t++)r=n[t],r&&(r.charCodeAt(0)===".".charCodeAt(0)&&(r="*"+r),0===r.indexOf("**.")?o.push(i.shExp2RegExp(r.substring(1),{trimAsterisk:!0})):0===r.indexOf("*.")?o.push(i.shExp2RegExp(r.substring(2),{trimAsterisk:!1}).replace(/./,"(?:^|\\.)").replace(/\.\*\$$/,"")):o.push(i.shExp2RegExp(r,{trimAsterisk:!0})));return o}(),this.safeRegex(t.join("|"))},match:function(e,t,r){return r.analyzed.test(t.host)},compile:function(e,t){return this.regTest("host",t.analyzed)}},BypassCondition:{abbrs:["B","Bypass"],analyze:function(e){let t,r,s,n,o,a,l,u,c,d,p;return r={host:null,ip:null,scheme:null,url:null,normalizedPattern:""},c=e.pattern,"<local>"===c?(r.host=c,r):(n=c.split("://"),n.length>1&&(r.scheme=n[0],r.normalizedPattern=r.scheme+"://",c=n[1]),n=c.split("/"),n.length>1&&(t=this.parseIp(n[0]),a=parseInt(n[1]),t&&!isNaN(a))?(r.ip={conditionType:"IpCondition",ip:this.normalizeIp(t),prefixLength:a},r.normalizedPattern+=r.ip.ip+"/"+r.ip.prefixLength,r):(d=this.parseIp(c),null==d&&(o=c.lastIndexOf(":"),o>=0&&(s=c.substring(o+1),c=c.substring(0,o)),d=this.parseIp(c)),null!=d?(c=this.normalizeIp(d),d.v4?r.normalizedPattern+=c:r.normalizedPattern+="["+c+"]"):(c.charCodeAt(0)===".".charCodeAt(0)&&(c="*"+c),r.normalizedPattern=c),s?(r.port=s,r.normalizedPattern+=":"+r.port,null==d||d.v4||(c="["+c+"]"),p=i.shExp2RegExp(c),p=p.substring(1,p.length-1),u=null!=(l=r.scheme)?l:"[^:]+",r.url=this.safeRegex("^"+u+":\\/\\/"+p+":"+s+"\\/")):"*"!==c&&(p=i.shExp2RegExp(c,{trimAsterisk:!0}),r.host=this.safeRegex(p)),r))},match:function(e,t,r){if(null!=(r=r.analyzed).scheme&&r.scheme!==t.scheme)return!1;if(null!=r.ip&&!this.match(r.ip,t))return!1;if(null!=r.host){if("<local>"===r.host)return"127.0.0.1"===t.host||"::1"===t.host||t.host.indexOf(".")<0;if(!r.host.test(t.host))return!1}return!(null!=r.url&&!r.url.test(t.url))},str:function(e){let t,r;return t=this._handler(e).analyze,r=t.call(a,e),r.normalizedPattern?r.normalizedPattern:e.pattern},compile:function(e,t){let r,s;if(null!=(t=t.analyzed).url)return this.regTest("url",t.url);if(r=[],"<local>"===t.host)return s=function(e){return new U2.AST_Binary({left:new U2.AST_SymbolRef({name:"host"}),operator:"===",right:new U2.AST_String({value:e})})},new U2.AST_Binary({left:new U2.AST_Binary({left:s("127.0.0.1"),operator:"||",right:s("::1")}),operator:"||",right:new U2.AST_Binary({left:new U2.AST_Call({expression:new U2.AST_Dot({expression:new U2.AST_SymbolRef({name:"host"}),property:"indexOf"}),args:[new U2.AST_String({value:"."})]}),operator:"<",right:new U2.AST_Number({value:0})})});switch(null!=t.scheme&&r.push(new U2.AST_Binary({left:new U2.AST_SymbolRef({name:"scheme"}),operator:"===",right:new U2.AST_String({value:t.scheme})})),null!=t.host?r.push(this.regTest("host",t.host)):null!=t.ip&&r.push(this.compile(t.ip)),r.length){case 0:return new U2.AST_True;case 1:return r[0];case 2:return new U2.AST_Binary({left:r[0],operator:"&&",right:r[1]})}}},KeywordCondition:{abbrs:["K","KW","Keyword"],analyze:function(e){return null},match:function(e,t){return"http"===t.scheme&&t.url.indexOf(e.pattern)>=0},compile:function(e){return new U2.AST_Binary({left:new U2.AST_Binary({left:new U2.AST_SymbolRef({name:"scheme"}),operator:"===",right:new U2.AST_String({value:"http"})}),operator:"&&",right:new U2.AST_Binary({left:new U2.AST_Call({expression:new U2.AST_Dot({expression:new U2.AST_SymbolRef({name:"url"}),property:"indexOf"}),args:[new U2.AST_String({value:e.pattern})]}),operator:">=",right:new U2.AST_Number({value:0})})})}},IpCondition:{abbrs:["Ip"],analyze:function(e){let t,r,s,i;if(r={addr:null,normalized:null},s=e.ip,s.charCodeAt(0)==="[".charCodeAt(0)&&(s=s.substr(1,s.length-2)),t=s+"/"+e.prefixLength,r.addr=this.parseIp(t),null==r.addr)throw new Error("Invalid IP address "+t);return r.normalized=this.normalizeIp(r.addr),i=r.addr.v4?new IP.v4.Address("255.255.255.255/"+r.addr.subnetMask):new IP.v6.Address(this.ipv6Max+"/"+r.addr.subnetMask),r.mask=this.normalizeIp(i.startAddress()),r},match:function(e,t,r){let s;return s=this.parseIp(t.host),null!=s&&(r=r.analyzed,s.v4===r.addr.v4&&s.isInSubnet(r.addr))},compile:function(e,t){let r,s,i;return i=(t=t.analyzed).addr.v4?new U2.AST_Binary({left:new U2.AST_Sub({expression:new U2.AST_SymbolRef({name:"host"}),property:new U2.AST_Binary({left:new U2.AST_Dot({expression:new U2.AST_SymbolRef({name:"host"}),property:"length"}),operator:"-",right:new U2.AST_Number({value:1})})}),operator:">=",right:new U2.AST_Number({value:0})}):new U2.AST_Binary({left:new U2.AST_Call({expression:new U2.AST_Dot({expression:new U2.AST_SymbolRef({name:"host"}),property:"indexOf"}),args:[new U2.AST_String({value:":"})]}),operator:">=",right:new U2.AST_Number({value:0})}),0===t.addr.subnetMask?i:(r=new U2.AST_Call({expression:new U2.AST_SymbolRef({name:"isInNet"}),args:[new U2.AST_SymbolRef({name:"host"}),new U2.AST_String({value:t.normalized}),new U2.AST_String({value:t.mask})]}),t.addr.v4||(s=new U2.AST_Call({expression:new U2.AST_SymbolRef({name:"isInNetEx"}),args:[new U2.AST_SymbolRef({name:"host"}),new U2.AST_String({value:t.normalized+t.addr.subnet})]}),r=new U2.AST_Conditional({condition:new U2.AST_Binary({left:new U2.AST_UnaryPrefix({operator:"typeof",expression:new U2.AST_SymbolRef({name:"isInNetEx"})}),operator:"===",right:new U2.AST_String({value:"function"})}),consequent:s,alternative:r})),new U2.AST_Binary({left:i,operator:"&&",right:r}))},str:function(e){return e.ip+"/"+e.prefixLength},fromStr:function(e,t){let r;return r=this.parseIp(e),null!=r?(t.ip=r.addressMinusSuffix,t.prefixLength=r.subnetMask):(t.ip="0.0.0.0",t.prefixLength=0),t}},HostLevelsCondition:{abbrs:["Lv","Level","Levels","HL","HLv","HLevel","HLevels","HostL","HostLv","HostLevel","HostLevels"],analyze:function(e){return".".charCodeAt(0)},match:function(e,t,r){let s,i,n,o,a;for(s=r.analyzed,i=0,n=o=0,a=t.host.length;0<=a?o<a:o>a;n=0<=a?++o:--o)if(t.host.charCodeAt(n)===s&&(i++,i>e.maxValue))return!1;return i>=e.minValue},compile:function(e){let t;return t={property:"length",expression:{args:["."],expression:{expression:"host",property:"split"}}},this.between(t,e.minValue+1,e.maxValue+1,e.minValue+" <= hostLevels <= "+e.maxValue)},str:function(e){return e.minValue+"~"+e.maxValue},fromStr:function(e,t){let r,s,i;return i=e.split("~"),s=i[0],r=i[1],t.minValue=parseInt(s,10),t.maxValue=parseInt(r,10),t.minValue>0||(t.minValue=1),t.maxValue>0||(t.maxValue=1),t}},WeekdayCondition:{abbrs:["WD","Week","Day","Weekday"],analyze:function(e){return null},match:function(e,t){let r;return r=(new Date).getDay(),e.days?e.days.charCodeAt(r)>64:e.startDay<=r&&r<=e.endDay},compile:function(e){let t;return t=new U2.AST_Call({args:[],expression:new U2.AST_Dot({property:"getDay",expression:new U2.AST_New({args:[],expression:new U2.AST_SymbolRef({name:"Date"})})})}),e.days?new U2.AST_Binary({left:new U2.AST_Call({expression:new U2.AST_Dot({expression:new U2.AST_String({value:e.days}),property:"charCodeAt"}),args:[t]}),operator:">",right:new U2.AST_Number({value:64})}):this.between(t,e.startDay,e.endDay)},str:function(e){return e.days?e.days:e.startDay+"~"+e.endDay},fromStr:function(e,t){let r,s,i,n,o;return e.indexOf("~")<0&&7===e.length?t.days=e:(s=e.split("~"),o=s[0],r=s[1],t.startDay=parseInt(o,10),t.endDay=parseInt(r,10),0<=(i=t.startDay)&&i<=6||(t.startDay=0),0<=(n=t.endDay)&&n<=6||(t.endDay=0)),t}},TimeCondition:{abbrs:["T","Time","Hour"],analyze:function(e){return null},match:function(e,t){let r;return r=(new Date).getHours(),e.startHour<=r&&r<=e.endHour},compile:function(e){let t;return t=new U2.AST_Call({args:[],expression:new U2.AST_Dot({property:"getHours",expression:new U2.AST_New({args:[],expression:new U2.AST_SymbolRef({name:"Date"})})})}),this.between(t,e.startHour,e.endHour)},str:function(e){return e.startHour+"~"+e.endHour},fromStr:function(e,t){let r,s,i,n,o;return s=e.split("~"),o=s[0],r=s[1],t.startHour=parseInt(o,10),t.endHour=parseInt(r,10),0<=(i=t.startHour)&&i<24||(t.startHour=0),0<=(n=t.endHour)&&n<24||(t.endHour=0),t}}}},l={omegaPrefix:"[SwitchyOmega Conditions",specialLineStart:"[;#@!",detect:function(e){if(r(e,l.omegaPrefix))return!0},parse:function(e,t,r){let s,i=l;return s=i.getParser(e),i[s](e,t,r)},directReferenceSet:function(e){let t,r,s,i,n,o,a,u,c,d,p,h,f;if(p=e.ruleList,o=e.matchProfileName,t=e.defaultProfileName,f=p.trim(),h=l,a=h.getParser(f),"parseOmega"===a&&/(^|\n)@with\s+results?(\r|\n|$)/i.test(f)){for(d={},c=f.split(/\n|\r/),r=0,i=c.length;r<i;r++)n=c[r],n=n.trim(),h.specialLineStart.indexOf(n[0])<0&&(s=n.lastIndexOf(" +"),u=s<0?t||"direct":n.substr(s+2).trim(),d["+"+u]=u);return d}},compose:function(e,t){let r,s,i,n,o,u,c,d,p,h,f,m;for(p=e.rules,r=e.defaultProfileName,u=null!=t?t:{},m=u.withResult,f=u.useExclusive,s="\r\n",d="[SwitchyOmega Conditions]\r\n",null==f&&(f=!m),d+=m?"@with result\r\n\r\n":s,h=l.specialLineStart+"+",i=0,n=p.length;i<n;i++)c=p[i],c.note&&(d+="@note "+c.note+s),o=a.str(c.condition),f&&c.profileName===r?o="!"+o:(h.indexOf(o[0])>=0&&(o=": "+o),m&&(o+=" +"+c.profileName)),d+=o+s;return m&&(d+="\r\n* +"+r+s),d},getParser:function(e){let t,s;return s=l,t="parseOmega",r(e,s.omegaPrefix)||("#"===e[0]||e.indexOf("\n#")>=0)&&(t="parseLegacy"),t},conditionFromLegacyWildcard:function(e){let t;return"@"===e[0]?e=e.substring(1):(e.indexOf("://")<=0&&"*"!==e[0]&&(e="*"+e),"*"!==e[e.length-1]&&(e+="*")),t=a.urlWildcard2HostWildcard(e),t?{conditionType:"HostWildcardCondition",pattern:t}:{conditionType:"UrlWildcardCondition",pattern:e}},parseLegacy:function(e,t,r){let s,i,n,o,a,u,c,d,p,h,f,m;for(d=[],n=[],s=!1,f="WILDCARD",h=e.split(/\n|\r/),o=0,a=h.length;o<a;o++)if(u=h[o],u=u.trim(),0!==u.length&&";"!==u[0])if(s){if("#END"===u.toUpperCase())break;"["!==u[0]||"]"!==u[u.length-1]?(m=u,p=t,c=d,"!"===u[0]&&(p=r,c=n,u=u.substring(1)),i=function(){switch(f){case"WILDCARD":return l.conditionFromLegacyWildcard(u);case"REGEXP":return{conditionType:"UrlRegexCondition",pattern:u};default:return null}}(),null!=i&&c.push({condition:i,profileName:p,source:m})):f=u.substring(1,u.length-1).toUpperCase()}else"#BEGIN"===u.toUpperCase()&&(s=!0);return n.concat(d)},parseOmega:function(e,t,r,i){let n,o,l,u,c,d,p,h,f,m,g,y,b,S,x,P,v,R,w,_,T,k,I;for(null==i&&(i={}),k=i.strict,k&&(l=function(e){let t,r,i;for(r in t=new Error(e.message),e)s.call(e,r)&&(i=e[r],t[r]=i);throw t}),h=null==(P=i.source)||P,w=[],_=[],I=!1,u=null,S=null,b=0,v=e.split(/\n|\r/),d=0,m=v.length;d<m;d++)if(y=v[d],b++,y=y.trim(),0!==y.length){switch(y[0]){case"[":case";":continue;case"@":switch(p=y.indexOf(" "),p<0&&(p=y.length),o=y.substr(1,p-1),y=y.substr(p+1).trim(),o.toUpperCase()){case"WITH":c=y.toUpperCase(),"RESULT"!==c&&"RESULTS"!==c||(I=!0);break;case"NOTE":S=y}continue}if(T=null,k&&(u=null),"!"===y[0])x=I?null:r,T=y,y=y.substr(1);else if(I){if(p=y.lastIndexOf(" +"),p<0){"function"==typeof l&&l({message:"Missing result profile name: "+y,reason:"missingResultProfile",source:y,sourceLineNo:b});continue}x=y.substr(p+2).trim(),y=y.substr(0,p).trim(),"*"===y&&(u=x)}else x=t;n=a.fromStr(y),n?(R={condition:n,profileName:x,source:h?null!=T?T:y:void 0},null!=S&&(R.note=S,S=null),w.push(R),x||_.push(R)):"function"==typeof l&&l({message:"Invalid rule: "+y,reason:"invalidRule",source:null!=T?T:y,sourceLineNo:b})}if(I)for(u||(k&&"function"==typeof l&&l({message:"Missing default rule with catch-all '*' condition",reason:"noDefaultRule"}),u=r||"direct"),f=0,g=_.length;f<g;f++)R=_[f],R.profileName=u;return w}};let u={builtinProfiles:{"+direct":{name:"direct",profileType:"DirectProfile",color:"#aaaaaa",builtin:!0},"+system":{name:"system",profileType:"SystemProfile",color:"#000000",builtin:!0}},schemes:[{scheme:"http",prop:"proxyForHttp"},{scheme:"https",prop:"proxyForHttps"},{scheme:"ftp",prop:"proxyForFtp"},{scheme:"",prop:"fallbackProxy"}],pacProtocols:{http:"PROXY",https:"HTTPS",socks4:"SOCKS",socks5:"SOCKS5"},formatByType:{SwitchyRuleListProfile:"Switchy",AutoProxyRuleListProfile:"AutoProxy"},ruleListFormats:["Switchy","AutoProxy"],parseHostPort:function(e,t){let r,s,i;if(i=e.lastIndexOf(":"),!(i<0)&&(s=parseInt(e.substr(i+1))||80,r=e.substr(0,i),r))return{scheme:t,host:r,port:s}},pacResult:function(e){return e?"socks5"===e.scheme?"SOCKS5 "+e.host+":"+e.port+"; SOCKS "+e.host+":"+e.port:u.pacProtocols[e.scheme]+" "+e.host+":"+e.port:"DIRECT"},isFileUrl:function(e){return!("FILE:"!==(null!=e?e.substr(0,5).toUpperCase():void 0))},nameAsKey:function(e){return"string"!=typeof e&&(e=e.name),"+"+e},byName:function(e,t){let r,s;return"string"==typeof e&&(r=u.nameAsKey(e),e=null!=(s=u.builtinProfiles[r])?s:t[r]),e},byKey:function(e,t){let r;return"string"==typeof e&&(e=null!=(r=u.builtinProfiles[e])?r:t[e]),e},each:function(e,t){let r,s,i,n,o;for(s in r="+".charCodeAt(0),e)i=e[s],s.charCodeAt(0)===r&&t(s,i);for(s in n=u.builtinProfiles,o=[],n)i=n[s],s.charCodeAt(0)===r?o.push(t(s,i)):o.push(void 0);return o},profileResult:function(e){let t;return t=u.nameAsKey(e),"+direct"===t&&(t=u.pacResult()),t},isIncludable:function(e){let t;return t=u._handler(e).includable,"function"==typeof t&&(t=t.call(u,e)),!!t},isInclusive:function(e){return!!u._handler(e).inclusive},updateUrl:function(e){let t;return null!=(t=u._handler(e).updateUrl)?t.call(u,e):void 0},updateContentTypeHints:function(e){let t;return null!=(t=u._handler(e).updateContentTypeHints)?t.call(u,e):void 0},update:function(e,t){return u._handler(e).update.call(u,e,t)},tag:function(e){return u._profileCache.tag(e)},create:function(e,t){let r;return"string"==typeof e?e={name:e,profileType:t}:t&&(e.profileType=t),r=u._handler(e).create,r?(r.call(u,e),e):e},updateRevision:function(e,t){return null==t&&(t=Revision.fromTime()),e.revision=t},replaceRef:function(e,t,r){let s;return!!u.isInclusive(e)&&(s=u._handler(e),s.replaceRef.call(u,e,t,r))},analyze:function(e){let t,r,s;return r=u._profileCache.get(e,{}),Object.prototype.hasOwnProperty.call(r,"analyzed")||(t=u._handler(e).analyze,s=null!=t?t.call(u,e):void 0,r.analyzed=s),r},directReferenceSet:function(e){let t,r;return u.isInclusive(e)?(t=u._profileCache.get(e,{}),t.directReferenceSet?t.directReferenceSet:(r=u._handler(e),t.directReferenceSet=r.directReferenceSet.call(u,e))):{}},profileNotFound:function(e,t){if(null==t)throw new Error("Profile "+e+" does not exist!");if("function"==typeof t&&(t=t(e)),"object"==typeof t&&t.profileType)return t;switch(t){case"ignore":return null;case"dumb":return u.create({name:e,profileType:"VirtualProfile",defaultProfileName:"direct"})}throw t},allReferenceSet:function(e,t,r){let s,i,n,o,a,l;if(o=e,null==(e=u.byName(e,t))&&(e="function"==typeof u.profileNotFound?u.profileNotFound(o,r.profileNotFound):void 0),null==r&&(r={}),s=null!=r.out,l=null!=r.out?r.out:r.out={},e)for(i in l[u.nameAsKey(e.name)]=e.name,a=u.directReferenceSet(e),a)n=a[i],u.allReferenceSet(n,t,r);return s||delete r.out,l},referencedBySet:function(e,t,r){let s,i,n;return i=u.nameAsKey(e),null==r&&(r={}),s=null!=r.out,n=null!=r.out?r.out:r.out={},u.each(t,(function(e,s){if(u.directReferenceSet(s)[i])return n[e]=s.name,u.referencedBySet(s,t,r)})),s||delete r.out,n},validResultProfilesFor:function(e,t){let r,s,i;return e=u.byName(e,t),u.isInclusive(e)?(r=u.nameAsKey(e),s=u.referencedBySet(e,t),s[r]=r,i=[],u.each(t,(function(e,t){if(!s[e]&&u.isIncludable(t))return i.push(t)})),i):[]},match:function(e,t,r){let s,i;return null==r&&(r=e.profileType),s=u.analyze(e),i=u._handler(r).match,null!=i?i.call(u,e,t,s):void 0},compile:function(e,t){let r,s;return null==t&&(t=e.profileType),r=u.analyze(e),r.compiled?r.compiled:(s=u._handler(t),r.compiled=s.compile.call(u,e,r))},_profileCache:new n((function(e){return e.revision})),_handler:function(e){let t;for("string"!=typeof e&&(e=e.profileType),t=e;"string"==typeof t;)t=u._profileTypes[t];if(null==t)throw new Error("Unknown profile type: "+e);return t},_profileTypes:{SwitchProfile:{includable:!0,inclusive:!0,create:function(e){return null==e.defaultProfileName&&(e.defaultProfileName="direct"),null!=e.rules?e.rules:e.rules=[]},directReferenceSet:function(e){let t,r,s,i,n;for(i={},i[u.nameAsKey(e.defaultProfileName)]=e.defaultProfileName,s=e.rules,t=0,r=s.length;t<r;t++)n=s[t],i[u.nameAsKey(n.profileName)]=n.profileName;return i},analyze:function(e){return e.rules},replaceRef:function(e,t,r){let s,i,n,o,a;for(s=!1,e.defaultProfileName===t&&(e.defaultProfileName=r,s=!0),o=e.rules,i=0,n=o.length;i<n;i++)a=o[i],a.profileName===t&&(a.profileName=r,s=!0);return s},match:function(e,t,r){let s,i,n,o;for(n=r.analyzed,s=0,i=n.length;s<i;s++)if(o=n[s],a.match(o.condition,t))return o;return[u.nameAsKey(e.defaultProfileName),null]},compile:function(e,t){let r,s,i,n;if(n=t.analyzed,0===n.length)return this.profileResult(e.defaultProfileName);let o=[];for(r=0,s=n.length;r<s;r++){i=n[r];let e=a.compile(i.condition);e.source=i.source,o.push(e)}return{compiled:o,argnames:[{name:"url"},{name:"host"},{name:"scheme"}]}}}}};t.RuleImporterSwitchy={switchy:l,compiler:u}},"./node_modules/pako/dist/pako.esm.mjs":(e,t,r)=>{"use strict";function s(e){let t=e.length;for(;--t>=0;)e[t]=0}r.r(t),r.d(t,{Deflate:()=>cr,Inflate:()=>fr,constants:()=>br,default:()=>Sr,deflate:()=>dr,deflateRaw:()=>pr,gzip:()=>hr,inflate:()=>mr,inflateRaw:()=>gr,ungzip:()=>yr});const i=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),n=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),o=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=new Array(576);s(l);const u=new Array(60);s(u);const c=new Array(512);s(c);const d=new Array(256);s(d);const p=new Array(29);s(p);const h=new Array(30);function f(e,t,r,s,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=s,this.max_length=i,this.has_stree=e&&e.length}let m,g,y;function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}s(h);const S=e=>e<256?c[e]:c[256+(e>>>7)],x=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},P=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},v=(e,t,r)=>{P(e,r[2*t],r[2*t+1])},R=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},w=(e,t,r)=>{const s=new Array(16);let i,n,o=0;for(i=1;i<=15;i++)o=o+r[i-1]<<1,s[i]=o;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=R(s[t]++,t))}},_=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},T=e=>{e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},k=(e,t,r,s)=>{const i=2*t,n=2*r;return e[i]<e[n]||e[i]===e[n]&&s[t]<=s[r]},I=(e,t,r)=>{const s=e.heap[r];let i=r<<1;for(;i<=e.heap_len&&(i<e.heap_len&&k(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!k(t,s,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=s},C=(e,t,r)=>{let s,o,a,l,u=0;if(0!==e.sym_next)do{s=255&e.pending_buf[e.sym_buf+u++],s+=(255&e.pending_buf[e.sym_buf+u++])<<8,o=e.pending_buf[e.sym_buf+u++],0===s?v(e,o,t):(a=d[o],v(e,a+256+1,t),l=i[a],0!==l&&(o-=p[a],P(e,o,l)),s--,a=S(s),v(e,a,r),l=n[a],0!==l&&(s-=h[a],P(e,s,l)))}while(u<e.sym_next);v(e,256,t)},A=(e,t)=>{const r=t.dyn_tree,s=t.stat_desc.static_tree,i=t.stat_desc.has_stree,n=t.stat_desc.elems;let o,a,l,u=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<n;o++)0!==r[2*o]?(e.heap[++e.heap_len]=u=o,e.depth[o]=0):r[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=u<2?++u:0,r[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=s[2*l+1]);for(t.max_code=u,o=e.heap_len>>1;o>=1;o--)I(e,r,o);l=n;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],I(e,r,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,r[2*l]=r[2*o]+r[2*a],e.depth[l]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,r[2*o+1]=r[2*a+1]=l,e.heap[1]=l++,I(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,s=t.max_code,i=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,l=t.stat_desc.max_length;let u,c,d,p,h,f,m=0;for(p=0;p<=15;p++)e.bl_count[p]=0;for(r[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)c=e.heap[u],p=r[2*r[2*c+1]+1]+1,p>l&&(p=l,m++),r[2*c+1]=p,c>s||(e.bl_count[p]++,h=0,c>=a&&(h=o[c-a]),f=r[2*c],e.opt_len+=f*(p+h),n&&(e.static_len+=f*(i[2*c+1]+h)));if(0!==m){do{for(p=l-1;0===e.bl_count[p];)p--;e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(p=l;0!==p;p--)for(c=e.bl_count[p];0!==c;)d=e.heap[--u],d>s||(r[2*d+1]!==p&&(e.opt_len+=(p-r[2*d+1])*r[2*d],r[2*d+1]=p),c--)}})(e,t),w(r,u,e.bl_count)},D=(e,t,r)=>{let s,i,n=-1,o=t[1],a=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(r+1)+1]=65535,s=0;s<=r;s++)i=o,o=t[2*(s+1)+1],++a<l&&i===o||(a<u?e.bl_tree[2*i]+=a:0!==i?(i!==n&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,n=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))},U=(e,t,r)=>{let s,i,n=-1,o=t[1],a=0,l=7,u=4;for(0===o&&(l=138,u=3),s=0;s<=r;s++)if(i=o,o=t[2*(s+1)+1],!(++a<l&&i===o)){if(a<u)do{v(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==n&&(v(e,i,e.bl_tree),a--),v(e,16,e.bl_tree),P(e,a-3,2)):a<=10?(v(e,17,e.bl_tree),P(e,a-3,3)):(v(e,18,e.bl_tree),P(e,a-11,7));a=0,n=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4)}};let E=!1;const L=(e,t,r,s)=>{P(e,0+(s?1:0),3),T(e),x(e,r),x(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var z={_tr_init:e=>{E||((()=>{let e,t,r,s,a;const b=new Array(16);for(r=0,s=0;s<28;s++)for(p[s]=r,e=0;e<1<<i[s];e++)d[r++]=s;for(d[r-1]=s,a=0,s=0;s<16;s++)for(h[s]=a,e=0;e<1<<n[s];e++)c[a++]=s;for(a>>=7;s<30;s++)for(h[s]=a<<7,e=0;e<1<<n[s]-7;e++)c[256+a++]=s;for(t=0;t<=15;t++)b[t]=0;for(e=0;e<=143;)l[2*e+1]=8,e++,b[8]++;for(;e<=255;)l[2*e+1]=9,e++,b[9]++;for(;e<=279;)l[2*e+1]=7,e++,b[7]++;for(;e<=287;)l[2*e+1]=8,e++,b[8]++;for(w(l,287,b),e=0;e<30;e++)u[2*e+1]=5,u[2*e]=R(e,5);m=new f(l,i,257,286,15),g=new f(u,n,0,30,15),y=new f(new Array(0),o,0,19,7)})(),E=!0),e.l_desc=new b(e.dyn_ltree,m),e.d_desc=new b(e.dyn_dtree,g),e.bl_desc=new b(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,_(e)},_tr_stored_block:L,_tr_flush_block:(e,t,r,s)=>{let i,n,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),A(e,e.l_desc),A(e,e.d_desc),o=(e=>{let t;for(D(e,e.dyn_ltree,e.l_desc.max_code),D(e,e.dyn_dtree,e.d_desc.max_code),A(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*a[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=i&&(i=n)):i=n=r+5,r+4<=i&&-1!==t?L(e,t,r,s):4===e.strategy||n===i?(P(e,2+(s?1:0),3),C(e,l,u)):(P(e,4+(s?1:0),3),((e,t,r,s)=>{let i;for(P(e,t-257,5),P(e,r-1,5),P(e,s-4,4),i=0;i<s;i++)P(e,e.bl_tree[2*a[i]+1],3);U(e,e.dyn_ltree,t-1),U(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),C(e,e.dyn_ltree,e.dyn_dtree)),_(e),s&&T(e)},_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(d[r]+256+1)]++,e.dyn_dtree[2*S(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{P(e,2,3),v(e,256,l),(e=>{16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},F=(e,t,r,s)=>{let i=65535&e|0,n=e>>>16&65535|0,o=0;for(;0!==r;){o=r>2e3?2e3:r,r-=o;do{i=i+t[s++]|0,n=n+i|0}while(--o);i%=65521,n%=65521}return i|n<<16|0};const O=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var M=(e,t,r,s)=>{const i=O,n=s+r;e^=-1;for(let r=s;r<n;r++)e=e>>>8^i[255&(e^t[r])];return-1^e},N={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},B={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:H,_tr_stored_block:W,_tr_flush_block:$,_tr_tally:j,_tr_align:q}=z,{Z_NO_FLUSH:G,Z_PARTIAL_FLUSH:Z,Z_FULL_FLUSH:V,Z_FINISH:K,Z_BLOCK:Q,Z_OK:J,Z_STREAM_END:Y,Z_STREAM_ERROR:X,Z_DATA_ERROR:ee,Z_BUF_ERROR:te,Z_DEFAULT_COMPRESSION:re,Z_FILTERED:se,Z_HUFFMAN_ONLY:ie,Z_RLE:ne,Z_FIXED:oe,Z_DEFAULT_STRATEGY:ae,Z_UNKNOWN:le,Z_DEFLATED:ue}=B,ce=258,de=262,pe=42,he=113,fe=666,me=(e,t)=>(e.msg=N[t],t),ge=e=>2*e-(e>4?9:0),ye=e=>{let t=e.length;for(;--t>=0;)e[t]=0},be=e=>{let t,r,s,i=e.w_size;t=e.hash_size,s=t;do{r=e.head[--s],e.head[s]=r>=i?r-i:0}while(--t);t=i,s=t;do{r=e.prev[--s],e.prev[s]=r>=i?r-i:0}while(--t)};let Se=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const xe=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},Pe=(e,t)=>{$(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,xe(e.strm)},ve=(e,t)=>{e.pending_buf[e.pending++]=t},Re=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},we=(e,t,r,s)=>{let i=e.avail_in;return i>s&&(i=s),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),r),1===e.state.wrap?e.adler=F(e.adler,t,i,r):2===e.state.wrap&&(e.adler=M(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)},_e=(e,t)=>{let r,s,i=e.max_chain_length,n=e.strstart,o=e.prev_length,a=e.nice_match;const l=e.strstart>e.w_size-de?e.strstart-(e.w_size-de):0,u=e.window,c=e.w_mask,d=e.prev,p=e.strstart+ce;let h=u[n+o-1],f=u[n+o];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(r=t,u[r+o]===f&&u[r+o-1]===h&&u[r]===u[n]&&u[++r]===u[n+1]){n+=2,r++;do{}while(u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&u[++n]===u[++r]&&n<p);if(s=ce-(p-n),n=p-ce,s>o){if(e.match_start=t,o=s,s>=a)break;h=u[n+o-1],f=u[n+o]}}}while((t=d[t&c])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead},Te=e=>{const t=e.w_size;let r,s,i;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-de)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),be(e),s+=t),0===e.strm.avail_in)break;if(r=we(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=r,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Se(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Se(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<de&&0!==e.strm.avail_in)},ke=(e,t)=>{let r,s,i,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,a=e.strm.avail_in;do{if(r=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,s=e.strstart-e.block_start,r>s+e.strm.avail_in&&(r=s+e.strm.avail_in),r>i&&(r=i),r<n&&(0===r&&t!==K||t===G||r!==s+e.strm.avail_in))break;o=t===K&&r===s+e.strm.avail_in?1:0,W(e,0,0,o),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,xe(e.strm),s&&(s>r&&(s=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,r-=s),r&&(we(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===o);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==G&&t!==K&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(we(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,n=i>e.w_size?e.w_size:i,s=e.strstart-e.block_start,(s>=n||(s||t===K)&&t!==G&&0===e.strm.avail_in&&s<=i)&&(r=s>i?i:s,o=t===K&&0===e.strm.avail_in&&r===s?1:0,W(e,e.block_start,r,o),e.block_start+=r,xe(e.strm)),o?3:1)},Ie=(e,t)=>{let r,s;for(;;){if(e.lookahead<de){if(Te(e),e.lookahead<de&&t===G)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=Se(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-de&&(e.match_length=_e(e,r)),e.match_length>=3)if(s=j(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Se(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Se(e,e.ins_h,e.window[e.strstart+1]);else s=j(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(Pe(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===K?(Pe(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Pe(e,!1),0===e.strm.avail_out)?1:2},Ce=(e,t)=>{let r,s,i;for(;;){if(e.lookahead<de){if(Te(e),e.lookahead<de&&t===G)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=Se(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-de&&(e.match_length=_e(e,r),e.match_length<=5&&(e.strategy===se||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,s=j(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=Se(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(Pe(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=j(e,0,e.window[e.strstart-1]),s&&Pe(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=j(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===K?(Pe(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Pe(e,!1),0===e.strm.avail_out)?1:2};function Ae(e,t,r,s,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=s,this.func=i}const De=[new Ae(0,0,0,0,ke),new Ae(4,4,8,4,Ie),new Ae(4,5,16,8,Ie),new Ae(4,6,32,32,Ie),new Ae(4,4,16,16,Ce),new Ae(8,16,32,32,Ce),new Ae(8,16,128,128,Ce),new Ae(8,32,128,256,Ce),new Ae(32,128,258,1024,Ce),new Ae(32,258,258,4096,Ce)];function Ue(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ue,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ye(this.dyn_ltree),ye(this.dyn_dtree),ye(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ye(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ye(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ee=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==pe&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==he&&t.status!==fe?1:0},Le=e=>{if(Ee(e))return me(e,X);e.total_in=e.total_out=0,e.data_type=le;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?pe:he,e.adler=2===t.wrap?0:1,t.last_flush=-2,H(t),J},ze=e=>{const t=Le(e);var r;return t===J&&((r=e.state).window_size=2*r.w_size,ye(r.head),r.max_lazy_match=De[r.level].max_lazy,r.good_match=De[r.level].good_length,r.nice_match=De[r.level].nice_length,r.max_chain_length=De[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),t},Fe=(e,t,r,s,i,n)=>{if(!e)return X;let o=1;if(t===re&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),i<1||i>9||r!==ue||s<8||s>15||t<0||t>9||n<0||n>oe||8===s&&1!==o)return me(e,X);8===s&&(s=9);const a=new Ue;return e.state=a,a.strm=e,a.status=pe,a.wrap=o,a.gzhead=null,a.w_bits=s,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=n,a.method=r,ze(e)};var Oe={deflateInit:(e,t)=>Fe(e,t,ue,15,8,ae),deflateInit2:Fe,deflateReset:ze,deflateResetKeep:Le,deflateSetHeader:(e,t)=>Ee(e)||2!==e.state.wrap?X:(e.state.gzhead=t,J),deflate:(e,t)=>{if(Ee(e)||t>Q||t<0)return e?me(e,X):X;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===fe&&t!==K)return me(e,0===e.avail_out?te:X);const s=r.last_flush;if(r.last_flush=t,0!==r.pending){if(xe(e),0===e.avail_out)return r.last_flush=-1,J}else if(0===e.avail_in&&ge(t)<=ge(s)&&t!==K)return me(e,te);if(r.status===fe&&0!==e.avail_in)return me(e,te);if(r.status===pe&&0===r.wrap&&(r.status=he),r.status===pe){let t=ue+(r.w_bits-8<<4)<<8,s=-1;if(s=r.strategy>=ie||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=s<<6,0!==r.strstart&&(t|=32),t+=31-t%31,Re(r,t),0!==r.strstart&&(Re(r,e.adler>>>16),Re(r,65535&e.adler)),e.adler=1,r.status=he,xe(e),0!==r.pending)return r.last_flush=-1,J}if(57===r.status)if(e.adler=0,ve(r,31),ve(r,139),ve(r,8),r.gzhead)ve(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ve(r,255&r.gzhead.time),ve(r,r.gzhead.time>>8&255),ve(r,r.gzhead.time>>16&255),ve(r,r.gzhead.time>>24&255),ve(r,9===r.level?2:r.strategy>=ie||r.level<2?4:0),ve(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ve(r,255&r.gzhead.extra.length),ve(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=M(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(ve(r,0),ve(r,0),ve(r,0),ve(r,0),ve(r,0),ve(r,9===r.level?2:r.strategy>=ie||r.level<2?4:0),ve(r,3),r.status=he,xe(e),0!==r.pending)return r.last_flush=-1,J;if(69===r.status){if(r.gzhead.extra){let t=r.pending,s=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+s>r.pending_buf_size;){let i=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=M(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=i,xe(e),0!==r.pending)return r.last_flush=-1,J;t=0,s-=i}let i=new Uint8Array(r.gzhead.extra);r.pending_buf.set(i.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending+=s,r.gzhead.hcrc&&r.pending>t&&(e.adler=M(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,s=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(e.adler=M(e.adler,r.pending_buf,r.pending-s,s)),xe(e),0!==r.pending)return r.last_flush=-1,J;s=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ve(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>s&&(e.adler=M(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,s=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(e.adler=M(e.adler,r.pending_buf,r.pending-s,s)),xe(e),0!==r.pending)return r.last_flush=-1,J;s=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ve(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>s&&(e.adler=M(e.adler,r.pending_buf,r.pending-s,s))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(xe(e),0!==r.pending))return r.last_flush=-1,J;ve(r,255&e.adler),ve(r,e.adler>>8&255),e.adler=0}if(r.status=he,xe(e),0!==r.pending)return r.last_flush=-1,J}if(0!==e.avail_in||0!==r.lookahead||t!==G&&r.status!==fe){let s=0===r.level?ke(r,t):r.strategy===ie?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(Te(e),0===e.lookahead)){if(t===G)return 1;break}if(e.match_length=0,r=j(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Pe(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===K?(Pe(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Pe(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===ne?((e,t)=>{let r,s,i,n;const o=e.window;for(;;){if(e.lookahead<=ce){if(Te(e),e.lookahead<=ce&&t===G)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,s=o[i],s===o[++i]&&s===o[++i]&&s===o[++i])){n=e.strstart+ce;do{}while(s===o[++i]&&s===o[++i]&&s===o[++i]&&s===o[++i]&&s===o[++i]&&s===o[++i]&&s===o[++i]&&s===o[++i]&&i<n);e.match_length=ce-(n-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=j(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=j(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Pe(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===K?(Pe(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Pe(e,!1),0===e.strm.avail_out)?1:2})(r,t):De[r.level].func(r,t);if(3!==s&&4!==s||(r.status=fe),1===s||3===s)return 0===e.avail_out&&(r.last_flush=-1),J;if(2===s&&(t===Z?q(r):t!==Q&&(W(r,0,0,!1),t===V&&(ye(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),xe(e),0===e.avail_out))return r.last_flush=-1,J}return t!==K?J:r.wrap<=0?Y:(2===r.wrap?(ve(r,255&e.adler),ve(r,e.adler>>8&255),ve(r,e.adler>>16&255),ve(r,e.adler>>24&255),ve(r,255&e.total_in),ve(r,e.total_in>>8&255),ve(r,e.total_in>>16&255),ve(r,e.total_in>>24&255)):(Re(r,e.adler>>>16),Re(r,65535&e.adler)),xe(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?J:Y)},deflateEnd:e=>{if(Ee(e))return X;const t=e.state.status;return e.state=null,t===he?me(e,ee):J},deflateSetDictionary:(e,t)=>{let r=t.length;if(Ee(e))return X;const s=e.state,i=s.wrap;if(2===i||1===i&&s.status!==pe||s.lookahead)return X;if(1===i&&(e.adler=F(e.adler,t,r,0)),s.wrap=0,r>=s.w_size){0===i&&(ye(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(r-s.w_size,r),0),t=e,r=s.w_size}const n=e.avail_in,o=e.next_in,a=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Te(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=Se(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,Te(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=o,e.input=a,e.avail_in=n,s.wrap=i,J},deflateInfo:"pako deflate (from Nodeca project)"};const Me=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Ne={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)Me(r,t)&&(e[t]=r[t])}}return e},flattenChunks:e=>{let t=0;for(let r=0,s=e.length;r<s;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,s=0,i=e.length;t<i;t++){let i=e[t];r.set(i,s),s+=i.length}return r}};let Be=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Be=!1}const He=new Uint8Array(256);for(let e=0;e<256;e++)He[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;He[254]=He[254]=1;var We={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,s,i,n,o=e.length,a=0;for(i=0;i<o;i++)r=e.charCodeAt(i),55296==(64512&r)&&i+1<o&&(s=e.charCodeAt(i+1),56320==(64512&s)&&(r=65536+(r-55296<<10)+(s-56320),i++)),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(a),n=0,i=0;n<a;i++)r=e.charCodeAt(i),55296==(64512&r)&&i+1<o&&(s=e.charCodeAt(i+1),56320==(64512&s)&&(r=65536+(r-55296<<10)+(s-56320),i++)),r<128?t[n++]=r:r<2048?(t[n++]=192|r>>>6,t[n++]=128|63&r):r<65536?(t[n++]=224|r>>>12,t[n++]=128|r>>>6&63,t[n++]=128|63&r):(t[n++]=240|r>>>18,t[n++]=128|r>>>12&63,t[n++]=128|r>>>6&63,t[n++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,i;const n=new Array(2*r);for(i=0,s=0;s<r;){let t=e[s++];if(t<128){n[i++]=t;continue}let o=He[t];if(o>4)n[i++]=65533,s+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&s<r;)t=t<<6|63&e[s++],o--;o>1?n[i++]=65533:t<65536?n[i++]=t:(t-=65536,n[i++]=55296|t>>10&1023,n[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Be)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let s=0;s<t;s++)r+=String.fromCharCode(e[s]);return r})(n,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+He[e[r]]>t?r:t}},$e=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const je=Object.prototype.toString,{Z_NO_FLUSH:qe,Z_SYNC_FLUSH:Ge,Z_FULL_FLUSH:Ze,Z_FINISH:Ve,Z_OK:Ke,Z_STREAM_END:Qe,Z_DEFAULT_COMPRESSION:Je,Z_DEFAULT_STRATEGY:Ye,Z_DEFLATED:Xe}=B;function et(e){this.options=Ne.assign({level:Je,method:Xe,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ye},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $e,this.strm.avail_out=0;let r=Oe.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Ke)throw new Error(N[r]);if(t.header&&Oe.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?We.string2buf(t.dictionary):"[object ArrayBuffer]"===je.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=Oe.deflateSetDictionary(this.strm,e),r!==Ke)throw new Error(N[r]);this._dict_set=!0}}function tt(e,t){const r=new et(t);if(r.push(e,!0),r.err)throw r.msg||N[r.err];return r.result}et.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize;let i,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Ve:qe,"string"==typeof e?r.input=We.string2buf(e):"[object ArrayBuffer]"===je.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),(n===Ge||n===Ze)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=Oe.deflate(r,n),i===Qe)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=Oe.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Ke;if(0!==r.avail_out){if(n>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},et.prototype.onData=function(e){this.chunks.push(e)},et.prototype.onEnd=function(e){e===Ke&&(this.result=Ne.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var rt={Deflate:et,deflate:tt,deflateRaw:function(e,t){return(t=t||{}).raw=!0,tt(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,tt(e,t)},constants:B};const st=16209;var it=function(e,t){let r,s,i,n,o,a,l,u,c,d,p,h,f,m,g,y,b,S,x,P,v,R,w,_;const T=e.state;r=e.next_in,w=e.input,s=r+(e.avail_in-5),i=e.next_out,_=e.output,n=i-(t-e.avail_out),o=i+(e.avail_out-257),a=T.dmax,l=T.wsize,u=T.whave,c=T.wnext,d=T.window,p=T.hold,h=T.bits,f=T.lencode,m=T.distcode,g=(1<<T.lenbits)-1,y=(1<<T.distbits)-1;e:do{h<15&&(p+=w[r++]<<h,h+=8,p+=w[r++]<<h,h+=8),b=f[p&g];t:for(;;){if(S=b>>>24,p>>>=S,h-=S,S=b>>>16&255,0===S)_[i++]=65535&b;else{if(!(16&S)){if(0==(64&S)){b=f[(65535&b)+(p&(1<<S)-1)];continue t}if(32&S){T.mode=16191;break e}e.msg="invalid literal/length code",T.mode=st;break e}x=65535&b,S&=15,S&&(h<S&&(p+=w[r++]<<h,h+=8),x+=p&(1<<S)-1,p>>>=S,h-=S),h<15&&(p+=w[r++]<<h,h+=8,p+=w[r++]<<h,h+=8),b=m[p&y];r:for(;;){if(S=b>>>24,p>>>=S,h-=S,S=b>>>16&255,!(16&S)){if(0==(64&S)){b=m[(65535&b)+(p&(1<<S)-1)];continue r}e.msg="invalid distance code",T.mode=st;break e}if(P=65535&b,S&=15,h<S&&(p+=w[r++]<<h,h+=8,h<S&&(p+=w[r++]<<h,h+=8)),P+=p&(1<<S)-1,P>a){e.msg="invalid distance too far back",T.mode=st;break e}if(p>>>=S,h-=S,S=i-n,P>S){if(S=P-S,S>u&&T.sane){e.msg="invalid distance too far back",T.mode=st;break e}if(v=0,R=d,0===c){if(v+=l-S,S<x){x-=S;do{_[i++]=d[v++]}while(--S);v=i-P,R=_}}else if(c<S){if(v+=l+c-S,S-=c,S<x){x-=S;do{_[i++]=d[v++]}while(--S);if(v=0,c<x){S=c,x-=S;do{_[i++]=d[v++]}while(--S);v=i-P,R=_}}}else if(v+=c-S,S<x){x-=S;do{_[i++]=d[v++]}while(--S);v=i-P,R=_}for(;x>2;)_[i++]=R[v++],_[i++]=R[v++],_[i++]=R[v++],x-=3;x&&(_[i++]=R[v++],x>1&&(_[i++]=R[v++]))}else{v=i-P;do{_[i++]=_[v++],_[i++]=_[v++],_[i++]=_[v++],x-=3}while(x>2);x&&(_[i++]=_[v++],x>1&&(_[i++]=_[v++]))}break}}break}}while(r<s&&i<o);x=h>>3,r-=x,h-=x<<3,p&=(1<<h)-1,e.next_in=r,e.next_out=i,e.avail_in=r<s?s-r+5:5-(r-s),e.avail_out=i<o?o-i+257:257-(i-o),T.hold=p,T.bits=h};const nt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ot=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),at=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),lt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ut=(e,t,r,s,i,n,o,a)=>{const l=a.bits;let u,c,d,p,h,f,m=0,g=0,y=0,b=0,S=0,x=0,P=0,v=0,R=0,w=0,_=null;const T=new Uint16Array(16),k=new Uint16Array(16);let I,C,A,D=null;for(m=0;m<=15;m++)T[m]=0;for(g=0;g<s;g++)T[t[r+g]]++;for(S=l,b=15;b>=1&&0===T[b];b--);if(S>b&&(S=b),0===b)return i[n++]=20971520,i[n++]=20971520,a.bits=1,0;for(y=1;y<b&&0===T[y];y++);for(S<y&&(S=y),v=1,m=1;m<=15;m++)if(v<<=1,v-=T[m],v<0)return-1;if(v>0&&(0===e||1!==b))return-1;for(k[1]=0,m=1;m<15;m++)k[m+1]=k[m]+T[m];for(g=0;g<s;g++)0!==t[r+g]&&(o[k[t[r+g]]++]=g);if(0===e?(_=D=o,f=20):1===e?(_=nt,D=ot,f=257):(_=at,D=lt,f=0),w=0,g=0,m=y,h=n,x=S,P=0,d=-1,R=1<<S,p=R-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){I=m-P,o[g]+1<f?(C=0,A=o[g]):o[g]>=f?(C=D[o[g]-f],A=_[o[g]-f]):(C=96,A=0),u=1<<m-P,c=1<<x,y=c;do{c-=u,i[h+(w>>P)+c]=I<<24|C<<16|A|0}while(0!==c);for(u=1<<m-1;w&u;)u>>=1;if(0!==u?(w&=u-1,w+=u):w=0,g++,0==--T[m]){if(m===b)break;m=t[r+o[g]]}if(m>S&&(w&p)!==d){for(0===P&&(P=S),h+=y,x=m-P,v=1<<x;x+P<b&&(v-=T[x+P],!(v<=0));)x++,v<<=1;if(R+=1<<x,1===e&&R>852||2===e&&R>592)return 1;d=w&p,i[d]=S<<24|x<<16|h-n|0}}return 0!==w&&(i[h+w]=m-P<<24|64<<16|0),a.bits=S,0};const{Z_FINISH:ct,Z_BLOCK:dt,Z_TREES:pt,Z_OK:ht,Z_STREAM_END:ft,Z_NEED_DICT:mt,Z_STREAM_ERROR:gt,Z_DATA_ERROR:yt,Z_MEM_ERROR:bt,Z_BUF_ERROR:St,Z_DEFLATED:xt}=B,Pt=16180,vt=16190,Rt=16191,wt=16192,_t=16194,Tt=16199,kt=16200,It=16206,Ct=16209,At=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Dt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ut=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Pt||t.mode>16211?1:0},Et=e=>{if(Ut(e))return gt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Pt,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,ht},Lt=e=>{if(Ut(e))return gt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Et(e)},zt=(e,t)=>{let r;if(Ut(e))return gt;const s=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?gt:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=r,s.wbits=t,Lt(e))},Ft=(e,t)=>{if(!e)return gt;const r=new Dt;e.state=r,r.strm=e,r.window=null,r.mode=Pt;const s=zt(e,t);return s!==ht&&(e.state=null),s};let Ot,Mt,Nt=!0;const Bt=e=>{if(Nt){Ot=new Int32Array(512),Mt=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ut(1,e.lens,0,288,Ot,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ut(2,e.lens,0,32,Mt,0,e.work,{bits:5}),Nt=!1}e.lencode=Ot,e.lenbits=9,e.distcode=Mt,e.distbits=5},Ht=(e,t,r,s)=>{let i;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),s>=n.wsize?(n.window.set(t.subarray(r-n.wsize,r),0),n.wnext=0,n.whave=n.wsize):(i=n.wsize-n.wnext,i>s&&(i=s),n.window.set(t.subarray(r-s,r-s+i),n.wnext),(s-=i)?(n.window.set(t.subarray(r-s,r),0),n.wnext=s,n.whave=n.wsize):(n.wnext+=i,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=i))),0};var Wt={inflateReset:Lt,inflateReset2:zt,inflateResetKeep:Et,inflateInit:e=>Ft(e,15),inflateInit2:Ft,inflate:(e,t)=>{let r,s,i,n,o,a,l,u,c,d,p,h,f,m,g,y,b,S,x,P,v,R,w=0;const _=new Uint8Array(4);let T,k;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ut(e)||!e.output||!e.input&&0!==e.avail_in)return gt;r=e.state,r.mode===Rt&&(r.mode=wt),o=e.next_out,i=e.output,l=e.avail_out,n=e.next_in,s=e.input,a=e.avail_in,u=r.hold,c=r.bits,d=a,p=l,R=ht;e:for(;;)switch(r.mode){case Pt:if(0===r.wrap){r.mode=wt;break}for(;c<16;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}if(2&r.wrap&&35615===u){0===r.wbits&&(r.wbits=15),r.check=0,_[0]=255&u,_[1]=u>>>8&255,r.check=M(r.check,_,2,0),u=0,c=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=Ct;break}if((15&u)!==xt){e.msg="unknown compression method",r.mode=Ct;break}if(u>>>=4,c-=4,v=8+(15&u),0===r.wbits&&(r.wbits=v),v>15||v>r.wbits){e.msg="invalid window size",r.mode=Ct;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&u?16189:Rt,u=0,c=0;break;case 16181:for(;c<16;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}if(r.flags=u,(255&r.flags)!==xt){e.msg="unknown compression method",r.mode=Ct;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=Ct;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&4&r.wrap&&(_[0]=255&u,_[1]=u>>>8&255,r.check=M(r.check,_,2,0)),u=0,c=0,r.mode=16182;case 16182:for(;c<32;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}r.head&&(r.head.time=u),512&r.flags&&4&r.wrap&&(_[0]=255&u,_[1]=u>>>8&255,_[2]=u>>>16&255,_[3]=u>>>24&255,r.check=M(r.check,_,4,0)),u=0,c=0,r.mode=16183;case 16183:for(;c<16;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&4&r.wrap&&(_[0]=255&u,_[1]=u>>>8&255,r.check=M(r.check,_,2,0)),u=0,c=0,r.mode=16184;case 16184:if(1024&r.flags){for(;c<16;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&4&r.wrap&&(_[0]=255&u,_[1]=u>>>8&255,r.check=M(r.check,_,2,0)),u=0,c=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(h=r.length,h>a&&(h=a),h&&(r.head&&(v=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(s.subarray(n,n+h),v)),512&r.flags&&4&r.wrap&&(r.check=M(r.check,s,h,n)),a-=h,n+=h,r.length-=h),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===a)break e;h=0;do{v=s[n+h++],r.head&&v&&r.length<65536&&(r.head.name+=String.fromCharCode(v))}while(v&&h<a);if(512&r.flags&&4&r.wrap&&(r.check=M(r.check,s,h,n)),a-=h,n+=h,v)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===a)break e;h=0;do{v=s[n+h++],r.head&&v&&r.length<65536&&(r.head.comment+=String.fromCharCode(v))}while(v&&h<a);if(512&r.flags&&4&r.wrap&&(r.check=M(r.check,s,h,n)),a-=h,n+=h,v)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;c<16;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}if(4&r.wrap&&u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=Ct;break}u=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Rt;break;case 16189:for(;c<32;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}e.adler=r.check=At(u),u=0,c=0,r.mode=vt;case vt:if(0===r.havedict)return e.next_out=o,e.avail_out=l,e.next_in=n,e.avail_in=a,r.hold=u,r.bits=c,mt;e.adler=r.check=1,r.mode=Rt;case Rt:if(t===dt||t===pt)break e;case wt:if(r.last){u>>>=7&c,c-=7&c,r.mode=It;break}for(;c<3;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}switch(r.last=1&u,u>>>=1,c-=1,3&u){case 0:r.mode=16193;break;case 1:if(Bt(r),r.mode=Tt,t===pt){u>>>=2,c-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=Ct}u>>>=2,c-=2;break;case 16193:for(u>>>=7&c,c-=7&c;c<32;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Ct;break}if(r.length=65535&u,u=0,c=0,r.mode=_t,t===pt)break e;case _t:r.mode=16195;case 16195:if(h=r.length,h){if(h>a&&(h=a),h>l&&(h=l),0===h)break e;i.set(s.subarray(n,n+h),o),a-=h,n+=h,l-=h,o+=h,r.length-=h;break}r.mode=Rt;break;case 16196:for(;c<14;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}if(r.nlen=257+(31&u),u>>>=5,c-=5,r.ndist=1+(31&u),u>>>=5,c-=5,r.ncode=4+(15&u),u>>>=4,c-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Ct;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;c<3;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}r.lens[I[r.have++]]=7&u,u>>>=3,c-=3}for(;r.have<19;)r.lens[I[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,T={bits:r.lenbits},R=ut(0,r.lens,0,19,r.lencode,0,r.work,T),r.lenbits=T.bits,R){e.msg="invalid code lengths set",r.mode=Ct;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;w=r.lencode[u&(1<<r.lenbits)-1],g=w>>>24,y=w>>>16&255,b=65535&w,!(g<=c);){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}if(b<16)u>>>=g,c-=g,r.lens[r.have++]=b;else{if(16===b){for(k=g+2;c<k;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}if(u>>>=g,c-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=Ct;break}v=r.lens[r.have-1],h=3+(3&u),u>>>=2,c-=2}else if(17===b){for(k=g+3;c<k;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}u>>>=g,c-=g,v=0,h=3+(7&u),u>>>=3,c-=3}else{for(k=g+7;c<k;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}u>>>=g,c-=g,v=0,h=11+(127&u),u>>>=7,c-=7}if(r.have+h>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Ct;break}for(;h--;)r.lens[r.have++]=v}}if(r.mode===Ct)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=Ct;break}if(r.lenbits=9,T={bits:r.lenbits},R=ut(1,r.lens,0,r.nlen,r.lencode,0,r.work,T),r.lenbits=T.bits,R){e.msg="invalid literal/lengths set",r.mode=Ct;break}if(r.distbits=6,r.distcode=r.distdyn,T={bits:r.distbits},R=ut(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,T),r.distbits=T.bits,R){e.msg="invalid distances set",r.mode=Ct;break}if(r.mode=Tt,t===pt)break e;case Tt:r.mode=kt;case kt:if(a>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=n,e.avail_in=a,r.hold=u,r.bits=c,it(e,p),o=e.next_out,i=e.output,l=e.avail_out,n=e.next_in,s=e.input,a=e.avail_in,u=r.hold,c=r.bits,r.mode===Rt&&(r.back=-1);break}for(r.back=0;w=r.lencode[u&(1<<r.lenbits)-1],g=w>>>24,y=w>>>16&255,b=65535&w,!(g<=c);){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}if(y&&0==(240&y)){for(S=g,x=y,P=b;w=r.lencode[P+((u&(1<<S+x)-1)>>S)],g=w>>>24,y=w>>>16&255,b=65535&w,!(S+g<=c);){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}u>>>=S,c-=S,r.back+=S}if(u>>>=g,c-=g,r.back+=g,r.length=b,0===y){r.mode=16205;break}if(32&y){r.back=-1,r.mode=Rt;break}if(64&y){e.msg="invalid literal/length code",r.mode=Ct;break}r.extra=15&y,r.mode=16201;case 16201:if(r.extra){for(k=r.extra;c<k;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;w=r.distcode[u&(1<<r.distbits)-1],g=w>>>24,y=w>>>16&255,b=65535&w,!(g<=c);){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}if(0==(240&y)){for(S=g,x=y,P=b;w=r.distcode[P+((u&(1<<S+x)-1)>>S)],g=w>>>24,y=w>>>16&255,b=65535&w,!(S+g<=c);){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}u>>>=S,c-=S,r.back+=S}if(u>>>=g,c-=g,r.back+=g,64&y){e.msg="invalid distance code",r.mode=Ct;break}r.offset=b,r.extra=15&y,r.mode=16203;case 16203:if(r.extra){for(k=r.extra;c<k;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Ct;break}r.mode=16204;case 16204:if(0===l)break e;if(h=p-l,r.offset>h){if(h=r.offset-h,h>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Ct;break}h>r.wnext?(h-=r.wnext,f=r.wsize-h):f=r.wnext-h,h>r.length&&(h=r.length),m=r.window}else m=i,f=o-r.offset,h=r.length;h>l&&(h=l),l-=h,r.length-=h;do{i[o++]=m[f++]}while(--h);0===r.length&&(r.mode=kt);break;case 16205:if(0===l)break e;i[o++]=r.length,l--,r.mode=kt;break;case It:if(r.wrap){for(;c<32;){if(0===a)break e;a--,u|=s[n++]<<c,c+=8}if(p-=l,e.total_out+=p,r.total+=p,4&r.wrap&&p&&(e.adler=r.check=r.flags?M(r.check,i,p,o-p):F(r.check,i,p,o-p)),p=l,4&r.wrap&&(r.flags?u:At(u))!==r.check){e.msg="incorrect data check",r.mode=Ct;break}u=0,c=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;c<32;){if(0===a)break e;a--,u+=s[n++]<<c,c+=8}if(4&r.wrap&&u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=Ct;break}u=0,c=0}r.mode=16208;case 16208:R=ft;break e;case Ct:R=yt;break e;case 16210:return bt;default:return gt}return e.next_out=o,e.avail_out=l,e.next_in=n,e.avail_in=a,r.hold=u,r.bits=c,(r.wsize||p!==e.avail_out&&r.mode<Ct&&(r.mode<It||t!==ct))&&Ht(e,e.output,e.next_out,p-e.avail_out),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,r.total+=p,4&r.wrap&&p&&(e.adler=r.check=r.flags?M(r.check,i,p,e.next_out-p):F(r.check,i,p,e.next_out-p)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Rt?128:0)+(r.mode===Tt||r.mode===_t?256:0),(0===d&&0===p||t===ct)&&R===ht&&(R=St),R},inflateEnd:e=>{if(Ut(e))return gt;let t=e.state;return t.window&&(t.window=null),e.state=null,ht},inflateGetHeader:(e,t)=>{if(Ut(e))return gt;const r=e.state;return 0==(2&r.wrap)?gt:(r.head=t,t.done=!1,ht)},inflateSetDictionary:(e,t)=>{const r=t.length;let s,i,n;return Ut(e)?gt:(s=e.state,0!==s.wrap&&s.mode!==vt?gt:s.mode===vt&&(i=1,i=F(i,t,r,0),i!==s.check)?yt:(n=Ht(e,t,r,r),n?(s.mode=16210,bt):(s.havedict=1,ht)))},inflateInfo:"pako inflate (from Nodeca project)"},$t=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const jt=Object.prototype.toString,{Z_NO_FLUSH:qt,Z_FINISH:Gt,Z_OK:Zt,Z_STREAM_END:Vt,Z_NEED_DICT:Kt,Z_STREAM_ERROR:Qt,Z_DATA_ERROR:Jt,Z_MEM_ERROR:Yt}=B;function Xt(e){this.options=Ne.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $e,this.strm.avail_out=0;let r=Wt.inflateInit2(this.strm,t.windowBits);if(r!==Zt)throw new Error(N[r]);if(this.header=new $t,Wt.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=We.string2buf(t.dictionary):"[object ArrayBuffer]"===jt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Wt.inflateSetDictionary(this.strm,t.dictionary),r!==Zt)))throw new Error(N[r])}function er(e,t){const r=new Xt(t);if(r.push(e),r.err)throw r.msg||N[r.err];return r.result}Xt.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize,i=this.options.dictionary;let n,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Gt:qt,"[object ArrayBuffer]"===jt.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),n=Wt.inflate(r,o),n===Kt&&i&&(n=Wt.inflateSetDictionary(r,i),n===Zt?n=Wt.inflate(r,o):n===Jt&&(n=Kt));r.avail_in>0&&n===Vt&&r.state.wrap>0&&0!==e[r.next_in];)Wt.inflateReset(r),n=Wt.inflate(r,o);switch(n){case Qt:case Jt:case Kt:case Yt:return this.onEnd(n),this.ended=!0,!1}if(a=r.avail_out,r.next_out&&(0===r.avail_out||n===Vt))if("string"===this.options.to){let e=We.utf8border(r.output,r.next_out),t=r.next_out-e,i=We.buf2string(r.output,e);r.next_out=t,r.avail_out=s-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(i)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(n!==Zt||0!==a){if(n===Vt)return n=Wt.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Xt.prototype.onData=function(e){this.chunks.push(e)},Xt.prototype.onEnd=function(e){e===Zt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ne.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var tr={Inflate:Xt,inflate:er,inflateRaw:function(e,t){return(t=t||{}).raw=!0,er(e,t)},ungzip:er,constants:B};const{Deflate:rr,deflate:sr,deflateRaw:ir,gzip:nr}=rt,{Inflate:or,inflate:ar,inflateRaw:lr,ungzip:ur}=tr;var cr=rr,dr=sr,pr=ir,hr=nr,fr=or,mr=ar,gr=lr,yr=ur,br=B,Sr={Deflate:rr,deflate:sr,deflateRaw:ir,gzip:nr,Inflate:or,inflate:ar,inflateRaw:lr,ungzip:ur,constants:B}}},t={};function r(s){var i=t[s];if(void 0!==i)return i.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};(()=>{"use strict";var e={};r.r(e),r.d(e,{proxyable:()=>l});var t=r("./src/ui/code/CommonUi.ts"),s=r("./src/core/definitions.ts"),i=r("./src/lib/PolyFill.ts"),n=r("./src/lib/External.ts"),o=r("./src/lib/environment.ts"),a=r("./src/lib/Utils.ts");class l{static initialize(){let e=new URL(document.location.toString()).searchParams.get("id"),r=parseInt(e);l.sourceTabId=r,r>-1?(t.CommonUi.onDocumentReady(l.bindEvents),t.CommonUi.onDocumentReady(l.initializeGrids),i.PolyFill.runtimeSendMessage({command:s.CommandMessages.ProxyableGetInitialData,tabId:l.sourceTabId},(e=>{null!=e?l.populateDataForProxyable(e):o.environment.chrome||n.messageBox.error(o.api.i18n.getMessage("proxyableErrNoSourceTab"))}),(e=>{i.PolyFill.runtimeSendMessage("ProxyableGetInitialData failed! > "+e)})),i.PolyFill.tabsQuery({active:!0,currentWindow:!0},(e=>{e&&e[0]&&(l.selfTabId=e[0].id)})),o.api.runtime.onMessage.addListener(l.handleMessages),t.CommonUi.onDocumentReady(t.CommonUi.localizeHtmlPage)):window.close()}static stopListeningToLogger(){i.PolyFill.runtimeSendMessage({command:s.CommandMessages.ProxyableRemoveProxyableLog,tabId:l.sourceTabId})}static handleMessages(e,t,r){if("object"==typeof e)if(e.command!==s.CommandMessages.ProxyableGetInitialDataResponse||null==e.dataForProxyable){if(e.command===s.CommandMessages.ProxyableRequestLog&&null!=e.tabId){if(e.tabId!=l.sourceTabId)return;return l.insertNewLogInGrid(e.logInfo),void(r&&r(null))}if(e.command===s.CommandMessages.ProxyableOriginTabRemoved&&null!=e.tabId){if(e.tabId!=l.sourceTabId)return;return r&&r(null),void l.closeSelf()}r&&r(null)}else{if(e.tabId!=l.sourceTabId)return;let t=e.dataForProxyable;t&&l.populateDataForProxyable(t)}}static bindEvents(){window.onbeforeunload=l.stopListeningToLogger,(0,n.jQuery)("#btnClose").click((()=>{l.closeSelf()})),(0,n.jQuery)("#btnReload").click((()=>{i.PolyFill.tabsReload(l.sourceTabId)})),(0,n.jQuery)("#btnClear").click((()=>{l.grdProxyable.clear(),l.grdProxyable.draw("full-hold")})),(0,n.jQuery)("#btnBenchmark").click((()=>{n.messageBox.info("Check the Console for results"),i.PolyFill.runtimeSendMessage({command:"BenchmarkTheRules",urls:l.grdProxyable.data().toArray().map((e=>e.url))},(e=>{}),(e=>{i.PolyFill.runtimeSendMessage("BenchmarkTheRules failed! > "+e)}))}))}static initializeGrids(){l.grdProxyable=(0,n.jQuery)("#grdProxyable").DataTable({dom:'<t><"row"<"col-sm-12 col-md-5"<"text-left float-left"f>><"col-sm-12 col-md-7"<"text-right"l>>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',paging:!1,select:!1,ordering:!1,scrollY:600,scrollCollapse:!0,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],columns:[{name:"url",data:"url",title:o.api.i18n.getMessage("proxyableGridColUrl"),className:"grid-ellipsis-text-cell",width:"60%",render:function(e,t,r){return`<a class='wordwrap-anywhere grid-ellipsis-text-link' href="${e}" target="_blank">${e}</a>`}},{name:"proxifiedStatus",data:"proxifiedStatusName",title:o.api.i18n.getMessage("proxyableGridColProxifiedStatus"),width:100,className:"grid-col-nowrap vertical-align-middle",render:function(e,t,r){let s=o.api.i18n.getMessage(`proxyableGridCol_ProxifiedStatus_${r.proxifiedStatusName}`);return r.proxified?'<i class="fas fa-check text-success"></i> '+s:'<i class="fas fa-minus text-danger"></i> '+s}},{name:"matchedRuleStatus",data:"matchedRuleStatusName",title:o.api.i18n.getMessage("proxyableGridColRuleStatus"),width:100,className:"grid-col-nowrap vertical-align-middle",render:function(e,t,r){return o.api.i18n.getMessage(`proxyableGridCol_RuleStatus_${r.matchedRuleStatusName}`)}},{name:"ruleHostName",data:"ruleHostName",title:o.api.i18n.getMessage("proxyableGridColRuleHost"),className:"grid-status-col-text grid-col-nowrap vertical-align-middle",render:function(e,t,r){return`<div class='wordwrap-anywhere grid-col-maxwidth-100' title="${e}">${e||""}</div>`}},{name:"rulePatternText",data:"rulePatternText",title:o.api.i18n.getMessage("proxyableGridColRulePattern"),className:"grid-status-col-text grid-col-nowrap vertical-align-middle",render:function(e,t,r){return`<div class='wordwrap-anywhere grid-col-maxwidth-100' title="${e}">${e||""}</div>`}},{name:"enabled",width:100,title:"",className:"text-center vertical-align-middle",render:(e,t,r)=>{if(r.renderEnabledCache)return r.renderEnabledCache;let i=function(e,t,r){let i=r.url;if(!i)return"";if(r.ruleSource==s.CompiledProxyRuleSource.Subscriptions)return`<small class="grid-status-col-text grid-col-maxwidth-100 grid-col-nowrap">${o.api.i18n.getMessage("proxyableSubscriptionRule")}</small>`;if(r.ruleId)return`<button id='btnDisable' data-domain="${r.ruleHostName}" data-ruleId="${r.ruleId}" class="btn btn-sm btn-danger whitespace-nowrap">\n\t\t\t\t\t\t<i class="fa fa-times" aria-hidden="true"></i> ${o.api.i18n.getMessage("proxyableDisableButton")}</button>`;{let e;if(e=r.subDomains?r.subDomains:r.subDomains=a.Utils.extractSubdomainListFromUrl(i),e&&e.length){const t=`<div><div class="btn-group dropstart">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-sm btn-success dropdown-toggle whitespace-nowrap" data-bs-toggle="dropdown">\n\t\t\t\t\t\t\t\t${o.api.i18n.getMessage("proxyableEnableButton")}\n\t\t\t\t\t\t\t\t<i class="fa fa-plus" aria-hidden="true"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<ul class="subdomains-list dropdown-menu dropdown-menu-end">\n\t\t\t\t\t\t\t\t<li><a class="dropdown-item" href="#">(none)</a></li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</div></div>`;let r=(0,n.jQuery)(t),s=r.find(".subdomains-list");s.empty();for(let t of e){let e=(0,n.jQuery)(`<li><a class="dropdown-item" data-domain="${t}" href="#"><small>${o.api.i18n.getMessage("proxyableEnableButtonDomain")} \n\t\t\t\t\t\t\t\t\t\t\t\t\t<b class='font-url'>${t}</b></small></a></li>`);s.append(e)}return r.html()}}return""}(0,0,r);return r.renderEnabledCache=i,i}}]}),l.grdProxyable.draw()}static populateDataForProxyable(e){e&&(t.CommonUi.applyThemes(e.themeData),(0,n.jQuery)("#spanPageUrl").show().text(e.url),(0,n.jQuery)("#txtPageUrl").show().val(e.url))}static insertNewLogInGrid(e){try{let t=new s.ProxyableLogDataType;Object.assign(t,e),t.ruleHostName=t.ruleHostName||"",t.rulePatternText=t.rulePatternText||"";let r=this.grdProxyable.row.add(t).draw("full-hold");l.refreshGridRow(r)}catch(e){throw i.PolyFill.runtimeSendMessage("insertNewLogInGrid failed! > "+e),e}}static refreshGridAllRows(e){e?l.grdProxyable.rows().invalidate().draw("full-hold"):l.grdProxyable.rows().draw("full-hold");var t=this.grdProxyable.rows().nodes();for(let e=0;e<t.length;e++){const r=(0,n.jQuery)(t[e]);r.find(".subdomains-list a").on("click",l.onToggleSubdomainClick),r.find("#btnDisable").on("click",l.onDisableSubdomainClick)}}static refreshGridRow(e,t){if(!e)return;t&&(e.renderEnabledCache=null,e.invalidate());let r=(0,n.jQuery)(e.node());r.find(".subdomains-list a").on("click",l.onToggleSubdomainClick),r.find("#btnDisable").on("click",l.onDisableSubdomainClick)}static onToggleSubdomainClick(){let e=(0,n.jQuery)(this),t=e.data("domain");if(!t)return;let r=e.data("ruleId"),s=l.grdProxyable.row(e.parents("tr"));n.messageBox.confirm(`${o.api.i18n.getMessage("proxyableCreateRuleConfirm")} <b>'${t}'</b>?`,(()=>{l.toggleProxyableRequest(t,null,r,s)}))}static onDisableSubdomainClick(){let e=(0,n.jQuery)(this),t=e.data("domain");if(!t)return;let r=e.data("ruleId"),s=l.grdProxyable.row(e.parents("tr"));n.messageBox.confirm(`${o.api.i18n.getMessage("proxyableDeleteRuleConfirm")} <b>'${t}'</b>?`,(()=>{l.toggleProxyableRequest(null,t,r,s)}))}static toggleProxyableRequest(e,t,r,o){i.PolyFill.runtimeSendMessage({command:s.CommandMessages.ProxyableToggleProxyableDomain,enableByDomain:e,removeBySource:t,ruleId:r,tabId:l.sourceTabId},(r=>{if(r)if(r.success)if(r.message&&n.messageBox.success(r.message),o){var i=o.data(),a=r.rule;i&&(e?(a&&i.applyFromRule(a),i.proxifiedStatus=s.ProxyableProxifiedStatus.MatchedRule):t&&(i.removeRuleInfo(),i.proxifiedStatus=s.ProxyableProxifiedStatus.NoProxy),i.renderEnabledCache=null),l.refreshGridRow(o,!0)}else l.refreshGridAllRows(!0);else r.message&&n.messageBox.error(r.message)}))}static closeSelf(){l.stopListeningToLogger(),i.PolyFill.tabsRemove(l.selfTabId)}}l.sourceTabId=null,l.initialize()})(),(()=>{"use strict";r.r(s);var e=r("./src/lib/environment.ts");e.environment.browserConfig={name:"Chrome",marketName:"Chrome Web Store",marketUrl:"https://chrome.google.com/webstore/detail/smartproxy/jogcnplbkgkfdakgdenhlpcfhjioidoj"},e.environment.manifestV3=!0})()})();